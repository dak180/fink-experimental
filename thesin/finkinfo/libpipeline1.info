Package: libpipeline1
Version: 1.2.4
Revision: 1.1
###
BuildDepends: <<
	dpkg-dev (>= 1.16.1),
	debhelper (>= 9),
	pkgconfig,
	check,
	dh-autoreconf
<<
###
Source: http://download.savannah.gnu.org/releases/libpipeline/libpipeline-%v.tar.gz
Source-MD5: a98b07f6f487fa268d1ebd99806b85ff
Source2: mirror:debian:pool/main/libp/libpipeline/libpipeline_%v-1.debian.tar.gz
Source2-MD5: f4fb974c6378223a5878b0c0f6f9caf1
Source2ExtractDir: libpipeline-%v
###
PatchScript: <<
#!/bin/sh -ev
BASE=$(echo %p | perl -pi -e 's,/,,'); \
for i in `find debian -type f`; do perl -pi -e "s,usr,${BASE},g" $i; done

perl -pi -e 's,libpipeline\*\.so\.\*,libpipeline\.\*\.dylib,g' debian/%n.install
perl -pi -e 's,libpipeline\*\.so,libpipeline\.dylib,g' debian/libpipeline-dev.install

### Remove multiarch dir since we don't support it in fink
perl -pi -e 's,Multi-Arch: same,Multi-Arch: foreign,g' debian/control
### Remove autotest override
perl -pi -e 's,dh_auto_test --,# dh_auto_test --,g' debian/rules

# override_dh_installman
cat << EOF >> debian/rules 

override_dh_installman:
EOF
<<
CompileScript: <<
debian/rules build
<<
InfoTest: <<
	TestScript: <<
dh_auto_test -- LDFLAGS= || exit 2
	<<
<<
InstallScript: <<
dh install --builddirectory=debian/build --with=autoreconf --parallel
dh_installdeb

cp -R debian/%N%p/* %i/
<<
###
Shlibs: <<
	%p/lib/x86_64-darwin/libpipeline.1.dylib 4.0.0 libpipeline1 (>= 1.2.4-1)
<<
###
Description: Pipeline manipulation library
DescDetail: <<
This is a C library for setting up and running pipelines of processes,
without needing to involve shell command-line parsing which is often
error-prone and insecure.
<<
SplitOff: <<
	Package: libpipeline-dev
	BuildDependsOnly: true
	Depends: %N (= %v-%r)
	InstallScript: <<
cp -R debian/%n%p/* %i/
cp debian/%n/DEBIAN/post* %d/DEBIAN/
	<<
	Description: Pipeline manipulation library (development files)
	DescDetail: <<
This is a C library for setting up and running pipelines of processes,
without needing to involve shell command-line parsing which is often
error-prone and insecure.

This package contains files needed for developing with libpipeline.
	<<
<<
###
License: GPL
Maintainer: Justin F. Halett <thesin@lists.sourceforge.net>
Homepage: http://www.nongnu.org/libpipeline/
