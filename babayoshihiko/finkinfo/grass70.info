Info2: <<
Package: grass70%type_pkg[gui]
Type: gui (-mac -x11)
Version: 7.0.0beta2
Revision: 0.2

Description: Powerful GIS software
License: GPL
Homepage: http://grass.osgeo.org/grass64/
Maintainer:BABA Yoshihiko <babayoshihiko@mac.com>
DescDetail: <<
Very Powerful Geographical Information System with CLI and GUI. 

PostgreSQL: 9.2
Python: 2.7
SQLite: 3

Mac version uses Mac's TclTk.

X11 version uses Fink's TclTk and lacks OpenGL/NVIZ support.
<<

DescUsage: Just type double click GRASS-7.0.app in %p/Applications.

DescPackaging: <<
	dmacks added fix for building with make-3.82. See:
	http://lists.osgeo.org/pipermail/grass-dev/2012-May/058634.html
<<

# Dependencies.
Depends: <<
  %n-shlibs (=%v-%r)
<<
BuildDepends: <<
  fink (>= 0.28),
  freetype219,
  libncurses5-dev,
  libiconv-dev, readline6, libgettext8-dev, gettext-tools,
  fftw3,
  libgeos3.4.2,
  gdal-dev, 
  libjpeg9, libpng16, libtiff5,
  unixodbc2 | unixodbc2-nox,
  szip, xerces-c31-dev, libogdi3,
  postgresql92-dev (>= 1:0-0),
  proj, proj-bin,
  python27,
  sqlite3-dev,
  (%type_raw[gui] = -mac) wxwidgets300-cocoa,
  (%type_pkg[gui] = -x11) wxgtk2.8, (%type_pkg[gui] = -x11) wxgtk2.8-py27-dev
<<
# hdf5-18-bin | hdf5-bin,

Source: http://grass.osgeo.org/grass70/source/grass-%v.tar.gz
Source-MD5: 13f5844e1302e3b3c6621c3062f54367

# Patch Phase.
#PatchFile: grass64.patch
#PatchFile-MD5: 43a2451895c8dc51877af4da151ab98c
PatchScript: <<
#!/bin/bash -xe
  # sed 's|@PREFIX@|%p|g' < %{PatchFile} | patch -p1
  #perl -pi -e 's|wximgview||' visualization/Makefile
  perl -pi -e 's|/usr/bin/env python|%p/bin/python2.7|' gui/wxpython/*/*.py
  perl -pi -e 's|call|chmod +x \$\(1\) && call|' include/Make/HtmlRules.make 
  perl -pi -e 's|if \[|-if [|' include/Make/Html.make   # This will not create html files for lib/*
  #perl -pi -e 's|py_compile|py_compile dfile=%p/Applications/GRASS-7.0.app/Contents/MacOS/etc/$pydir|' include/Make/Python.make
  
  # rewrite python wrapper
  chmod 0777 macosx/app/python_wrapper
  echo 'exec "$GRASS_PYTHONWX" "$@"' >./macosx/app/python_wrapper
  chmod 0755 macosx/app/python_wrapper
<<

# Compile Phase.
SetCFLAGS: -I%p/include
SetLDFLAGS: -L%p/lib -lcurses

ConfigureParams: << 
  --with-curses \
  --with-freetype \
  --with-freetype-includes=%p/lib/freetype219/include/freetype2 \
  --with-freetype-libs=%p/lib/freetype219/lib \
  --with-gdal=%p/bin/gdal-config \
  --with-proj --with-proj-includes=%p/include --with-proj-libs=%p/lib --with-proj-share=%p/share/proj \
  --with-geos=%p/opt/libgeos3.4.2/bin/geos-config \
  --with-jpeg-includes=%p/include --with-jpeg-libs=%p/lib \
  --with-png-includes=%p/include --with-png-libs=%p/lib \
  --with-tiff-includes=%p/include --with-tiff-libs=%p/lib \
  --with-postgres --with-postgres-includes=%p/opt/postgresql-9.2/include --with-postgres-libs=%p/opt/postgresql-9.2/lib \
  --without-mysql --with-odbc --with-sqlite \
  --with-sqlite-libs=%p/lib --with-sqlite-includes=%p/include \
  --with-fftw-includes=%p/include --with-fftw-libs=%p/lib \
  --with-cxx --without-motif \
  --without-glw \
  --without-readline \
  --without-opengl \
  --prefix=%p/Applications \
  --enable-macosx-app
<<


CompileScript: <<
#!/bin/bash -xe
  darwin_vers=`uname -r`
  
  # mkdir OBJ.x86_64-apple-darwin13.3.0
  
  if [ "%type_raw[gui]" == "-mac" ]; then
    ./configure %c --without-x --with-wxwidgets=%p/lib/wx/config/osx_cocoa-unicode-3.0
  else
    ./configure %c --with-x --x-includes=/usr/X11R6/include --x-libraries=/usr/X11R6/lib --with-wxwidgets=%p/lib/wx/config/gtk2-unicode-release-2.8
  fi
  
  # Used by ctypes_loader.py
  #export DYLD_FALLBACK_LIBRARY_PATH=%b/dist.x86_64-apple-darwin13.3.0/lib
  
  
  # See include/Make/Platform.make, include/Make/Vars.make and macosx/Makefile for variables
  make         INST_DIR=%p/Applications/GRASS-7.0.app/Contents/MacOS \
               PREFIX_TARGET=%b/Applications \
               GISBASE=%b/dist.x86_64-apple-darwin${darwin_vers} \
               RUN_GISBASE=%p/Applications/GRASS-7.0.app/Contents/MacOS \
               GISBASE_SYSTEM=%b/Applications/GRASS-7.0.app/Contents/MacOS/lib \
               PYTHON=%p/bin/python2.7 \
               GRASS_PYTHON=%p/bin/python2.7
    
  
  make install UNIX_BIN=%b/Applications/GRASS-7.0.app/Contents/MacOS \
               INST_DIR=%b/Applications/GRASS-7.0.app/Contents/MacOS \
               PREFIX_TARGET=%b/Applications \
               GISBASE=%p/Applications/GRASS-7.0.app/Contents/MacOS \
               RUN_GISBASE=%p/Applications/GRASS-7.0.app/Contents/MacOS \
               MACOSX_SUPPDIR=%b/Applications/GRASS-7.0.app/Contents/MacOS/lib \
               GISBASE_SYSTEM=%p/Applications/GRASS-7.0.app/Contents/MacOS/lib \
               PYTHON=%p/bin/python2.7 \
               GRASS_PYTHON=%p/bin/python2.7
  # RUN_GISBASE:     = GISBASE
  # GISBASE_SYSTEM:  /Library/GRASS/$grass_ver
  #                  Used in build and grass startup shell scripts.
  # MACOSX_SUPPDIR:  /Library/GRASS/${GRASS_VERSION_MAJOR}.${GRASS_VERSION_MINOR}
  #                  Used only to create the directory during installation time;
  #                  Why not use GISBASE_SYSTEM?
  # PYTHON:          System python
  #                  Used during build time; this open does NOT set run-time python.
  # GRASS_PYTHON:    Used by grass startup script
  #                  Cannot be overridden, so the shell script needs to be patched

  # Recompile python scripts to fix path (because 'make install' is
  # called with path to staging directory that masks runtime location)
  perl -pi -e 's|%b|%p|g' %b/Applications/GRASS-7.0.app/Contents/MacOS/etc/python/grass/lib/*.py
  for pydir in python/grass python/grass/imaging python/grass/lib python/grass/pydispatch \
               python/grass/pygrass python/grass/script python/grass/temporal python/grass/lib \
               gui/wxpython gui/wxpython/* r.in.wms ../tools
    do
      %p/bin/python2.7    %p/lib/python2.7/compileall.py -f -d %p/Applications/GRASS-7.0.app/Contents/MacOS/etc/$pydir %b/Applications/GRASS-7.0.app/Contents/MacOS/etc/$pydir
      %p/bin/python2.7 -O %p/lib/python2.7/compileall.py -f -d %p/Applications/GRASS-7.0.app/Contents/MacOS/etc/$pydir %b/Applications/GRASS-7.0.app/Contents/MacOS/etc/$pydir
    done
  
  for libname in  arraystats bitmap btree btree2 cairodriver ccmath cdhc cluster datetime \
                  dbmibase dbmiclient dbmidriver dbstubs dgl dig2 display driver dspf g3d \
                  gis gmath gpde gproj htmldriver imagery interpdata interpfl iortho lidar \
                  linkm lrs manage neta pngdriver psdriver qtree raster rli rowio rtree \
                  segment shape sim sites sqlp stats symb temporal vector vedit 
    do
      install_name_tool -id %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_${libname}.dylib %b/dist.x86_64-apple-darwin${darwin_vers}/lib/libgrass_${libname}.dylib
    done
<<



# Install Phase.
InstallScript: <<
#!/bin/sh -xe
  darwin_vers=`uname -r`
  #cp -R %b/dist.x86_64-apple-darwin${darwin_vers}/lib %i/Applications/GRASS-7.0.app/Contents/MacOS/lib
<<
AppBundles: Applications/GRASS-7.0.app

# Additional Phase.
#SplitOff: <<
#  Package: %N-dev
#  Description: GRASS Development Headers
#  Depends: %N-shlibs (= %v-%r)
#  BuildDependsOnly: true
#  Files: Applications/GRASS-7.0.app/Contents/MacOS/include
#<<

SplitOff2: <<
  Package: %N-shlibs
  Description: GRASS Shared Libraries
  Depends: <<
    freetype219-shlibs,
    libncurses5-shlibs,
    libiconv,
    fftw3-shlibs, 
    libgeos3.4.2-shlibs, 
    gdal-shlibs, 
    libgettext8-shlibs, libjpeg9-shlibs, libpng16-shlibs, libtiff5-shlibs,
    xerces-c31-shlibs,
    postgresql92-shlibs,
    python27-shlibs,
    sqlite3-shlibs,
    unixodbc2-shlibs | unixodbc2-nox-shlibs,
    (%type_raw[gui] = -mac) wxwidgets300-cocoa-shlibs,
    (%type_pkg[gui] = -x11) wxgtk2.8-shlibs, (%type_pkg[gui] = -x11) wxgtk2.8-py27
  <<

  Files: Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_*.dylib
  Shlibs: <<
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_arraystats.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_bitmap.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_btree.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_btree2.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_cairodriver.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_ccmath.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_cdhc.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_cluster.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_datetime.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbmibase.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbmiclient.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbmidriver.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbstubs.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dgl.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dig2.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_display.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_driver.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dspf.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_g3d.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gis.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gmath.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gpde.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gproj.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_htmldriver.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_imagery.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_interpdata.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_interpfl.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_iortho.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_lidar.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_linkm.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_lrs.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_manage.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_neta.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_pngdriver.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_psdriver.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_qtree.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_raster.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_rli.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_rowio.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_rtree.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_segment.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_shape.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_sim.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_sites.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_sqlp.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_stats.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_symb.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_temporal.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_vector.%v.dylib
    !%p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_vedit.%v.dylib

    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_arraystats.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_bitmap.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_btree.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_btree2.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_cairodriver.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_ccmath.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_cdhc.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_cluster.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_datetime.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbmibase.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbmiclient.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbmidriver.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dbstubs.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dgl.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dig2.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_display.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_driver.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_dspf.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_g3d.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gis.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gmath.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gpde.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_gproj.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_htmldriver.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_imagery.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_interpdata.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_interpfl.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_iortho.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_lidar.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_linkm.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_lrs.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_manage.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_neta.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_pngdriver.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_psdriver.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_qtree.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_raster.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_rli.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_rowio.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_rtree.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_segment.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_shape.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_sim.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_sites.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_sqlp.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_stats.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_symb.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_temporal.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_vector.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
    %p/Applications/GRASS-7.0.app/Contents/MacOS/lib/libgrass_vedit.dylib 7.0.0 %n (>=7.0.0beta2-0.1)
  <<
<<

<<