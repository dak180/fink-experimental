diff -ruN php-5.6.7.orig/fink/patches/dtrace-extern.patch php-5.6.7/fink/patches/dtrace-extern.patch
--- php-5.6.7.orig/fink/patches/dtrace-extern.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/dtrace-extern.patch	2014-02-06 09:14:06.000000000 -0700
@@ -0,0 +1,16 @@
+--- php5.orig/Zend/zend_dtrace.h
++++ php5/Zend/zend_dtrace.h
+@@ -30,9 +30,9 @@
+ #endif
+ 
+ #ifdef HAVE_DTRACE
+-ZEND_API zend_op_array *(*zend_dtrace_compile_file)(zend_file_handle *file_handle, int type TSRMLS_DC);
+-ZEND_API void (*zend_dtrace_execute)(zend_op_array *op_array TSRMLS_DC);
+-ZEND_API void (*zend_dtrace_execute_internal)(zend_execute_data *execute_data_ptr, zend_fcall_info *fci, int return_value_used TSRMLS_DC);
++extern ZEND_API zend_op_array *(*zend_dtrace_compile_file)(zend_file_handle *file_handle, int type TSRMLS_DC);
++extern ZEND_API void (*zend_dtrace_execute)(zend_op_array *op_array TSRMLS_DC);
++extern ZEND_API void (*zend_dtrace_execute_internal)(zend_execute_data *execute_data_ptr, zend_fcall_info *fci, int return_value_used TSRMLS_DC);
+ 
+ ZEND_API zend_op_array *dtrace_compile_file(zend_file_handle *file_handle, int type TSRMLS_DC);
+ ZEND_API void dtrace_execute_ex(zend_execute_data *execute_data TSRMLS_DC);
+
diff -ruN php-5.6.7.orig/fink/patches/fink_quirks.patch php-5.6.7/fink/patches/fink_quirks.patch
--- php-5.6.7.orig/fink/patches/fink_quirks.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/fink_quirks.patch	2015-04-29 12:16:56.000000000 -0600
@@ -0,0 +1,269 @@
+Description: Changes to make php use versioned paths and other minor
+ cleanup changes.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- a/configure.in
++++ b/configure.in
+@@ -1085,7 +1085,7 @@ if test "$PHP_CLI" = "no"; then
+ fi
+ 
+ PHP_ARG_WITH(pear, [whether to install PEAR],
+-[  --with-pear=DIR         Install PEAR in DIR @<:@PREFIX/lib/php@:>@
++[  --with-pear=DIR         Install PEAR in DIR @<:@PREFIX/lib/php5@:>@
+   --without-pear          Do not install PEAR], DEFAULT, yes)
+ 
+ if test "$PHP_PEAR" != "no"; then
+@@ -1115,7 +1115,7 @@ dnl
+   if test "$PHP_PEAR" = "DEFAULT" || test "$PHP_PEAR" = "yes"; then
+     case $PHP_LAYOUT in
+       GNU) PEAR_INSTALLDIR=$datadir/pear;;
+-      *)   PEAR_INSTALLDIR=$libdir/php;;
++      *)   PEAR_INSTALLDIR=$libdir/php5;;
+     esac
+   fi
+ 
+@@ -1170,12 +1170,12 @@ test "$program_suffix" = "NONE" && progr
+ 
+ case $libdir in
+   '${exec_prefix}/lib')
+-    libdir=$libdir/php
++    libdir=$libdir/php5
+     ;;
+ esac
+ case `eval echo $datadir` in
+   '${prefix}/share')
+-    datadir=$datadir/php
++    datadir=$datadir/php5
+     ;;
+ esac
+ 
+@@ -1242,7 +1242,7 @@ EXPANDED_SYSCONFDIR=`eval echo $sysconfd
+ EXPANDED_DATADIR=$datadir
+ EXPANDED_PHP_CONFIG_FILE_PATH=`eval echo "$PHP_CONFIG_FILE_PATH"`
+ EXPANDED_PHP_CONFIG_FILE_SCAN_DIR=`eval echo "$PHP_CONFIG_FILE_SCAN_DIR"`
+-INCLUDE_PATH=.:$EXPANDED_PEAR_INSTALLDIR
++INCLUDE_PATH=.:$EXPANDED_PEAR_INSTALLDIR:/usr/share/pear
+ 
+ exec_prefix=$old_exec_prefix
+ libdir=$old_libdir
+--- a/ext/ext_skel
++++ b/ext/ext_skel
+@@ -70,7 +70,7 @@ if test -d "$extname" ; then
+ fi
+ 
+ if test -z "$skel_dir"; then
+-  skel_dir="skeleton"
++  skel_dir="@FINKPREFIX@/lib/php5/skeleton"
+ fi
+ 
+ ## convert skel_dir to full path
+--- a/php.ini-development
++++ b/php.ini-development
+@@ -708,7 +708,7 @@ default_mimetype = "UTF-8"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+ 
+ ; UNIX: "/path1:/path2"
+-;include_path = ".:/php/includes"
++;include_path = ".:@FINKPREFIX@/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include_path = ".;c:\php\includes"
+--- a/php.ini-production
++++ b/php.ini-production
+@@ -708,7 +708,7 @@ default_mimetype = "UTF-8"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+ 
+ ; UNIX: "/path1:/path2"
+-;include_path = ".:/php/includes"
++;include_path = ".:@FINKPREFIX@/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include_path = ".;c:\php\includes"
+@@ -869,49 +869,6 @@ default_socket_timeout = 60
+ ; If you only provide the name of the extension, PHP will look for it in its
+ ; default extension directory.
+ ;
+-; Windows Extensions
+-; Note that ODBC support is built in, so no dll is needed for it.
+-; Note that many DLL files are located in the extensions/ (PHP 4) ext/ (PHP 5)
+-; extension folders as well as the separate PECL DLL download (PHP 5).
+-; Be sure to appropriately set the extension_dir directive.
+-;
+-;extension=php_bz2.dll
+-;extension=php_curl.dll
+-;extension=php_fileinfo.dll
+-;extension=php_gd2.dll
+-;extension=php_gettext.dll
+-;extension=php_gmp.dll
+-;extension=php_intl.dll
+-;extension=php_imap.dll
+-;extension=php_interbase.dll
+-;extension=php_ldap.dll
+-;extension=php_mbstring.dll
+-;extension=php_exif.dll      ; Must be after mbstring as it depends on it
+-;extension=php_mysql.dll
+-;extension=php_mysqli.dll
+-;extension=php_oci8_12c.dll  ; Use with Oracle Database 12c Instant Client
+-;extension=php_openssl.dll
+-;extension=php_pdo_firebird.dll
+-;extension=php_pdo_mysql.dll
+-;extension=php_pdo_oci.dll
+-;extension=php_pdo_odbc.dll
+-;extension=php_pdo_pgsql.dll
+-;extension=php_pdo_sqlite.dll
+-;extension=php_pgsql.dll
+-;extension=php_pspell.dll
+-;extension=php_shmop.dll
+-
+-; The MIBS data available in the PHP distribution must be installed. 
+-; See http://www.php.net/manual/en/snmp.installation.php 
+-;extension=php_snmp.dll
+-
+-;extension=php_soap.dll
+-;extension=php_sockets.dll
+-;extension=php_sqlite3.dll
+-;extension=php_sybase_ct.dll
+-;extension=php_tidy.dll
+-;extension=php_xmlrpc.dll
+-;extension=php_xsl.dll
+ 
+ ;;;;;;;;;;;;;;;;;;;
+ ; Module Settings ;
+--- a/sapi/caudium/config.m4
++++ b/sapi/caudium/config.m4
+@@ -26,8 +26,8 @@ if test "$PHP_CAUDIUM" != "no"; then
+     AC_MSG_ERROR([Could not find a pike in $PHP_CAUDIUM/bin/])
+   fi
+   if $PIKE -e 'float v; int rel;sscanf(version(), "Pike v%f release %d", v, rel);v += rel/10000.0; if(v < 7.0268) exit(1); exit(0);'; then
+-    PIKE_MODULE_DIR=`$PIKE --show-paths 2>&1| grep '^Module' | sed -e 's/.*: //'`
+-    PIKE_INCLUDE_DIR=`echo $PIKE_MODULE_DIR | sed -e 's,lib/pike/modules,include/pike,' -e 's,lib/modules,include/pike,' `
++    PIKE_MODULE_DIR=`$PIKE --show-paths 2>&1| grep '^Master file' | sed -e 's/.*: //' -e 's/master.pike/modules/'`
++    PIKE_INCLUDE_DIR=`echo $PIKE_MODULE_DIR | sed -e 's,lib/modules,,' -e 's,modules,include,' `
+     if test -z "$PIKE_INCLUDE_DIR" || test -z "$PIKE_MODULE_DIR"; then
+       AC_MSG_ERROR(Failed to figure out Pike module and include directories)
+     fi
+@@ -84,7 +84,9 @@ if test "$PHP_CAUDIUM" != "no"; then
+   PIKE_VERSION=`$PIKE -e 'string v; int rel;sscanf(version(), "Pike v%s release %d", v, rel); write(v+"."+rel);'`   
+   AC_DEFINE(HAVE_CAUDIUM,1,[Whether to compile with Caudium support])
+   PHP_SELECT_SAPI(caudium, shared, caudium.c)
+-  INSTALL_IT="\$(INSTALL) -m 0755 $SAPI_SHARED $PHP_CAUDIUM/lib/$PIKE_VERSION/PHP5.so"
++  dnl FIXME: This is the ugliest hack in the world!
++  dnl INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/ && \$(INSTALL) -m 0755 $SAPI_SHARED \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/php5.so"
++  INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/ && \$(INSTALL) -m 0755 .$SAPI_SHARED \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/PHP5.so"
+   RESULT="  *** Pike binary used:         $PIKE
+   *** Pike include dir(s) used: $PIKE_INCLUDE_DIR
+   *** Pike version:             $PIKE_VERSION"
+--- a/sapi/cli/php.1.in
++++ b/sapi/cli/php.1.in
+@@ -365,13 +365,14 @@ Shows configuration for extension
+ Show configuration file names
+ .SH FILES
+ .TP 15
+-.B php\-cli.ini
++.B @FINKPREFIX@/etc/php5/cli/php.ini
+ The configuration file for the CLI version of PHP.
+ .TP
+-.B php.ini
+-The standard configuration file will only be used when 
+-.B php\-cli.ini
+-cannot be found.
++.B @FINKPREFIX@/etc/php5/cgi/php.ini
++The configuration file for the CGI version of PHP.
++.TP
++.B @FINKPREFIX@/etc/php5/apache2/php.ini
++The configuration file for the version of PHP that apache2 uses.
+ .SH EXAMPLES
+ .TP 5
+ \fI@program_prefix@php \-r 'echo "Hello World\\n";'\fP
+--- a/scripts/Makefile.frag
++++ b/scripts/Makefile.frag
+@@ -3,8 +3,8 @@
+ # Build environment install
+ #
+ 
+-phpincludedir = $(includedir)/php
+-phpbuilddir = $(libdir)/build
++phpincludedir = $(includedir)/php5
++phpbuilddir = $(prefix)/lib/php5/build
+ 
+ BUILD_FILES = \
+ 	scripts/phpize.m4 \
+--- a/scripts/php-config.in
++++ b/scripts/php-config.in
+@@ -6,9 +6,9 @@ datarootdir="@datarootdir@"
+ exec_prefix="@exec_prefix@"
+ version="@PHP_VERSION@"
+ vernum="@PHP_VERSION_ID@"
+-include_dir="@includedir@/php"
+-includes="-I$include_dir -I$include_dir/main -I$include_dir/TSRM -I$include_dir/Zend -I$include_dir/ext -I$include_dir/ext/date/lib"
+-ldflags="@PHP_LDFLAGS@"
++include_dir="@includedir@/php5"
++includes="-I$include_dir -I$include_dir/main -I$include_dir/TSRM -I$include_dir/Zend -I$include_dir/ext -I$include_dir/ext/date/lib"
++ldflags="-L$prefix/lib/php5 @PHP_LDFLAGS@"
+ libs="@EXTRA_LIBS@"
+ extension_dir='@EXTENSION_DIR@'
+ man_dir=`eval echo @mandir@`
+--- a/scripts/phpize.in
++++ b/scripts/phpize.in
+@@ -4,8 +4,8 @@
+ prefix='@prefix@'
+ datarootdir='@datarootdir@'
+ exec_prefix="`eval echo @exec_prefix@`"
+-phpdir="`eval echo @libdir@`/build"
+-includedir="`eval echo @includedir@`/php"
++phpdir="$prefix/lib/php5/build"
++includedir="$prefix/include/php5"
+ builddir="`pwd`"
+ SED="@SED@"
+ 
+--- php-5.4.3.orig/ext/pdo/config.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/ext/pdo/config.m4	2012-06-12 15:33:12.000000000 -0600
+@@ -39,7 +39,7 @@
+ 
+   if test "$ext_shared" = "yes" ; then
+     case $host_alias in
+-      *darwin*)
++      *darwin7*)
+           AC_MSG_ERROR([
+ Due to the way that loadable modules work on OSX/Darwin, you need to
+ compile the PDO package statically into the PHP core.
+--- php-5.4.3.orig/ext/gd/config.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/ext/gd/config.m4	2012-06-12 15:46:05.000000000 -0600
+@@ -101,7 +101,7 @@
+ AC_DEFUN([PHP_GD_JPEG],[
+   if test "$PHP_JPEG_DIR" != "no"; then
+ 
+-    for i in $PHP_JPEG_DIR /usr/local /usr; do
++    for i in $PHP_JPEG_DIR @FINKPREFIX@ /usr/local /usr; do
+       test -f $i/include/jpeglib.h && GD_JPEG_DIR=$i && break
+     done
+ 
+@@ -126,7 +126,7 @@
+ AC_DEFUN([PHP_GD_PNG],[
+   if test "$PHP_PNG_DIR" != "no"; then
+ 
+-    for i in $PHP_PNG_DIR /usr/local /usr; do
++    for i in $PHP_PNG_DIR @FINKPREFIX@ /usr/local /usr; do
+       test -f $i/include/png.h && GD_PNG_DIR=$i && break
+     done
+ 
+@@ -159,7 +159,7 @@
+
+     for i in $PHP_XPM_DIR /usr/local /usr/X11R6 /usr; do
+       test -f $i/include/xpm.h && GD_XPM_DIR=$i && GD_XPM_INC=$i && break
+-      test -f $i/include/X11/xpm.h && GD_XPM_DIR=$i && GD_XPM_INC=$i/X11 && break
++      test -f $i/include/X11/xpm.h && GD_XPM_DIR=$i && GD_XPM_INC=$i/include && break
+     done
+
+     if test -z "$GD_XPM_DIR"; then
+@@ -184,7 +184,7 @@
+ AC_DEFUN([PHP_GD_FREETYPE2],[
+   if test "$PHP_FREETYPE_DIR" != "no"; then
+ 
+-    for i in $PHP_FREETYPE_DIR /usr/local /usr; do
++    for i in $PHP_FREETYPE_DIR @FINKPREFIX@ /usr/local /usr; do
+       if test -f "$i/bin/freetype-config"; then
+         FREETYPE2_DIR=$i
+         FREETYPE2_CONFIG="$i/bin/freetype-config"
diff -ruN php-5.6.7.orig/fink/patches/fpm-config.patch php-5.6.7/fink/patches/fpm-config.patch
--- php-5.6.7.orig/fink/patches/fpm-config.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/fpm-config.patch	2015-04-29 10:01:36.000000000 -0600
@@ -0,0 +1,54 @@
+Description: Add major version number to paths and allow process pools
+ to be configured in individual files in @FINKPREFIX@/etc/php5/fpm/pool.d/
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-07-30
+
+--- php5.orig/sapi/fpm/php-fpm.conf.in
++++ php5/sapi/fpm/php-fpm.conf.in
+@@ -12,7 +12,7 @@
+ ; Relative path can also be used. They will be prefixed by:
+ ;  - the global prefix if it's been set (-p argument)
+ ;  - @prefix@ otherwise
+-;include=etc/fpm.d/*.conf
++;include=@EXPANDED_SYSCONFDIR@/php5/fpm/*.conf
+ 
+ ;;;;;;;;;;;;;;;;;;
+ ; Global Options ;
+@@ -22,14 +22,14 @@
+ ; Pid file
+ ; Note: the default prefix is @EXPANDED_LOCALSTATEDIR@
+ ; Default Value: none
+-;pid = run/php-fpm.pid
++pid = @EXPANDED_LOCALSTATEDIR@/run/php5-fpm.pid
+ 
+ ; Error log file
+ ; If it's set to "syslog", log is sent to syslogd instead of being written
+ ; in a local file.
+ ; Note: the default prefix is @EXPANDED_LOCALSTATEDIR@
+ ; Default Value: log/php-fpm.log
+-;error_log = log/php-fpm.log
++error_log = @EXPANDED_LOCALSTATEDIR@/log/php5-fpm.log
+ 
+ ; syslog_facility is used to specify what type of program is logging the
+ ; message. This lets syslogd specify that messages from different facilities
+@@ -124,6 +124,10 @@
+ ; used in logs and stats. There is no limitation on the number of pools which
+ ; FPM can handle. Your system will tell you anyway :)
+ 
++; To configure the pools it is recommended to have one .conf file per
++; pool in the following directory:
++include=@EXPANDED_SYSCONFDIR@/php5/fpm/pool.d/*.conf
++
+ ; Start a new pool named 'www'.
+ ; the variable $pool can we used in any directive and will be replaced by the
+ ; pool name ('www' here)
+@@ -476,7 +480,7 @@ pm.max_spare_servers = 3
+ ; Chdir to this directory at the start.
+ ; Note: relative path can be used.
+ ; Default Value: current directory or / when chroot
+-;chdir = /var/www
++chdir = /
+  
+ ; Redirect worker stdout and stderr into main error log. If not set, stdout and
+ ; stderr will be redirected to /dev/null according to FastCGI specs.
diff -ruN php-5.6.7.orig/fink/patches/giconv_is_inferior.patch php-5.6.7/fink/patches/giconv_is_inferior.patch
--- php-5.6.7.orig/fink/patches/giconv_is_inferior.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/giconv_is_inferior.patch	2013-10-11 11:23:49.000000000 -0600
@@ -0,0 +1,60 @@
+--- php-5.4.3.orig/acinclude.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/acinclude.m4	2012-06-12 15:48:09.000000000 -0600
+@@ -2475,14 +2475,14 @@
+   if test "$found_iconv" = "no"; then
+ 
+     for i in $PHP_ICONV /usr/local /usr; do
+-      if test -r $i/include/giconv.h; then
+-        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
++      if test -r $i/include/iconv.h; then
+         ICONV_DIR=$i
+-        iconv_lib_name=giconv
++        iconv_lib_name=iconv
+         break
+-      elif test -r $i/include/iconv.h; then
++      elif test -r $i/include/giconv.h; then
++        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
+         ICONV_DIR=$i
+-        iconv_lib_name=iconv
++        iconv_lib_name=giconv
+         break
+       fi
+     done
+--- php-5.4.3.orig/aclocal.m4	2012-05-08 00:19:30.000000000 -0600
++++ php-5.4.3.old/aclocal.m4	2012-06-12 15:49:10.000000000 -0600
+@@ -2475,14 +2475,14 @@
+   if test "$found_iconv" = "no"; then
+ 
+     for i in $PHP_ICONV /usr/local /usr; do
+-      if test -r $i/include/giconv.h; then
+-        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
++      if test -r $i/include/iconv.h; then
+         ICONV_DIR=$i
+-        iconv_lib_name=giconv
++        iconv_lib_name=iconv
+         break
+-      elif test -r $i/include/iconv.h; then
++      elif test -r $i/include/giconv.h; then
++        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
+         ICONV_DIR=$i
+-        iconv_lib_name=iconv
++        iconv_lib_name=giconv
+         break
+       fi
+     done
+--- php-5.4.3.orig/ext/iconv/config.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/ext/iconv/config.m4	2012-06-12 15:50:36.000000000 -0600
+@@ -31,10 +31,10 @@
+     CFLAGS="-I$PHP_ICONV_PREFIX/include $CFLAGS"
+     LDFLAGS="-L$PHP_ICONV_PREFIX/$PHP_LIBDIR $LDFLAGS"
+ 
+-    if test -r "$PHP_ICONV_PREFIX/include/giconv.h"; then
+-      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/giconv.h"
+-    else
++    if test -r "$PHP_ICONV_PREFIX/include/iconv.h"; then
+       PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/iconv.h"
++    else
++      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/giconv.h"
+     fi 
+ 
+     AC_MSG_CHECKING([if iconv is glibc's])
diff -ruN php-5.6.7.orig/fink/patches/php-5.2.4-embed.patch php-5.6.7/fink/patches/php-5.2.4-embed.patch
--- php-5.6.7.orig/fink/patches/php-5.2.4-embed.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/php-5.2.4-embed.patch	2015-04-29 12:29:44.000000000 -0600
@@ -0,0 +1,33 @@
+--- a/sapi/embed/config.m4
++++ b/sapi/embed/config.m4
+@@ -12,7 +12,8 @@ if test "$PHP_EMBED" != "no"; then
+   case "$PHP_EMBED" in
+     yes|shared)
+       PHP_EMBED_TYPE=shared
+-      INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)\$(prefix)/lib; \$(INSTALL) -m 0755 $SAPI_SHARED \$(INSTALL_ROOT)\$(prefix)/lib"
++      EXTRA_LDFLAGS_DARWIN="-dynamiclib -version-info \$(PHP_MAJOR_VERSION):\$(PHP_MINOR_VERSION) -L@FINKPREFIX@/lib"
++      INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)\$(prefix)/lib; \$(LIBTOOL) --mode=install \$(INSTALL) -m 0755 \$(OVERALL_TARGET) \$(INSTALL_ROOT)\$(prefix)/lib"
+       ;;
+     static)
+       PHP_EMBED_TYPE=static
+--- a/Makefile.global	2012-06-12 22:54:23.000000000 -0600
++++ b/Makefile.global	2012-06-15 20:16:37.000000000 -0600
+@@ -16,7 +16,7 @@
+ build-binaries: $(PHP_BINARIES)
+ 
+ libphp$(PHP_MAJOR_VERSION).la: $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS)
+-	$(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(EXTRA_CFLAGS) -rpath $(phptempdir) $(EXTRA_LDFLAGS) $(LDFLAGS) $(PHP_RPATHS) $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS) $(EXTRA_LIBS) $(ZEND_EXTRA_LIBS) -o $@
++	$(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(EXTRA_CFLAGS) -rpath $(prefix)/lib $(EXTRA_LDFLAGS_DARWIN) $(LDFLAGS) $(PHP_RPATHS) $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS) $(EXTRA_LIBS) $(ZEND_EXTRA_LIBS) -o $@
+ 	-@$(LIBTOOL) --silent --mode=install cp $@ $(phptempdir)/$@ >/dev/null 2>&1
+ 
+ libs/libphp$(PHP_MAJOR_VERSION).bundle: $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS)
+--- a/configure.in	2012-06-12 22:54:23.000000000 -0600
++++ b/configure.in	2012-06-16 11:05:07.000000000 -0600
+@@ -1345,6 +1345,7 @@
+ PHP_SUBST_OLD(DEBIAN_PHP_API)
+ PHP_SUBST_OLD(EXTENSION_DIR)
+ PHP_SUBST_OLD(EXTRA_LDFLAGS)
++PHP_SUBST_OLD(EXTRA_LDFLAGS_DARWIN)
+ PHP_SUBST_OLD(EXTRA_LDFLAGS_PROGRAM)
+ PHP_SUBST_OLD(EXTRA_LIBS)
+ PHP_SUBST_OLD(ZEND_EXTRA_LIBS)
diff -ruN php-5.6.7.orig/fink/patches/php-5.3.9-mysqlnd.patch php-5.6.7/fink/patches/php-5.3.9-mysqlnd.patch
--- php-5.6.7.orig/fink/patches/php-5.3.9-mysqlnd.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/php-5.3.9-mysqlnd.patch	2015-04-29 10:04:03.000000000 -0600
@@ -0,0 +1,22 @@
+--- php5.orig/ext/mysqlnd/mysqlnd.c
++++ php5/ext/mysqlnd/mysqlnd.c
+@@ -946,7 +946,7 @@ MYSQLND_METHOD(mysqlnd_conn_data, connec
+ 		if (host_len == sizeof("localhost") - 1 && !strncasecmp(host, "localhost", host_len)) {
+ 			DBG_INF_FMT("socket=%s", socket_or_pipe? socket_or_pipe:"n/a");
+ 			if (!socket_or_pipe) {
+-				socket_or_pipe = "/tmp/mysql.sock";
++				socket_or_pipe = "@FINKPREFIX@/var/run/mysqld/mysqld.sock";
+ 			}
+ 			transport_len = mnd_sprintf(&transport, 0, "unix://%s", socket_or_pipe);
+ 			unix_socket = TRUE;
+--- php5.orig/ext/pdo_mysql/pdo_mysql.c
++++ php5/ext/pdo_mysql/pdo_mysql.c
+@@ -50,7 +50,7 @@ ZEND_DECLARE_MODULE_GLOBALS(pdo_mysql)
+ #  define PDO_MYSQL_UNIX_ADDR PHP_MYSQL_UNIX_SOCK_ADDR
+ # else
+ #  if !PHP_WIN32
+-#   define PDO_MYSQL_UNIX_ADDR "/tmp/mysql.sock"
++#   define PDO_MYSQL_UNIX_ADDR "@FINKPREFIX@/var/run/mysqld/mysqld.sock"
+ #  else
+ #   define PDO_MYSQL_UNIX_ADDR NULL
+ #  endif
diff -ruN php-5.6.7.orig/fink/patches/php-fpm-listen-on-unix-socket.patch php-5.6.7/fink/patches/php-fpm-listen-on-unix-socket.patch
--- php-5.6.7.orig/fink/patches/php-fpm-listen-on-unix-socket.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/php-fpm-listen-on-unix-socket.patch	2015-04-29 10:10:17.000000000 -0600
@@ -0,0 +1,11 @@
+--- php5.orig/sapi/fpm/php-fpm.conf.in
++++ php5/sapi/fpm/php-fpm.conf.in
+@@ -165,7 +165,7 @@ group = @php_fpm_group@
+ ;                            (IPv6 and IPv4-mapped) on a specific port;
+ ;   '/path/to/unix/socket' - to listen on a unix socket.
+ ; Note: This value is mandatory.
+-listen = 127.0.0.1:9000
++listen = @FINKPREFIX@/var/run/php5-fpm.sock
+ 
+ ; Set listen(2) backlog.
+ ; Default Value: 65535 (-1 on FreeBSD and OpenBSD)
diff -ruN php-5.6.7.orig/fink/patches/session_save_path.patch php-5.6.7/fink/patches/session_save_path.patch
--- php-5.6.7.orig/fink/patches/session_save_path.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/patches/session_save_path.patch	2015-04-29 09:57:50.000000000 -0600
@@ -0,0 +1,40 @@
+Description: Set the default session.save_path dir to /var/lib/php5.
+ This is the directory that has been used in Debian to store the
+ session files and is partially protected by dir permissions.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-05-01
+
+--- php5.orig/ext/session/session.c
++++ php5/ext/session/session.c
+@@ -782,7 +782,7 @@ static ZEND_INI_MH(OnUpdateSmartStr) /*
+ /* {{{ PHP_INI
+  */
+ PHP_INI_BEGIN()
+-	STD_PHP_INI_ENTRY("session.save_path",          "",          PHP_INI_ALL, OnUpdateSaveDir,save_path,          php_ps_globals,    ps_globals)
++	STD_PHP_INI_ENTRY("session.save_path",          "@FINKPREFIX@/var/lib/php5/sessions",          PHP_INI_ALL, OnUpdateSaveDir,save_path,          php_ps_globals,    ps_globals)
+ 	STD_PHP_INI_ENTRY("session.name",               "PHPSESSID", PHP_INI_ALL, OnUpdateName, session_name,       php_ps_globals,    ps_globals)
+ 	PHP_INI_ENTRY("session.save_handler",           "files",     PHP_INI_ALL, OnUpdateSaveHandler)
+ 	STD_PHP_INI_BOOLEAN("session.auto_start",       "0",         PHP_INI_PERDIR, OnUpdateBool,   auto_start,         php_ps_globals,    ps_globals)
+--- php5.orig/php.ini-development
++++ php5/php.ini-development
+@@ -1420,7 +1420,7 @@ session.save_handler = files
+ ; where MODE is the octal representation of the mode. Note that this
+ ; does not overwrite the process's umask.
+ ; http://php.net/session.save-path
+-;session.save_path = "/tmp"
++;session.save_path = "@FINKPREFIX@/var/lib/php5/sessions"
+ 
+ ; Whether to use strict session mode.
+ ; Strict session mode does not accept uninitialized session ID and regenerate
+--- php5.orig/php.ini-production
++++ php5/php.ini-production
+@@ -1371,7 +1371,7 @@ session.save_handler = files
+ ; where MODE is the octal representation of the mode. Note that this
+ ; does not overwrite the process's umask.
+ ; http://php.net/session.save-path
+-;session.save_path = "/tmp"
++;session.save_path = "@FINKPREFIX@/var/lib/php5/sessions"
+ 
+ ; Whether to use strict session mode.
+ ; Strict session mode does not accept uninitialized session ID and regenerate
diff -ruN php-5.6.7.orig/fink/php5-fpm.init php-5.6.7/fink/php5-fpm.init
--- php-5.6.7.orig/fink/php5-fpm.init	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/php5-fpm.init	2015-04-29 10:19:38.000000000 -0600
@@ -0,0 +1,168 @@
+#!/bin/sh
+### BEGIN INIT INFO
+# Provides:          php-fpm php5-fpm
+# Required-Start:    $remote_fs $network
+# Required-Stop:     $remote_fs $network
+# Default-Start:     2 3 4 5
+# Default-Stop:      0 1 6	
+# Short-Description: starts php5-fpm
+# Description:       Starts The PHP FastCGI Process Manager Daemon
+### END INIT INFO
+
+# Author: Ondrej Sury <ondrej@debian.org>
+
+PATH=@FINKPREFIX@/sbin:@FINKPREFIX@/bin
+DESC="PHP5 FastCGI Process Manager"
+NAME=php5-fpm
+DAEMON=@FINKPREFIX@/sbin/$NAME
+DAEMON_ARGS="--daemonize --fpm-config @FINKPREFIX@/etc/php5/fpm/php-fpm.conf"
+CONF_PIDFILE=$(sed -n 's/^pid[ =]*//p' @FINKPREFIX@/etc/php5/fpm/php-fpm.conf)
+PIDFILE=${CONF_PIDFILE:-/run/php5-fpm.pid}
+TIMEOUT=30
+SCRIPTNAME=@FINKPREFIX@/sbin/${NAME}ctl
+
+# Exit if the package is not installed
+[ -x "$DAEMON" ] || exit 0
+
+# Read configuration variable file if it is present
+[ -r @FINKPREFIX@/etc/default/$NAME ] && . @FINKPREFIX@/etc/default/$NAME
+
+#
+# Function to check the correctness of the config file
+#
+do_check()
+{
+    @FINKPREFIX@/lib/php5/php5-fpm-checkconf || return 1
+    return 0
+}
+
+#
+# Function that starts the daemon/service
+#
+do_start()
+{
+	# Return
+	#   0 if daemon has been started
+	#   1 if daemon was already running
+	#   2 if daemon could not be started
+	start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON --test > /dev/null \
+		|| return 1
+	start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON -- \
+		$DAEMON_ARGS 2>/dev/null \
+		|| return 2
+	# Add code here, if necessary, that waits for the process to be ready
+	# to handle requests from services started subsequently which depend
+	# on this one.  As a last resort, sleep for some time.
+}
+
+#
+# Function that stops the daemon/service
+#
+do_stop()
+{
+	# Return
+	#   0 if daemon has been stopped
+	#   1 if daemon was already stopped
+	#   2 if daemon could not be stopped
+	#   other if a failure occurred
+	start-stop-daemon --stop --quiet --retry=QUIT/$TIMEOUT/TERM/5/KILL/5 --pidfile $PIDFILE --name $NAME
+	RETVAL="$?"
+	[ "$RETVAL" = 2 ] && return 2
+	# Wait for children to finish too if this is a daemon that forks
+	# and if the daemon is only ever run from this initscript.
+	# If the above conditions are not satisfied then add some other code
+	# that waits for the process to drop all resources that could be
+	# needed by services started subsequently.  A last resort is to
+	# sleep for some time.
+	start-stop-daemon --stop --quiet --oknodo --retry=0/30/TERM/5/KILL/5 --exec $DAEMON
+	[ "$?" = 2 ] && return 2
+	# Many daemons don't delete their pidfiles when they exit.
+	rm -f $PIDFILE
+	return "$RETVAL"
+}
+
+#
+# Function that sends a SIGHUP to the daemon/service
+#
+do_reload() {
+	#
+	# If the daemon can reload its configuration without
+	# restarting (for example, when it is sent a SIGHUP),
+	# then implement that here.
+	#
+	start-stop-daemon --stop --signal USR2 --quiet --pidfile $PIDFILE --name $NAME
+	return 0
+}
+
+case "$1" in
+    start)
+	[ "$VERBOSE" != no ] && echo -n "Starting $DESC "
+	do_check $VERBOSE
+	case "$?" in
+	    0)
+		do_start
+		case "$?" in
+		    0|1) [ "$VERBOSE" != no ] && echo "OK" ;;
+		    2) [ "$VERBOSE" != no ] && echo "Fail" ;;
+		esac
+		;;
+	    1) [ "$VERBOSE" != no ] && echo "Fail" ;;
+	esac
+	;;
+    stop)
+	[ "$VERBOSE" != no ] && echo -n "Stopping $DESC "
+	do_stop
+	case "$?" in
+		0|1) [ "$VERBOSE" != no ] && echo "OK" ;;
+		2) [ "$VERBOSE" != no ] && echo "Fail" ;;
+	esac
+	;;
+    status)
+        status_of_proc "$DAEMON" "$NAME" && exit 0 || exit $?
+        ;;
+    check)
+        do_check yes
+	;;
+    reload|force-reload)
+	echo "Reloading $DESC "
+	do_reload
+	case "$?" in
+		0|1) echo "OK" ;;
+		2) echo "Fail" ;;
+	esac
+	;;
+    reopen-logs)
+	echo "Reopening $DESC logs "
+	if start-stop-daemon --stop --signal USR1 --oknodo --quiet \
+	    --pidfile $PIDFILE --exec $DAEMON
+	then
+	    echo "Fail"
+	else
+	    echo "OK"
+	fi
+	;;
+    restart)
+	echo "Restarting $DESC "
+	do_stop
+	case "$?" in
+	  0|1)
+		do_start
+		case "$?" in
+			0) echo "OK" ;;
+			1) echo "Fail" ;; # Old process is still running
+			*) echo "Fail" ;; # Failed to start
+		esac
+		;;
+	  *)
+	  	# Failed to stop
+		echo "Fail"
+		;;
+	esac
+	;;
+    *)
+	echo "Usage: $SCRIPTNAME {start|stop|status|restart|reload|force-reload}" >&2
+	exit 1
+    ;;
+esac
+
+:
diff -ruN php-5.6.7.orig/fink/php5.conf php-5.6.7/fink/php5.conf
--- php-5.6.7.orig/fink/php5.conf	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/php5.conf	2015-04-29 10:17:31.000000000 -0600
@@ -0,0 +1,25 @@
+<FilesMatch ".+\.ph(p[345]?|t|tml)$">
+    SetHandler application/x-httpd-php
+</FilesMatch>
+<FilesMatch ".+\.phps$">
+    SetHandler application/x-httpd-php-source
+    # Deny access to raw php sources by default
+    # To re-enable it's recommended to enable access to the files
+    # only in specific virtual host or directory
+    Require all denied
+</FilesMatch>
+# Deny access to files without filename (e.g. '.php')
+<FilesMatch "^\.ph(p[345]?|t|tml|ps)$">
+    Require all denied
+</FilesMatch>
+
+# Running PHP scripts in user directories is disabled by default
+# 
+# To disenable PHP in user directories uncomment the following lines
+# (from <IfModule ...> to </IfModule>.) Do NOT set it to On as it
+# prevents .htaccess files from disabling it.
+#<IfModule mod_userdir.c>
+#    <Directory /Users/*/Sites>
+#        php_admin_flag engine Off
+#    </Directory>
+#</IfModule>
diff -ruN php-5.6.7.orig/fink/setup-mysql.sh php-5.6.7/fink/setup-mysql.sh
--- php-5.6.7.orig/fink/setup-mysql.sh	1969-12-31 17:00:00.000000000 -0700
+++ php-5.6.7/fink/setup-mysql.sh	2013-08-13 21:06:13.000000000 -0600
@@ -0,0 +1,78 @@
+#!/bin/sh
+
+set -eu
+
+[ $# -ge 2 ] || {
+    echo "Usage: fink/setup-mysql.sh port data-dir" >&2
+    exit 1
+}
+
+# CLI arguments #
+port=$1
+datadir=$2
+action=${3:-start}
+if [ "$(id -u)" -eq 0 ]; then
+    user="mysql"
+else
+    user="$(whoami)"
+fi
+
+# Some vars #
+
+socket=$datadir/mysql.sock
+# Commands:
+mysqladmin="mysqladmin --no-defaults --user root --port $port --host 127.0.0.1 --socket=$socket --no-beep"
+mysqld="@FINKPREFIX@/sbin/mysqld --no-defaults --user=$user --bind-address=127.0.0.1 --port=$port --socket=$socket --datadir=$datadir"
+
+# Main code #
+
+if [ "$action" = "stop" ]; then
+    $mysqladmin shutdown
+    exit
+fi
+
+rm -rf $datadir
+mkdir -p $datadir
+chmod go-rx $datadir
+chown $user: $datadir
+
+mysql_install_db --no-defaults --user=$user --datadir=$datadir --rpm --force
+
+tmpf=$(gmktemp)
+cat > "$tmpf" <<EOF
+USE mysql;
+UPDATE user SET password=PASSWORD('') WHERE user='root';
+FLUSH PRIVILEGES;
+EOF
+
+$mysqld --bootstrap --skip-grant-tables < "$tmpf"
+
+unlink "$tmpf"
+
+# Start the daemon
+$mysqld &
+
+pid=$!
+
+# Wait for the server to be actually available
+c=0;
+while ! nc -z 127.0.0.1 $port; do
+    c=$(($c+1));
+    sleep 3;
+    if [ $c -gt 20 ]; then
+	echo "Timed out waiting for mysql server to be available" >&2
+	if [ "$pid" ]; then
+	    kill $pid || :
+	    sleep 2
+	    kill -s KILL $pid || :
+	fi
+	exit 1
+    fi
+done
+
+# Check if the server is running
+$mysqladmin status
+# Drop the database if it exists
+$mysqladmin --force --silent drop test || true
+# Create new empty database
+$mysqladmin create test
