diff -ruN php-5.5.1.orig/fink/debhelper/dh_php5 php-5.5.1/fink/debhelper/dh_php5
--- php-5.5.1.orig/fink/debhelper/dh_php5	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/debhelper/dh_php5	2013-08-08 09:43:29.000000000 -0600
@@ -0,0 +1,430 @@
+#! /usr/bin/perl
+
+# dh_php5 - PHP 5 configuration helper for debhelper
+# Copyright (C) 2012 Arno Töll <debian@toell.net>
+#               2013 Ondřej Surý <ondrej@sury.org>
+#
+# This program is licensed at your choice under the terms of the GNU General
+# Public License vserion 2+ or under the terms of the Apache Software License
+# 2.0.
+#
+# For GPL-2+:
+# This program is free software; you can redistribute it and/or
+# modify it under the terms of the GNU General Public License
+# as published by the Free Software Foundation; either version 2
+# of the License, or (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+#
+# For ASF 2.0:
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+use strict;
+use File::Find;
+use Debian::Debhelper::Dh_Lib;
+
+
+=head1 NAME
+
+dh_php5 - register configuration snippets to the PHP 5
+
+=cut
+
+# auto-generated do not edit
+our $API = `php-config --phpapi`;
+our $MODULE_DIR = `php-config --extension-dir`;
+our $SERVER_VERSION = `php-config --version`;
+
+
+
+sub php5_api_version
+{
+	return "phpapi-$API";
+}
+
+
+sub php5_version
+{
+	return ">= $SERVER_VERSION~";
+}
+
+sub php5_api_installdir
+{
+	return $MODULE_DIR;
+}
+
+sub php5_conf_installdir
+{
+	my $type = shift;
+	return "@FINKPREFIX@/etc/php5/${type}-available/"
+}
+
+=head1 SYNOPSIS
+
+B<dh_php5> [S<I<debhelper options>>] [S<B<--conditional>>=I<expression>] [B<--error-handler=>I<function>] [B<-n>|B<--noscripts>]
+
+=head1 DESCRIPTION
+
+B<dh_php5> is a debhelper program that is responsible for correctly installing
+Php5 configuration snippets and setting postinst, prerm and dependencies in
+Php5 web server modules and web applications.
+
+It supports the following configuration types
+
+=over 4
+
+=item *
+PHP 5 modules
+
+=item *
+PHP 5 configuration snippets
+
+=back
+
+B<dh_php5> supports two modes: A limited auto-configuration heuristic or
+alternatively a configuration file driven approach. If a file named
+debian/package.php5 exists, actual actions are determined by that file.
+
+=head1 OPERATION MODES
+
+B<dh_php5> can be used in two modes: A configuration file driven approach and
+a heuristic approach. The configuration driven mode is fully documented in the
+B<FILES> section below. This mode is activated by supplying a L<debhelper(7)>
+configuration file (e.g. debian/I<package>.php5).
+
+The alternative is a heuristic mode, in which no files are installed through
+B<dh_php5>. Instead the helper will scan the package installation directory
+for recognized files and guess their purpose depending on their installation
+path in the file system. Use with caution.
+
+=head1 INVOKATION
+
+B<dh_php5> is not part of debhelper and might require information available
+in the php5-dev package. Packages making use of B<dh_php5> should declare
+a build-dependency against the virtual B<dh-php5> package.
+
+B<dh_php5> supports both, called directly from a debian/rules file or as
+L<dh(1)> addon. In the former case the helper should run after L<dh_install(1)>
+or their respective counter parts in local implementations at earliest.
+Alternatively it can be used as L<dh> addon by invoking it with
+
+  %:
+     dh $@ --with php5
+
+=head1 FILES
+
+=over 4
+
+=item debian/I<package>.php5
+
+=item debian/php5
+
+=back
+
+Lists files to be registered with the PHP 5. The file is interpreted
+as line separated list of installation stanzas, where each entry
+consists of whitespace separated values conforming to the file
+semantics below.
+
+=head2 FILE SEMANTICS
+
+Each line consists of a triple
+
+I<type> I<file> [I<arguments>]
+
+where the values are interpreted as follows:
+
+
+=head3 I<type>
+
+Denotes the type of file to be installed. Recognized values are B<conf>
+for PHP 5 global configuration snippets and B<mod> for PHP 5 modules.
+
+=head3 I<file>
+
+Is interpreted as existing file name within the source package. No path
+expansion is effectuated. Just like L<dh_install(1)>, B<dh_php5> can not
+rename files.
+
+=head2 GLOBAL CONFIGURATION FILES
+
+Global configuration files (determined by the B<conf> type) must have a I<.conf>
+suffix and are installed to I<@FINKPREFIX@/etc/php5/conf-available>. Moreover, the
+configuration is activated in the maintainer script at installation time.
+
+Such global configuration snippets are supposed to be used by web applications.
+Such stanzas accept an optional third I<arguments> which is interpreted as
+dependency line of alternative web servers the package supports. See I<EXAMPLES>
+below.
+
+B<dh_php5> will set dependencies in B<${misc:Recommends}> accordingly when
+this type of configuration is found. Alternatives from the optional I<argument>
+is incorporated into this dependency line.
+
+=head2 MODULES
+
+Modules are handled specially and are determined by the B<mod> type. Modules can
+either have a I<.conf> or I<.load> suffix.  In that case the file is interpreted
+as module load file or module configuration file respectively and is installed to
+I<@FINKPREFIX@/etc/php5/mods-available>.  If the file is ending with a I<.so> suffix it is
+interpreted as actual module shared object and is installed to the PHP 5 module
+directory.  Moreover, if a I<.load> file is installed the configuration is
+activated in the maintainer script at installation time.
+
+A typical module configuration has two lines, one for the I<.load> file, and one
+for the I<.so> file, albeit the latter could be installed by upstream's
+makefile, too.
+
+B<dh_php5> will set dependencies in B<${misc:Depends}> accordingly when
+this type of configuration is found.
+
+=head1 OPTIONS
+
+=over 4
+
+=item B<--error-handler=>I<function>
+
+Call the named shell I<function> if running the maintainer script fails.  The
+function should be provided in the F<prerm> and F<postinst> scripts, before the
+B<#DEBHELPER#> token.
+
+=item B<-e>, B<--noenable>
+
+Install maintainer scripts accordingly, but do not enable the scripts or
+configuration by default.
+
+=item B<-n>, B<--noscripts>
+
+Do not modify F<postinst>/F<postrm>/F<prerm> maintainer scripts.
+
+
+=back
+
+=head1 NOTES
+
+Note that this command is not idempotent.  L<dh_prep(1)> should be called
+between invocations of this command.  Otherwise, it may cause multiple
+instances of the same text to be added to maintainer scripts.
+
+=head1 EXAMPLES
+
+The examples below lists valid entries for a fink/I<package>.php5 file.  For
+example, the two lines below install a fictional I<mod_foo> PHP 5 module along
+a Fink specific I<.ini> file:
+
+ mod src/foo/mod_foo.so
+ mod fink/foo.ini
+
+=head1 SEE ALSO
+
+L<php5ctl>(8), L<php5query>(8), L<debhelper>(7), L<dh>(1)
+
+=head1 AUTHOR
+
+This manual and L<dh_php5> was written by Arno Toell <debian@toell.net>
+for Apache 2 and modified for PHP 5 by Ondřej Surý <ondrej@sury.org>.
+
+=cut
+
+
+##
+## main code starts here
+##
+
+init(options => {
+	"e|noenable" => \$dh{NOENABLE},
+});
+
+foreach my $package ((@{$dh{DOPACKAGES}}))
+{
+	my %PACKAGE_TYPE = (
+		has_a_module => [],
+		has_a_conf_file => [],
+		dependency_line => "",
+		handler => $dh{ERROR_HANDLER},
+	);
+
+	my $file = pkgfile($package, "php5");
+	my $tmp  = tmpdir($package);
+
+	my @files_to_register = filedoublearray($file, ".") if $file;
+	foreach my $line (@files_to_register)
+	{
+		my $type = lc(shift @{$line}) if $line->[0];
+		my $source = shift @{$line} if $line->[0];
+		my @arguments = map {"$_ "} @{$line};
+
+		$type .= "s" unless $type eq "conf";
+		my $installdir = $tmp . "/" . php5_conf_installdir($type);
+
+		if ($type eq "mods" or $type eq "conf")
+		{
+			my $basesource = basename($source);
+
+			if ($type eq "mods")
+			{
+				if ($basesource =~ m/\.ini$/)
+				{
+					my $enablename = $basesource;
+					$enablename =~ s/\.ini$//;
+					push @{$PACKAGE_TYPE{'has_a_module'}}, $enablename;
+					verbose_print("Installing module configuration $enablename into $installdir\n");
+				}
+				elsif ($basesource =~ m/\.so$/)
+				{
+					my $modinstalldir = $tmp . "/" . php5_api_installdir();
+					verbose_print("Installing module binary $source into $modinstalldir\n");
+					if (! -d $modinstalldir)
+					{
+						complex_doit("mkdir","-p", $modinstalldir);
+						complex_doit("chmod","755","$modinstalldir");
+					}
+					complex_doit("cp", $source, $modinstalldir);
+					next;
+				}
+
+				error("module: \"$basesource\" needs .so or .ini suffix") if $basesource !~ m/\.(ini|so)/;
+			}
+
+			if (! -d $installdir)
+			{
+				complex_doit("mkdir","-p",$installdir);
+				complex_doit("chmod","755","$installdir");
+			}
+			complex_doit("cp",$source,$installdir);
+			complex_doit("chmod","644","$installdir/$basesource");
+
+		}
+		else
+		{
+			error("Unknown parameter: $type\n");
+		}
+
+	}
+
+
+	if (! $file)
+	{
+		# do black magic only if there is no .php5 configuration file
+		find({  no_chdir => 1,
+			wanted => sub
+			{
+				my ($dir, $file) = (dirname($File::Find::name), basename($File::Find::name));
+				# remove extension
+				my $conf_name = $file;
+				$conf_name =~ s/\.[^.]+$//;
+
+				if ($dir =~ m#@FINKPREFIX@/etc/php5/mods-available# and $file =~ m#.(load|conf)$#)
+				{
+					verbose_print("package $package appears	to be a web server module\n");
+					push @{$PACKAGE_TYPE{'has_a_module'}}, $conf_name if $file =~ m/\.load/;
+				}
+				if ($dir =~ m#@FINKPREFIX@/etc/php5/conf-available# and $file =~ m#.conf$#)
+				{
+					verbose_print("package $package appears	to contain a global configuration file \n");
+					push @{$PACKAGE_TYPE{'has_a_conf_file'}}, $conf_name;
+				}
+
+
+
+		}}, tmpdir($package));
+	}
+
+
+	my @postinst_autoscripts;
+
+	if ($#{$PACKAGE_TYPE{'has_a_module'}} >= 0)
+	{
+		if ($package !~ m/php5-\w+?/)
+		{
+			warning("Package $package appears to be an PHP 5 module. It should comply to the package naming scheme php5-<modulename>\n");
+		}
+		addsubstvar($package, "misc:Depends", php5_api_version());
+
+		my $modules = "";
+		foreach my $module (@{$PACKAGE_TYPE{'has_a_module'}})
+		{
+			$modules .= "$module ";
+		}
+
+		push @postinst_autoscripts, ["enmod", $modules];
+	}
+
+	if ($#{$PACKAGE_TYPE{'has_a_conf_file'}} >= 0)
+	{
+		$PACKAGE_TYPE{'dependency_line'} .= "| php5";
+		addsubstvar($package, "misc:Recommends", "php5 (" . php5_version() . ") " . $PACKAGE_TYPE{'dependency_line'} );
+
+		my $confs = "";
+
+		foreach my $conf (@{$PACKAGE_TYPE{'has_a_conf_file'}})
+		{
+			$confs .= "$conf ";
+		}
+
+		if ($confs)
+		{
+			push @postinst_autoscripts, ["enconf", $confs];
+		}
+	}
+
+	if (! $dh{NOSCRIPTS})
+	{
+		foreach my $ref (@postinst_autoscripts)
+		{
+			for my $script_type (qw/postinst prerm postrm/)
+			{
+				if ($script_type eq "postinst" &&  $dh{NOENABLE})
+				{
+					next
+				}
+
+				my %replacements = (
+					HELPER => $ref->[0],
+					NAMES  => $ref->[1],
+					ERROR_HANDLER => $PACKAGE_TYPE{handler}
+				);
+
+				if ($script_type eq "prerm" || $script_type eq "postrm")
+				{
+					$replacements{'HELPER'} =~ s/en/dis/;
+				}
+
+				my $sed_command = "";
+				foreach my $key (sort keys %replacements)
+				{
+					my $val = $replacements{$key};
+					# Use a control char as separator for sed, to
+					# reduce escaping issues. Everything else is
+					# passed verbatim, i.e. it must not contain any
+					# shell or sed special characters.
+					my $sep = "\x17";
+					$sed_command .= "s" . $sep . "#$key#" .
+							      $sep . $val .
+							      $sep . "g; ";
+				}
+
+				autoscript($package, "$script_type", "$script_type-php5", $sed_command);
+			}
+		}
+	}
+}
+
+# vim: syntax=perl sw=8 sts=8 sr noet
diff -ruN php-5.5.1.orig/fink/debhelper/php5-maintscript-helper php-5.5.1/fink/debhelper/php5-maintscript-helper
--- php-5.5.1.orig/fink/debhelper/php5-maintscript-helper	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/debhelper/php5-maintscript-helper	2013-08-08 09:45:36.000000000 -0600
@@ -0,0 +1,279 @@
+# php5-maintscript-helper - Php5 helper function for maintainer scripts
+# Copyright (C) 2012 Arno Töll <debian@toell.net>
+#               2013 Ondřej Surý <ondrej@sury.org>
+#
+# Permission is hereby granted, free of charge, to any person obtaining a copy of
+# this software and associated documentation files (the "Software"), to deal in
+# the Software without restriction, including without limitation the rights to
+# use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
+# the Software, and to permit persons to whom the Software is furnished to do so,
+# subject to the following conditions:
+#
+# The above copyright notice and this permission notice shall be included in all
+# copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
+# FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
+# COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
+# IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+# CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+
+
+#
+# VARIABLES
+#
+
+
+# global environment variables used by php5-maintscript-helper:
+# * PHP5_MAINTSCRIPT_DEBUG:
+#				set this to any non-zero value to get debug output
+# * PHP5_MAINTSCRIPT_HELPER_QUIET:
+#				set this to any non-zero value to omit any output
+# * EXPORT_PHP5_MAINTSCRIPT_HELPER:
+#				will be defined by php5-maintscript-helper
+#				to avoid inclusion loops. Do not set this
+#				variable manually
+# * PHP5_NEED_ACTION:
+#				will be defined if a function call wants to
+#				override the behavior of php5_needs_action.
+#				Do not rely on this variable. It is considered
+#				an implementation detail.
+# * PHP5_MAINTSCRIPT_NAME
+# * PHP5_MAINTSCRIPT_PACKAGE
+# * PHP5_MAINTSCRIPT_METHOD
+# * PHP5_MAINTSCRIPT_ARGUMENT
+#				these variables contain information about the
+#				maintainer script which is calling the
+#				maintscript-helper. It contains arguments which
+#				dpkg supplies to maintainer scripts and similar
+#				information. These variables are an
+#				implementation detail and not to be changed.
+#
+#				You might want to set them manually only if you
+#				are calling php5-maintscript-helper from
+#				some place which does not preserve the original
+#				script arguments for example when calling from
+#				a subfunction instead of the main function in
+#				your maintainer script
+
+#
+# INITIALIZATION
+#
+
+if [ -n "${EXPORT_PHP5_MAINTSCRIPT_HELPER:-}" ] ; then
+	return
+else
+	EXPORT_PHP5_MAINTSCRIPT_HELPER=1
+
+	if [ -n "${PHP5_MAINTSCRIPT_DEBUG:-}" ] ; then
+		set -x
+	fi
+
+	if [ -z "$1" ] ; then
+		echo "You must invoke php5-maintscript-helper with an unmodified environment when sourcing it" >&2
+		return 1
+	fi
+
+	PHP5_MAINTSCRIPT_NAME="$DPKG_MAINTSCRIPT_NAME"
+	[ "$PHP5_MAINTSCRIPT_NAME" ] || PHP5_MAINTSCRIPT_NAME="${0##*.}"
+
+	case "$PHP5_MAINTSCRIPT_NAME" in
+		preinst|prerm|postrm|postinst)
+			# yay - recognized script
+		;;
+		*)
+			echo "php5-maintscript-helper invoked from an unrecognized maintainer script: exiting" >&2
+			return 1
+		;;
+	esac
+
+	PHP5_MAINTSCRIPT_PACKAGE="$DPKG_MAINTSCRIPT_PACKAGE"
+	if [ -z "$PHP5_MAINTSCRIPT_PACKAGE" ]; then
+		PHP5_MAINTSCRIPT_PACKAGE="${0##*/}"
+		PHP5_MAINTSCRIPT_PACKAGE="${PHP5_MAINTSCRIPT_PACKAGE%.*}"
+	fi
+
+	if [ -z "$PHP5_MAINTSCRIPT_METHOD" ] ; then
+		PHP5_MAINTSCRIPT_METHOD="$1"
+	fi
+
+	case "$PHP5_MAINTSCRIPT_METHOD" in
+		install|upgrade|abort-upgrade|configure|abort-remove|abort-remove|abort-deconfigure|remove|failed-upgrade|purge|disappear|abort-install)
+			# yay - recognized script
+		;;
+		*)
+			echo "php5-maintscript-helper invoked from a modified environment. Please hint required arguments manually" >&2
+			return 1
+		;;
+	esac
+
+
+
+	if [ -z "$PHP5_MAINTSCRIPT_ARGUMENT" ] ; then
+		PHP5_MAINTSCRIPT_ARGUMENT="${2:-}"
+	fi
+
+fi
+
+#
+# FUNCTIONS
+#
+
+#
+# Function php5_msg
+#	print out a warning to both, the syslog and a local standard output.
+#	This function should generally be used to display messages related to
+#	the web server in maintainer scripts.
+# Parameters:
+#	priority
+#		The message priority. Recognized values are the same as defined
+#		by syslog(3), thus: one among debug, info, notice, warning,
+#		err, crit, alert, emerg.
+#		If no known priority is recognized, the priority is set to
+#		"warning".
+#	message
+#		The message as a string. It is printed out verbatim.
+# Behavior:
+#	No message is displayed if PHP5_MAINTSCRIPT_HELPER_QUIET is defined
+# Returns:
+#	this function always returns 0
+# Since: 5.5.0+dfsg-7
+php5_msg()
+{
+	local PRIORITY="$1"
+	local MSG="$2"
+	[ -z "$PHP5_MAINTSCRIPT_HELPER_QUIET" ] && echo "$MSG" >&2
+	[ -x /usr/bin/logger ] || return 0
+	case "$PRIORITY" in
+		debug|info|notice|warning|err|crit|alert|emerg)
+		;;
+		*)
+			PRIORITY="warning"
+		;;
+	esac
+	local LOGGER="/usr/bin/logger -p daemon.$PRIORITY -t $PHP5_MAINTSCRIPT_PACKAGE "
+	$LOGGER "$MSG" || return 0
+}
+
+#
+# Function php5_invoke
+#	invokes an Apache 2 configuration helper to enable or disable a
+#	particular piece of configuration, a site or a module. It carefully
+#	checks whether the supplied configuration snippet exists and reloads the
+#	web server if the site administrator desires that by call dpkg trigger
+#       @FINKPREFIX@/etc/php5/SAPI/conf.d which is defined for apache2, apache2filter and fpm.
+#
+# Parameters:
+#	command - The command to invoke. Recognized commands are "enconf",
+#		"enmod", "ensite", "disconf", "dismod", "dissite"
+#
+#       sapi - Either the specific SAPI (apache2, apache2filter, fpm,
+#              cgi, cli, embed) or ALL
+#
+#	arguments
+#		- A single argument (e.g. a module) which shall be
+#		  enabled or disabled respectively.
+#
+# Returns
+#	0 if the changes could be activated
+#	1 otherwise
+# Since: 5.5.0+dsfg-7
+php5_invoke()
+{
+    local CMD=$1
+    local SAPI=$2
+    local MOD=$3
+    local check_switch=""
+    local invoke_string=""
+    local rcd_action=""
+    local rcd_scripts=""
+    local sapi_list=""
+
+    [ -x "@FINKPREFIX@/sbin/php5$CMD" ] || return 1
+    [ -x "@FINKPREFIX@/sbin/php5query" ] || return 1
+
+    sapi_list="$SAPI"
+    case "$SAPI" in
+	apache2|apache2filter|fpm|cli|cgi|embed)
+	    ;;
+	ALL)
+	    sapi_list=$(php5query -S)
+	    case "$CMD" in
+		enmod|dismod)
+		    php5$CMD -q -m -r "$MOD" || return 1
+		    ;;
+		*)
+		    return 1
+		    ;;
+	    esac
+	    ;;
+	*)
+	    return 1
+	    ;;
+    esac
+
+    for SAPI in $sapi_list; do
+	case "$CMD" in
+	    enmod)
+		local php5query_ret=0
+		php5query -s "$SAPI" -m "$MOD" > /dev/null 2>&1 || php5query_ret=$?
+		if [ "$php5query_ret" -eq 0 ] ; then
+		    # configuration is already enabled
+ 		    php5$CMD -m -s "$SAPI" -q "$MOD" > /dev/null 2>&1 || return 1
+		    php5_msg "info" "php5_invoke $MOD: already enabled for $SAPI SAPI"
+		    PHP5_NEED_ACTION=1
+		elif [ "$php5query_ret" -eq 32	 ] ; then
+		    # the maintainer disabled the module
+		    php5_msg "info" "php5_invoke $MOD: no action - module was disabled by maintainer for $SAPI SAPI"
+		    return 0
+		else
+		    # coming here either means:
+		    # a) we have no clue about the module (e.g. for upgrades prior to maintscript-helper
+		    # b) it's a fresh install
+		    PHP5_NEED_ACTION=1
+ 		    php5$CMD -m -s "$SAPI" -q "$MOD" > /dev/null 2>&1 || return 1
+		    php5_msg "info" "php5_invoke: Enable module $MOD for $SAPI SAPI"
+		fi
+		;;
+	    dismod)
+		local php5query_ret=0
+		php5query -s "$SAPI" -m "$MOD" > /dev/null 2>&1 || php5query_ret=$?
+		if [ "$php5query_ret" -eq 0 ] ; then
+		    if [ "$PHP5_MAINTSCRIPT_NAME" = 'postrm' ] && [ "$PHP5_MAINTSCRIPT_METHOD" = "purge" ] ; then
+			php5$CMD -p -f -s "$SAPI" -q "$MOD" || return 1
+			php5_msg "info" "php5_invoke $PHP5_MAINTSCRIPT_NAME: Purging module $MOD for $SAPI SAPI"
+			PHP5_NEED_ACTION=1
+		    elif [ "$PHP5_MAINTSCRIPT_NAME" = 'postrm' ] || [ "$PHP5_MAINTSCRIPT_NAME" = 'prerm' ] ; then
+			if [ "$PHP5_MAINTSCRIPT_METHOD" = "remove" ] ; then
+			    php5$CMD -m -f -s "$SAPI" -q "$MOD" || return 1
+			    php5_msg "info" "php5_invoke $PHP5_MAINTSCRIPT_NAME: Disable module $MOD for $SAPI SAPI"
+			    PHP5_NEED_ACTION=1
+			fi
+		    else
+			php5_msg "error" "php5_invoke: module $MOD not supported in $PHP5_MAINTSCRIPT_NAME for $SAPI SAPI"
+			return 1
+		    fi
+		elif [ "$php5query_ret" -eq 32 ] || [ "$php5query_ret" -eq 33 ] ; then
+		    if [ "$PHP5_MAINTSCRIPT_NAME" = 'postrm' ] && [ "$PHP5_MAINTSCRIPT_METHOD" = "purge" ] ; then
+			php5_msg "info" "php5_invoke $PHP5_MAINTSCRIPT_NAME: Purging state for $MOD for $SAPI SAPI"
+			# this will return RC=1
+			( php5$CMD -p -f -s "$SAPI" -q "$MOD" > /dev/null 2>&1 )
+		    else
+			php5_msg "info" "php5_invoke $MOD $PHP5_MAINTSCRIPT_NAME: No action required for $SAPI SAPI"
+		    fi
+		else
+		    php5_msg "info" "php5_invoke $MOD $PHP5_MAINTSCRIPT_NAME: No action required for $SAPI SAPI"
+		fi
+		;;
+	    *)
+		return 1
+		;;
+	esac
+	if [ -n "${PHP_NEED_ACTION:-}" -a -n "$rcd_action" ]; then
+	    dpkg-trigger @FINKPREFIX@/etc/php5/$SAPI/conf.d
+	fi
+    done
+}
+
+# vim: syntax=sh sw=8 sts=8 sr noet
diff -ruN php-5.5.1.orig/fink/debhelper/php5.pm php-5.5.1/fink/debhelper/php5.pm
--- php-5.5.1.orig/fink/debhelper/php5.pm	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/debhelper/php5.pm	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,8 @@
+#!/usr/bin/perl
+use warnings;
+use strict;
+use Debian::Debhelper::Dh_Lib;
+
+insert_after("dh_install", "dh_php5");
+
+1;
diff -ruN php-5.5.1.orig/fink/debhelper/postinst-php5 php-5.5.1/fink/debhelper/postinst-php5
--- php-5.5.1.orig/fink/debhelper/postinst-php5	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/debhelper/postinst-php5	2013-08-08 09:46:01.000000000 -0600
@@ -0,0 +1,6 @@
+if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ] ; then
+    . @FINKPREFIX@/share/php5/php5-maintscript-helper
+    for conf in #NAMES# ; do
+        php5_invoke #HELPER# ALL $conf || #ERROR_HANDLER#
+    done
+fi
diff -ruN php-5.5.1.orig/fink/debhelper/postrm-php5 php-5.5.1/fink/debhelper/postrm-php5
--- php-5.5.1.orig/fink/debhelper/postrm-php5	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/debhelper/postrm-php5	2013-08-08 09:46:18.000000000 -0600
@@ -0,0 +1,9 @@
+if [ "$1" = "purge" ] ; then
+    if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ] ; then
+	. @FINKPREFIX@/share/php5/php5-maintscript-helper
+
+	for conf in #NAMES# ; do
+	    php5_invoke #HELPER# ALL $conf || #ERROR_HANDLER#
+	done
+    fi
+fi
diff -ruN php-5.5.1.orig/fink/debhelper/prerm-php5 php-5.5.1/fink/debhelper/prerm-php5
--- php-5.5.1.orig/fink/debhelper/prerm-php5	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/debhelper/prerm-php5	2013-08-08 09:46:32.000000000 -0600
@@ -0,0 +1,9 @@
+if [ "$1" = "remove" ] || [ "$1" = "deconfigure" ] ; then
+    if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ] ; then
+	. @FINKPREFIX@/share/php5/php5-maintscript-helper
+	
+	for conf in #NAMES# ; do
+	    php5_invoke #HELPER# ALL $conf || #ERROR_HANDLER#
+	done
+    fi
+fi
diff -ruN php-5.5.1.orig/fink/extramodulelist php-5.5.1/fink/extramodulelist
--- php-5.5.1.orig/fink/extramodulelist	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/extramodulelist	2013-08-08 09:38:11.000000000 -0600
@@ -0,0 +1,11 @@
+common ZendOpcache opcache 05 zend_extension
+mysql MySQL mysqli
+mysql MySQL pdo_mysql
+mysqlnd MySQL mysql
+mysqlnd MySQL mysqli
+mysqlnd MySQL pdo_mysql
+interbase InterBase/Firebird pdo_firebird
+odbc ODBC pdo_odbc
+pgsql PostgreSQL pdo_pgsql
+sqlite SQLite pdo_sqlite
+sybase Sybase pdo_dblib
diff -ruN php-5.5.1.orig/fink/libapache2-mod-php5.postinst.extra php-5.5.1/fink/libapache2-mod-php5.postinst.extra
--- php-5.5.1.orig/fink/libapache2-mod-php5.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/libapache2-mod-php5.postinst.extra	2013-08-13 10:42:18.000000000 -0600
@@ -0,0 +1,34 @@
+if [ -e @FINKPREFIX@/share/apache2/apache2-maintscript-helper ] ; then
+    . @FINKPREFIX@/share/apache2/apache2-maintscript-helper
+
+    php5_enable() {
+        if [ $(a2query -M) != 'prefork' ] ; then
+            if apache2_switch_mpm prefork ; then
+                return 0
+            else
+                apache2_msg err "Could not switch to prefork MPM, not enabling php5"
+                return 1
+            fi
+        fi
+        return 0
+    }
+
+else
+    echo "Warning: Could not load Apache 2.4 maintainer script helper."
+
+    php5_enable() {
+        return 1;
+    }
+
+fi
+
+# we've registered a trigger to handle extension updates.
+if [ "$1" = "triggered" ] && [ "$2" = "@FINKPREFIX@/etc/php5/apache2/conf.d" ]; then
+    if [ -e @FINKPREFIX@/share/apache2/apache2-maintscript-helper ]; then
+	. @FINKPREFIX@/share/apache2/apache2-maintscript-helper
+	apache2_reload restart
+    fi
+    exit 0
+elif [ "$1" != "configure" ]; then
+    exit 0
+fi
diff -ruN php-5.5.1.orig/fink/libapache2-mod-php5filter.postinst.extra php-5.5.1/fink/libapache2-mod-php5filter.postinst.extra
--- php-5.5.1.orig/fink/libapache2-mod-php5filter.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/libapache2-mod-php5filter.postinst.extra	2013-08-13 10:42:43.000000000 -0600
@@ -0,0 +1,34 @@
+if [ -e @FINKPREFIX@/share/apache2/apache2-maintscript-helper ] ; then
+    . @FINKPREFIX@/share/apache2/apache2-maintscript-helper
+
+    php5_enable() {
+        if [ $(a2query -M) != 'prefork' ] ; then
+            if apache2_switch_mpm prefork ; then
+                return 0
+            else
+                apache2_msg err "Could not switch to prefork MPM, not enabling php5"
+                return 1
+            fi
+        fi
+        return 0
+    }
+
+else
+    echo "Warning: Could not load Apache 2.4 maintainer script helper."
+
+    php5_enable() {
+        return 1;
+    }
+
+fi
+
+# we've registered a trigger to handle extension updates.
+if [ "$1" = "triggered" ] && [ "$2" = "@FINKPREFIX@/etc/php5/apache2/conf.d" ]; then
+    if [ -e @FINKPREFIX@/share/apache2/apache2-maintscript-helper ]; then
+	. @FINKPREFIX@/share/apache2/apache2-maintscript-helper
+	apache2_reload restart
+    fi
+    exit 0
+elif [ "$1" != "configure" ]; then
+    exit 0
+fi
diff -ruN php-5.5.1.orig/fink/libphp5-embed.postrm.extra php-5.5.1/fink/libphp5-embed.postrm.extra
--- php-5.5.1.orig/fink/libphp5-embed.postrm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/libphp5-embed.postrm.extra	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1 @@
+[ "$1" = "remove" ] && ldconfig
diff -ruN php-5.5.1.orig/fink/maxlifetime php-5.5.1/fink/maxlifetime
--- php-5.5.1.orig/fink/maxlifetime	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/maxlifetime	2013-08-08 09:39:51.000000000 -0600
@@ -0,0 +1,23 @@
+#!/bin/sh -e
+
+max=1440
+
+if which php5 >/dev/null 2>&1; then
+    for sapi in apache2 apache2filter cgi fpm; do
+	if [ -e @FINKPREFIX@/etc/php5/${sapi}/php.ini ]; then
+	    cur=$(php5 -c @FINKPREFIX@/etc/php5/${sapi}/php.ini -d "error_reporting='~E_ALL'" -r 'print ini_get("session.gc_maxlifetime");')
+	    [ -z "$cur" ] && cur=0
+	    [ "$cur" -gt "$max" ] && max=$cur
+	fi
+    done
+else
+    for ini in @FINKPREFIX@/etc/php5/*/php.ini @FINKPREFIX@/etc/php5/conf.d/*.ini; do
+        cur=$(sed -n -e 's/^[[:space:]]*session.gc_maxlifetime[[:space:]]*=[[:space:]]*\([0-9]\+\).*$/\1/p' $ini 2>/dev/null || true);
+        [ -z "$cur" ] && cur=0
+        [ "$cur" -gt "$max" ] && max=$cur
+    done
+fi
+
+echo $(($max/60))
+
+exit 0
diff -ruN php-5.5.1.orig/fink/modulelist php-5.5.1/fink/modulelist
--- php-5.5.1.orig/fink/modulelist	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/modulelist	2013-08-08 09:38:36.000000000 -0600
@@ -0,0 +1,23 @@
+curl CURL
+common PDO pdo 10
+enchant Enchant
+gd GD
+gmp GMP
+imap IMAP
+interbase Interbase
+intl Internationalisation
+ldap LDAP
+mcrypt MCrypt
+mysql MySQL
+mysqlnd MySQL mysqlnd 10
+odbc ODBC
+pgsql PostgreSQL
+pspell pspell
+readline readline
+recode recode
+snmp SNMP
+sqlite SQLite sqlite3
+sybase Sybase mssql
+tidy tidy
+xmlrpc XML-RPC
+xsl XSL
diff -ruN php-5.5.1.orig/fink/patches/0001-Add-information-about-which-INI-file-is-which-inside.patch php-5.5.1/fink/patches/0001-Add-information-about-which-INI-file-is-which-inside.patch
--- php-5.5.1.orig/fink/patches/0001-Add-information-about-which-INI-file-is-which-inside.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/0001-Add-information-about-which-INI-file-is-which-inside.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,32 @@
+From d2852f2e53437f5f2cfda4d6f623a5c97faf1408 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Ond=C5=99ej=20Sur=C3=BD?= <ondrej@sury.org>
+Date: Fri, 6 Apr 2012 14:30:10 +0200
+Subject: [PATCH] Add information about which INI file is which inside respective files
+
+---
+ php.ini-development |    2 ++
+ php.ini-production  |    2 ++
+ 2 files changed, 4 insertions(+), 0 deletions(-)
+
+--- php5.orig/php.ini-development
++++ php5/php.ini-development
+@@ -83,6 +83,8 @@
+ ; development version only in development environments as errors shown to
+ ; application users can inadvertently leak otherwise secure information.
+ 
++; This is php.ini-development INI file.
++
+ ;;;;;;;;;;;;;;;;;;;
+ ; Quick Reference ;
+ ;;;;;;;;;;;;;;;;;;;
+--- php5.orig/php.ini-production
++++ php5/php.ini-production
+@@ -83,6 +83,8 @@
+ ; development version only in development environments as errors shown to
+ ; application users can inadvertently leak otherwise secure information.
+ 
++; This is php.ini-production INI file.
++
+ ;;;;;;;;;;;;;;;;;;;
+ ; Quick Reference ;
+ ;;;;;;;;;;;;;;;;;;;
diff -ruN php-5.5.1.orig/fink/patches/001-libtool_fixes.patch php-5.5.1/fink/patches/001-libtool_fixes.patch
--- php-5.5.1.orig/fink/patches/001-libtool_fixes.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/001-libtool_fixes.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,24 @@
+--- php5.orig/TSRM/configure.in
++++ php5/TSRM/configure.in
+@@ -17,9 +17,6 @@ TSRM_BASIC_CHECKS
+ TSRM_THREADS_CHECKS
+ 	
+ AM_PROG_LIBTOOL
+-if test "$enable_debug" != "yes"; then
+-  AM_SET_LIBTOOL_VARIABLE([--silent])
+-fi
+ 
+ dnl TSRM_PTHREAD
+ 
+--- php5.orig/configure.in
++++ php5/configure.in
+@@ -1399,9 +1399,6 @@ AC_PROVIDE_IFELSE([PHP_REQUIRE_CXX], [],
+ ])
+ AC_PROG_LIBTOOL
+ 
+-if test "$enable_debug" != "yes"; then
+-  PHP_SET_LIBTOOL_VARIABLE([--silent])
+-fi
+ 
+ dnl libtool 1.4.3 needs this.
+ PHP_SET_LIBTOOL_VARIABLE([--preserve-dup-deps])
diff -ruN php-5.5.1.orig/fink/patches/002-static_openssl.patch php-5.5.1/fink/patches/002-static_openssl.patch
--- php-5.5.1.orig/fink/patches/002-static_openssl.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/002-static_openssl.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,13 @@
+--- php5.orig/acinclude.m4
++++ php5/acinclude.m4
+@@ -2392,9 +2392,7 @@ AC_DEFUN([PHP_SETUP_OPENSSL],[
+ 
+     PHP_ADD_INCLUDE($OPENSSL_INCDIR)
+   
+-    PHP_CHECK_LIBRARY(crypto, CRYPTO_free, [
+-      PHP_ADD_LIBRARY(crypto,,$1)
+-    ],[
++    PHP_CHECK_LIBRARY(crypto, CRYPTO_free, [:],[
+       AC_MSG_ERROR([libcrypto not found!])
+     ],[
+       -L$OPENSSL_LIBDIR
diff -ruN php-5.5.1.orig/fink/patches/004-ldap_fix.patch php-5.5.1/fink/patches/004-ldap_fix.patch
--- php-5.5.1.orig/fink/patches/004-ldap_fix.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/004-ldap_fix.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,27 @@
+Description: Prevent null dereferencing in ldap_explode_dn()
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/205405
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/ldap/ldap.c
++++ php5/ext/ldap/ldap.c
+@@ -1212,7 +1212,7 @@ PHP_FUNCTION(ldap_explode_dn)
+ 	}
+ 
+ 	i=0;
+-	while (ldap_value[i] != NULL) i++;
++	while (ldap_value && ldap_value[i] != NULL) i++;
+ 	count = i;
+ 
+ 	array_init(return_value);
+@@ -1222,7 +1222,8 @@ PHP_FUNCTION(ldap_explode_dn)
+ 		add_index_string(return_value, i, ldap_value[i], 1);
+ 	}
+ 
+-	ldap_value_free(ldap_value);
++	if (ldap_value)
++		ldap_value_free(ldap_value);
+ }
+ /* }}} */
+ 
diff -ruN php-5.5.1.orig/fink/patches/006-debian_quirks.patch php-5.5.1/fink/patches/006-debian_quirks.patch
--- php-5.5.1.orig/fink/patches/006-debian_quirks.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/006-debian_quirks.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,198 @@
+Description: Changes to make php use versioned paths and other minor
+ cleanup changes.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- php5.orig/configure.in
++++ php5/configure.in
+@@ -1068,7 +1068,7 @@ if test "$PHP_CLI" = "no"; then
+ fi
+ 
+ PHP_ARG_WITH(pear, [whether to install PEAR],
+-[  --with-pear=DIR         Install PEAR in DIR @<:@PREFIX/lib/php@:>@
++[  --with-pear=DIR         Install PEAR in DIR @<:@PREFIX/lib/php5@:>@
+   --without-pear          Do not install PEAR], DEFAULT, yes)
+ 
+ if test "$PHP_PEAR" != "no"; then
+@@ -1098,7 +1098,7 @@ dnl
+   if test "$PHP_PEAR" = "DEFAULT" || test "$PHP_PEAR" = "yes"; then
+     case $PHP_LAYOUT in
+       GNU) PEAR_INSTALLDIR=$datadir/pear;;
+-      *)   PEAR_INSTALLDIR=$libdir/php;;
++      *)   PEAR_INSTALLDIR=$libdir/php5;;
+     esac
+   fi
+ 
+@@ -1153,12 +1153,12 @@ test "$program_suffix" = "NONE" && progr
+ 
+ case $libdir in
+   '${exec_prefix}/lib')
+-    libdir=$libdir/php
++    libdir=$libdir/php5
+     ;;
+ esac
+ case $datadir in
+   '${prefix}/share')
+-    datadir=$datadir/php
++    datadir=$datadir/php5
+     ;;
+ esac
+ 
+@@ -1225,7 +1225,7 @@ EXPANDED_SYSCONFDIR=`eval echo $sysconfd
+ EXPANDED_DATADIR=$datadir
+ EXPANDED_PHP_CONFIG_FILE_PATH=`eval echo "$PHP_CONFIG_FILE_PATH"`
+ EXPANDED_PHP_CONFIG_FILE_SCAN_DIR=`eval echo "$PHP_CONFIG_FILE_SCAN_DIR"`
+-INCLUDE_PATH=.:$EXPANDED_PEAR_INSTALLDIR
++INCLUDE_PATH=.:$EXPANDED_PEAR_INSTALLDIR:/usr/share/pear
+ 
+ exec_prefix=$old_exec_prefix
+ libdir=$old_libdir
+--- php5.orig/ext/ext_skel
++++ php5/ext/ext_skel
+@@ -70,7 +70,7 @@ if test -d "$extname" ; then
+ fi
+ 
+ if test -z "$skel_dir"; then
+-  skel_dir="skeleton"
++  skel_dir="/usr/lib/php5/skeleton"
+ fi
+ 
+ ## convert skel_dir to full path
+--- php5.orig/php.ini-development
++++ php5/php.ini-development
+@@ -702,7 +702,7 @@ default_mimetype = "text/html"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+ 
+ ; UNIX: "/path1:/path2"
+-;include_path = ".:/php/includes"
++;include_path = ".:/usr/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include_path = ".;c:\php\includes"
+--- php5.orig/php.ini-production
++++ php5/php.ini-production
+@@ -702,7 +702,7 @@ default_mimetype = "text/html"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+ 
+ ; UNIX: "/path1:/path2"
+-;include_path = ".:/php/includes"
++;include_path = ".:/usr/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include_path = ".;c:\php\includes"
+@@ -863,51 +863,6 @@ default_socket_timeout = 60
+ ; If you only provide the name of the extension, PHP will look for it in its
+ ; default extension directory.
+ ;
+-; Windows Extensions
+-; Note that ODBC support is built in, so no dll is needed for it.
+-; Note that many DLL files are located in the extensions/ (PHP 4) ext/ (PHP 5)
+-; extension folders as well as the separate PECL DLL download (PHP 5).
+-; Be sure to appropriately set the extension_dir directive.
+-;
+-;extension=php_bz2.dll
+-;extension=php_curl.dll
+-;extension=php_fileinfo.dll
+-;extension=php_gd2.dll
+-;extension=php_gettext.dll
+-;extension=php_gmp.dll
+-;extension=php_intl.dll
+-;extension=php_imap.dll
+-;extension=php_interbase.dll
+-;extension=php_ldap.dll
+-;extension=php_mbstring.dll
+-;extension=php_exif.dll      ; Must be after mbstring as it depends on it
+-;extension=php_mysql.dll
+-;extension=php_mysqli.dll
+-;extension=php_oci8.dll      ; Use with Oracle 10gR2 Instant Client
+-;extension=php_oci8_11g.dll  ; Use with Oracle 11gR2 Instant Client
+-;extension=php_openssl.dll
+-;extension=php_pdo_firebird.dll
+-;extension=php_pdo_mysql.dll
+-;extension=php_pdo_oci.dll
+-;extension=php_pdo_odbc.dll
+-;extension=php_pdo_pgsql.dll
+-;extension=php_pdo_sqlite.dll
+-;extension=php_pgsql.dll
+-;extension=php_pspell.dll
+-;extension=php_shmop.dll
+-
+-; The MIBS data available in the PHP distribution must be installed. 
+-; See http://www.php.net/manual/en/snmp.installation.php 
+-;extension=php_snmp.dll
+-
+-;extension=php_soap.dll
+-;extension=php_sockets.dll
+-;extension=php_sqlite3.dll
+-;extension=php_sybase_ct.dll
+-;extension=php_tidy.dll
+-;extension=php_xmlrpc.dll
+-;extension=php_xsl.dll
+-;extension=php_zip.dll
+ 
+ ;;;;;;;;;;;;;;;;;;;
+ ; Module Settings ;
+--- php5.orig/sapi/cli/php.1.in
++++ php5/sapi/cli/php.1.in
+@@ -374,13 +374,14 @@ Shows configuration for extension
+ Show configuration file names
+ .SH FILES
+ .TP 15
+-.B php\-cli.ini
++.B /etc/php5/cli/php.ini
+ The configuration file for the CLI version of PHP.
+ .TP
+-.B php.ini
+-The standard configuration file will only be used when 
+-.B php\-cli.ini
+-cannot be found.
++.B /etc/php5/cgi/php.ini
++The configuration file for the CGI version of PHP.
++.TP
++.B /etc/php5/apache2/php.ini
++The configuration file for the version of PHP that apache2 uses.
+ .SH EXAMPLES
+ .TP 5
+ \fIphp \-r 'echo "Hello World\\n";'\fP
+--- php5.orig/scripts/Makefile.frag
++++ php5/scripts/Makefile.frag
+@@ -3,8 +3,8 @@
+ # Build environment install
+ #
+ 
+-phpincludedir = $(includedir)/php
+-phpbuilddir = $(libdir)/build
++phpincludedir = $(includedir)/php5
++phpbuilddir = $(prefix)/lib/php5/build
+ 
+ BUILD_FILES = \
+ 	scripts/phpize.m4 \
+--- php5.orig/scripts/php-config.in
++++ php5/scripts/php-config.in
+@@ -6,9 +6,9 @@ datarootdir="@datarootdir@"
+ exec_prefix="@exec_prefix@"
+ version="@PHP_VERSION@"
+ vernum="@PHP_VERSION_ID@"
+-include_dir="@includedir@/php"
+-includes="-I$include_dir -I$include_dir/main -I$include_dir/TSRM -I$include_dir/Zend -I$include_dir/ext -I$include_dir/ext/date/lib"
+-ldflags="@PHP_LDFLAGS@"
++include_dir="@includedir@/php5"
++includes="-I$include_dir -I$include_dir/main -I$include_dir/TSRM -I$include_dir/Zend -I$include_dir/ext -I$include_dir/ext/date/lib $(getconf LFS_CFLAGS)"
++ldflags="-L$prefix/lib/php5 @PHP_LDFLAGS@"
+ libs="@EXTRA_LIBS@"
+ extension_dir='@EXTENSION_DIR@'
+ man_dir=`eval echo @mandir@`
+--- php5.orig/scripts/phpize.in
++++ php5/scripts/phpize.in
+@@ -4,8 +4,8 @@
+ prefix='@prefix@'
+ datarootdir='@datarootdir@'
+ exec_prefix="`eval echo @exec_prefix@`"
+-phpdir="`eval echo @libdir@`/build"
+-includedir="`eval echo @includedir@`/php"
++phpdir="$prefix/lib/php5/build"
++includedir="$prefix/include/php5"
+ builddir="`pwd`"
+ SED="@SED@"
+ 
diff -ruN php-5.5.1.orig/fink/patches/013-force_getaddrinfo.patch php-5.5.1/fink/patches/013-force_getaddrinfo.patch
--- php-5.5.1.orig/fink/patches/013-force_getaddrinfo.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/013-force_getaddrinfo.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,103 @@
+Description: Always use getaddrinfo
+ .
+ The patch should probably be dropped and the configure check verified.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/configure.in
++++ b/configure.in
+@@ -692,50 +692,50 @@ PHP_CHECK_FUNC_LIB(nanosleep, rt)
+ 
+ dnl Check for getaddrinfo, should be a better way, but...
+ dnl Also check for working getaddrinfo
+-AC_CACHE_CHECK([for getaddrinfo], ac_cv_func_getaddrinfo,
+-[AC_TRY_LINK([#include <netdb.h>],
+-                [struct addrinfo *g,h;g=&h;getaddrinfo("","",g,&g);], 
+-  AC_TRY_RUN([
+-#include <netdb.h>
+-#include <sys/types.h>
+-#ifndef AF_INET
+-# include <sys/socket.h>
+-#endif
+-int main(void) {
+-  struct addrinfo *ai, *pai, hints;
+-
+-  memset(&hints, 0, sizeof(hints));
+-  hints.ai_flags = AI_NUMERICHOST;
+-
+-  if (getaddrinfo("127.0.0.1", 0, &hints, &ai) < 0) {
+-    exit(1);
+-  }
+-
+-  if (ai == 0) {
+-    exit(1);
+-  }
+-
+-  pai = ai;
+-  
+-  while (pai) {
+-    if (pai->ai_family != AF_INET) {
+-      /* 127.0.0.1/NUMERICHOST should only resolve ONE way */
+-      exit(1);
+-    }
+-    if (pai->ai_addr->sa_family != AF_INET) {
+-      /* 127.0.0.1/NUMERICHOST should only resolve ONE way */
+-      exit(1);
+-    }
+-    pai = pai->ai_next;
+-  }
+-  freeaddrinfo(ai);
+-  exit(0);
+-}
+-  ],ac_cv_func_getaddrinfo=yes, ac_cv_func_getaddrinfo=no, ac_cv_func_getaddrinfo=no),
+-ac_cv_func_getaddrinfo=no)])
+-if test "$ac_cv_func_getaddrinfo" = yes; then
++dnl AC_CACHE_CHECK([for getaddrinfo], ac_cv_func_getaddrinfo,
++dnl [AC_TRY_LINK([#include <netdb.h>],
++dnl                 [struct addrinfo *g,h;g=&h;getaddrinfo("","",g,&g);], 
++dnl   AC_TRY_RUN([
++dnl #include <netdb.h>
++dnl #include <sys/types.h>
++dnl #ifndef AF_INET
++dnl # include <sys/socket.h>
++dnl #endif
++dnl int main(void) {
++dnl   struct addrinfo *ai, *pai, hints;
++dnl 
++dnl   memset(&hints, 0, sizeof(hints));
++dnl   hints.ai_flags = AI_NUMERICHOST;
++dnl 
++dnl   if (getaddrinfo("127.0.0.1", 0, &hints, &ai) < 0) {
++dnl     exit(1);
++dnl   }
++dnl 
++dnl   if (ai == 0) {
++dnl     exit(1);
++dnl   }
++dnl 
++dnl   pai = ai;
++dnl   
++dnl   while (pai) {
++dnl     if (pai->ai_family != AF_INET) {
++dnl       /* 127.0.0.1/NUMERICHOST should only resolve ONE way */
++dnl       exit(1);
++dnl     }
++dnl     if (pai->ai_addr->sa_family != AF_INET) {
++dnl       /* 127.0.0.1/NUMERICHOST should only resolve ONE way */
++dnl       exit(1);
++dnl     }
++dnl     pai = pai->ai_next;
++dnl   }
++dnl   freeaddrinfo(ai);
++dnl   exit(0);
++dnl }
++dnl   ],ac_cv_func_getaddrinfo=yes, ac_cv_func_getaddrinfo=no, ac_cv_func_getaddrinfo=no),
++dnl ac_cv_func_getaddrinfo=no)])
++dnl if test "$ac_cv_func_getaddrinfo" = yes; then
+   AC_DEFINE(HAVE_GETADDRINFO,1,[Define if you have the getaddrinfo function])
+-fi
++dnl fi
+ 
+ dnl Check for the __sync_fetch_and_add builtin
+ AC_CACHE_CHECK([for __sync_fetch_and_add], ac_cv_func_sync_fetch_and_add,
diff -ruN php-5.5.1.orig/fink/patches/017-pread_pwrite_disable.patch php-5.5.1/fink/patches/017-pread_pwrite_disable.patch
--- php-5.5.1.orig/fink/patches/017-pread_pwrite_disable.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/017-pread_pwrite_disable.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,28 @@
+Description: Completely disable the usage of pread/pwrite
+ .
+ This is an old patch and should be re-checked.
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/261311
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/acinclude.m4
++++ b/acinclude.m4
+@@ -1235,7 +1235,7 @@ $1
+     }
+ 
+   ],[
+-    ac_cv_pwrite=yes
++    ac_cv_pwrite=no
+   ],[
+     ac_cv_pwrite=no
+   ],[
+@@ -1264,7 +1264,7 @@ $1
+     exit(0);
+     }
+   ],[
+-    ac_cv_pread=yes
++    ac_cv_pread=no
+   ],[
+     ac_cv_pread=no
+   ],[
diff -ruN php-5.5.1.orig/fink/patches/019-z_off_t_as_long.patch php-5.5.1/fink/patches/019-z_off_t_as_long.patch
--- php-5.5.1.orig/fink/patches/019-z_off_t_as_long.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/019-z_off_t_as_long.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,1541 @@
+Description: Include some zlib headers to make sure z_off_t is a long on
+ the gzip file functions. Issue caused by LFS support.
+ .
+ Needs to be re-checked.
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/208608
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- /dev/null
++++ b/ext/zlib/zconf.h
+@@ -0,0 +1,326 @@
++/* zconf.h -- configuration of the zlib compression library
++ * Copyright (C) 1995-2003 Jean-loup Gailly.
++ * For conditions of distribution and use, see copyright notice in zlib.h
++ */
++
++/* @(#) $Id: 019-z_off_t_as_long.patch.disabled,v 1.3 2004/08/23 07:48:56 adconrad Exp $ */
++
++#ifndef ZCONF_H
++#define ZCONF_H
++
++#warning Including local zconf.h instead of system zconf.h
++
++/*
++ * If you *really* need a unique prefix for all types and library functions,
++ * compile with -DZ_PREFIX. The "standard" zlib should be compiled without it.
++ */
++#ifdef Z_PREFIX
++#  define deflateInit_  z_deflateInit_
++#  define deflate       z_deflate
++#  define deflateEnd    z_deflateEnd
++#  define inflateInit_  z_inflateInit_
++#  define inflate       z_inflate
++#  define inflateEnd    z_inflateEnd
++#  define deflateInit2_ z_deflateInit2_
++#  define deflateSetDictionary z_deflateSetDictionary
++#  define deflateCopy   z_deflateCopy
++#  define deflateReset  z_deflateReset
++#  define deflatePrime  z_deflatePrime
++#  define deflateParams z_deflateParams
++#  define deflateBound  z_deflateBound
++#  define inflateInit2_ z_inflateInit2_
++#  define inflateSetDictionary z_inflateSetDictionary
++#  define inflateSync   z_inflateSync
++#  define inflateSyncPoint z_inflateSyncPoint
++#  define inflateCopy   z_inflateCopy
++#  define inflateReset  z_inflateReset
++#  define compress      z_compress
++#  define compress2     z_compress2
++#  define compressBound z_compressBound
++#  define uncompress    z_uncompress
++#  define adler32       z_adler32
++#  define crc32         z_crc32
++#  define get_crc_table z_get_crc_table
++
++#  define Byte          z_Byte
++#  define uInt          z_uInt
++#  define uLong         z_uLong
++#  define Bytef         z_Bytef
++#  define charf         z_charf
++#  define intf          z_intf
++#  define uIntf         z_uIntf
++#  define uLongf        z_uLongf
++#  define voidpf        z_voidpf
++#  define voidp         z_voidp
++#endif
++
++#if defined(__MSDOS__) && !defined(MSDOS)
++#  define MSDOS
++#endif
++#if (defined(OS_2) || defined(__OS2__)) && !defined(OS2)
++#  define OS2
++#endif
++#if defined(_WINDOWS) && !defined(WINDOWS)
++#  define WINDOWS
++#endif
++#if (defined(_WIN32) || defined(__WIN32__)) && !defined(WIN32)
++#  define WIN32
++#endif
++#if (defined(MSDOS) || defined(OS2) || defined(WINDOWS)) && !defined(WIN32)
++#  if !defined(__GNUC__) && !defined(__FLAT__) && !defined(__386__)
++#    ifndef SYS16BIT
++#      define SYS16BIT
++#    endif
++#  endif
++#endif
++
++/*
++ * Compile with -DMAXSEG_64K if the alloc function cannot allocate more
++ * than 64k bytes at a time (needed on systems with 16-bit int).
++ */
++#ifdef SYS16BIT
++#  define MAXSEG_64K
++#endif
++#ifdef MSDOS
++#  define UNALIGNED_OK
++#endif
++
++#ifdef __STDC_VERSION__
++#  ifndef STDC
++#    define STDC
++#  endif
++#  if __STDC_VERSION__ >= 199901L
++#    ifndef STDC99
++#      define STDC99
++#    endif
++#  endif
++#endif
++#if !defined(STDC) && (defined(__STDC__) || defined(__cplusplus))
++#  define STDC
++#endif
++#if !defined(STDC) && (defined(__GNUC__) || defined(__BORLANDC__))
++#  define STDC
++#endif
++#if !defined(STDC) && (defined(MSDOS) || defined(WINDOWS) || defined(WIN32))
++#  define STDC
++#endif
++#if !defined(STDC) && (defined(OS2) || defined(__HOS_AIX__))
++#  define STDC
++#endif
++
++#if defined(__OS400__) && !defined(STDC)    /* iSeries (formerly AS/400). */
++#  define STDC
++#endif
++
++#ifndef STDC
++#  ifndef const /* cannot use !defined(STDC) && !defined(const) on Mac */
++#    define const       /* note: need a more gentle solution here */
++#  endif
++#endif
++
++/* Some Mac compilers merge all .h files incorrectly: */
++#if defined(__MWERKS__)||defined(applec)||defined(THINK_C)||defined(__SC__)
++#  define NO_DUMMY_DECL
++#endif
++
++/* Maximum value for memLevel in deflateInit2 */
++#ifndef MAX_MEM_LEVEL
++#  ifdef MAXSEG_64K
++#    define MAX_MEM_LEVEL 8
++#  else
++#    define MAX_MEM_LEVEL 9
++#  endif
++#endif
++
++/* Maximum value for windowBits in deflateInit2 and inflateInit2.
++ * WARNING: reducing MAX_WBITS makes minigzip unable to extract .gz files
++ * created by gzip. (Files created by minigzip can still be extracted by
++ * gzip.)
++ */
++#ifndef MAX_WBITS
++#  define MAX_WBITS   15 /* 32K LZ77 window */
++#endif
++
++/* The memory requirements for deflate are (in bytes):
++            (1 << (windowBits+2)) +  (1 << (memLevel+9))
++ that is: 128K for windowBits=15  +  128K for memLevel = 8  (default values)
++ plus a few kilobytes for small objects. For example, if you want to reduce
++ the default memory requirements from 256K to 128K, compile with
++     make CFLAGS="-O -DMAX_WBITS=14 -DMAX_MEM_LEVEL=7"
++ Of course this will generally degrade compression (there's no free lunch).
++
++   The memory requirements for inflate are (in bytes) 1 << windowBits
++ that is, 32K for windowBits=15 (default value) plus a few kilobytes
++ for small objects.
++*/
++
++                        /* Type declarations */
++
++#ifndef OF /* function prototypes */
++#  ifdef STDC
++#    define OF(args)  args
++#  else
++#    define OF(args)  ()
++#  endif
++#endif
++
++/* The following definitions for FAR are needed only for MSDOS mixed
++ * model programming (small or medium model with some far allocations).
++ * This was tested only with MSC; for other MSDOS compilers you may have
++ * to define NO_MEMCPY in zutil.h.  If you don't need the mixed model,
++ * just define FAR to be empty.
++ */
++#ifdef SYS16BIT
++#  if defined(M_I86SM) || defined(M_I86MM)
++     /* MSC small or medium model */
++#    define SMALL_MEDIUM
++#    ifdef _MSC_VER
++#      define FAR _far
++#    else
++#      define FAR far
++#    endif
++#  endif
++#  if (defined(__SMALL__) || defined(__MEDIUM__))
++     /* Turbo C small or medium model */
++#    define SMALL_MEDIUM
++#    ifdef __BORLANDC__
++#      define FAR _far
++#    else
++#      define FAR far
++#    endif
++#  endif
++#endif
++
++#if defined(WINDOWS) || defined(WIN32)
++   /* If building or using zlib as a DLL, define ZLIB_DLL.
++    * This is not mandatory, but it offers a little performance increase.
++    */
++#  ifdef ZLIB_DLL
++#    if defined(WIN32) && (!defined(__BORLANDC__) || (__BORLANDC__ >= 0x500))
++#      ifdef ZLIB_INTERNAL
++#        define ZEXTERN extern __declspec(dllexport)
++#      else
++#        define ZEXTERN extern __declspec(dllimport)
++#      endif
++#    endif
++#  endif  /* ZLIB_DLL */
++   /* If building or using zlib with the WINAPI/WINAPIV calling convention,
++    * define ZLIB_WINAPI.
++    * Caution: the standard ZLIB1.DLL is NOT compiled using ZLIB_WINAPI.
++    */
++#  ifdef ZLIB_WINAPI
++#    ifdef FAR
++#      undef FAR
++#    endif
++#    include <windows.h>
++     /* No need for _export, use ZLIB.DEF instead. */
++     /* For complete Windows compatibility, use WINAPI, not __stdcall. */
++#    define ZEXPORT WINAPI
++#    ifdef WIN32
++#      define ZEXPORTVA WINAPIV
++#    else
++#      define ZEXPORTVA FAR CDECL
++#    endif
++#  endif
++#endif
++
++#if defined (__BEOS__)
++#  ifdef ZLIB_DLL
++#    ifdef ZLIB_INTERNAL
++#      define ZEXPORT   __declspec(dllexport)
++#      define ZEXPORTVA __declspec(dllexport)
++#    else
++#      define ZEXPORT   __declspec(dllimport)
++#      define ZEXPORTVA __declspec(dllimport)
++#    endif
++#  endif
++#endif
++
++#ifndef ZEXTERN
++#  define ZEXTERN extern
++#endif
++#ifndef ZEXPORT
++#  define ZEXPORT
++#endif
++#ifndef ZEXPORTVA
++#  define ZEXPORTVA
++#endif
++
++#ifndef FAR
++#  define FAR
++#endif
++
++#if !defined(__MACTYPES__)
++typedef unsigned char  Byte;  /* 8 bits */
++#endif
++typedef unsigned int   uInt;  /* 16 bits or more */
++typedef unsigned long  uLong; /* 32 bits or more */
++
++#ifdef SMALL_MEDIUM
++   /* Borland C/C++ and some old MSC versions ignore FAR inside typedef */
++#  define Bytef Byte FAR
++#else
++   typedef Byte  FAR Bytef;
++#endif
++typedef char  FAR charf;
++typedef int   FAR intf;
++typedef uInt  FAR uIntf;
++typedef uLong FAR uLongf;
++
++#ifdef STDC
++   typedef void const *voidpc;
++   typedef void FAR   *voidpf;
++   typedef void       *voidp;
++#else
++   typedef Byte const *voidpc;
++   typedef Byte FAR   *voidpf;
++   typedef Byte       *voidp;
++#endif
++
++#if 1           /* HAVE_UNISTD_H -- this line is updated by ./configure */
++#  include <sys/types.h> /* for off_t */
++#  include <unistd.h>    /* for SEEK_* and off_t */
++#  ifdef VMS
++#    include <unixio.h>   /* for off_t */
++#  endif
++/* #  define z_off_t  off_t */
++#endif
++#ifndef SEEK_SET
++#  define SEEK_SET        0       /* Seek from beginning of file.  */
++#  define SEEK_CUR        1       /* Seek from current position.  */
++#  define SEEK_END        2       /* Set file pointer to EOF plus "offset" */
++#endif
++#ifndef z_off_t
++#  warning Defining z_off_t as 'long' rather than 'off_t'
++#  define  z_off_t long
++#endif
++
++#if defined(__OS400__)
++#define NO_vsnprintf
++#endif
++
++#if defined(__MVS__)
++#  define NO_vsnprintf
++#  ifdef FAR
++#    undef FAR
++#  endif
++#endif
++
++/* MVS linker does not support external names larger than 8 bytes */
++#if defined(__MVS__)
++#   pragma map(deflateInit_,"DEIN")
++#   pragma map(deflateInit2_,"DEIN2")
++#   pragma map(deflateEnd,"DEEND")
++#   pragma map(deflateBound,"DEBND")
++#   pragma map(inflateInit_,"ININ")
++#   pragma map(inflateInit2_,"ININ2")
++#   pragma map(inflateEnd,"INEND")
++#   pragma map(inflateSync,"INSY")
++#   pragma map(inflateSetDictionary,"INSEDI")
++#   pragma map(compressBound,"CMBND")
++#   pragma map(inflate_table,"INTABL")
++#   pragma map(inflate_fast,"INFA")
++#   pragma map(inflate_copyright,"INCOPY")
++#endif
++
++#endif /* ZCONF_H */
+--- /dev/null
++++ b/ext/zlib/zlib.h
+@@ -0,0 +1,1200 @@
++/* zlib.h -- interface of the 'zlib' general purpose compression library
++  version 1.2.1.1, January 9th, 2004
++
++  Copyright (C) 1995-2004 Jean-loup Gailly and Mark Adler
++
++  This software is provided 'as-is', without any express or implied
++  warranty.  In no event will the authors be held liable for any damages
++  arising from the use of this software.
++
++  Permission is granted to anyone to use this software for any purpose,
++  including commercial applications, and to alter it and redistribute it
++  freely, subject to the following restrictions:
++
++  1. The origin of this software must not be misrepresented; you must not
++     claim that you wrote the original software. If you use this software
++     in a product, an acknowledgment in the product documentation would be
++     appreciated but is not required.
++  2. Altered source versions must be plainly marked as such, and must not be
++     misrepresented as being the original software.
++  3. This notice may not be removed or altered from any source distribution.
++
++  Jean-loup Gailly        Mark Adler
++  jloup@gzip.org          madler@alumni.caltech.edu
++
++
++  The data format used by the zlib library is described by RFCs (Request for
++  Comments) 1950 to 1952 in the files http://www.ietf.org/rfc/rfc1950.txt
++  (zlib format), rfc1951.txt (deflate format) and rfc1952.txt (gzip format).
++*/
++
++#ifndef ZLIB_H
++#define ZLIB_H
++
++#include "zconf.h"
++
++#ifdef __cplusplus
++extern "C" {
++#endif
++
++#define ZLIB_VERSION "1.2.1.1"
++#define ZLIB_VERNUM 0x1211
++
++/*
++     The 'zlib' compression library provides in-memory compression and
++  decompression functions, including integrity checks of the uncompressed
++  data.  This version of the library supports only one compression method
++  (deflation) but other algorithms will be added later and will have the same
++  stream interface.
++
++     Compression can be done in a single step if the buffers are large
++  enough (for example if an input file is mmap'ed), or can be done by
++  repeated calls of the compression function.  In the latter case, the
++  application must provide more input and/or consume the output
++  (providing more output space) before each call.
++
++     The compressed data format used by the in-memory functions is the zlib
++  format, which is a zlib wrapper documented in RFC 1950, wrapped around a
++  deflate stream, which is itself documented in RFC 1951.
++
++     The library also supports reading and writing files in gzip (.gz) format
++  with an interface similar to that of stdio using the functions that start
++  with "gz".  The gzip format is different from the zlib format.  gzip is a
++  gzip wrapper, documented in RFC 1952, wrapped around a deflate stream.
++
++     The zlib format was designed to be compact and fast for use in memory
++  and on communications channels.  The gzip format was designed for single-
++  file compression on file systems, has a larger header than zlib to maintain
++  directory information, and uses a different, slower check method than zlib.
++
++     This library does not provide any functions to write gzip files in memory.
++  However such functions could be easily written using zlib's deflate function,
++  the documentation in the gzip RFC, and the examples in gzio.c.
++
++     The library does not install any signal handler. The decoder checks
++  the consistency of the compressed data, so the library should never
++  crash even in case of corrupted input.
++*/
++
++typedef voidpf (*alloc_func) OF((voidpf opaque, uInt items, uInt size));
++typedef void   (*free_func)  OF((voidpf opaque, voidpf address));
++
++struct internal_state;
++
++typedef struct z_stream_s {
++    Bytef    *next_in;  /* next input byte */
++    uInt     avail_in;  /* number of bytes available at next_in */
++    uLong    total_in;  /* total nb of input bytes read so far */
++
++    Bytef    *next_out; /* next output byte should be put there */
++    uInt     avail_out; /* remaining free space at next_out */
++    uLong    total_out; /* total nb of bytes output so far */
++
++    char     *msg;      /* last error message, NULL if no error */
++    struct internal_state FAR *state; /* not visible by applications */
++
++    alloc_func zalloc;  /* used to allocate the internal state */
++    free_func  zfree;   /* used to free the internal state */
++    voidpf     opaque;  /* private data object passed to zalloc and zfree */
++
++    int     data_type;  /* best guess about the data type: ascii or binary */
++    uLong   adler;      /* adler32 value of the uncompressed data */
++    uLong   reserved;   /* reserved for future use */
++} z_stream;
++
++typedef z_stream FAR *z_streamp;
++
++/*
++   The application must update next_in and avail_in when avail_in has
++   dropped to zero. It must update next_out and avail_out when avail_out
++   has dropped to zero. The application must initialize zalloc, zfree and
++   opaque before calling the init function. All other fields are set by the
++   compression library and must not be updated by the application.
++
++   The opaque value provided by the application will be passed as the first
++   parameter for calls of zalloc and zfree. This can be useful for custom
++   memory management. The compression library attaches no meaning to the
++   opaque value.
++
++   zalloc must return Z_NULL if there is not enough memory for the object.
++   If zlib is used in a multi-threaded application, zalloc and zfree must be
++   thread safe.
++
++   On 16-bit systems, the functions zalloc and zfree must be able to allocate
++   exactly 65536 bytes, but will not be required to allocate more than this
++   if the symbol MAXSEG_64K is defined (see zconf.h). WARNING: On MSDOS,
++   pointers returned by zalloc for objects of exactly 65536 bytes *must*
++   have their offset normalized to zero. The default allocation function
++   provided by this library ensures this (see zutil.c). To reduce memory
++   requirements and avoid any allocation of 64K objects, at the expense of
++   compression ratio, compile the library with -DMAX_WBITS=14 (see zconf.h).
++
++   The fields total_in and total_out can be used for statistics or
++   progress reports. After compression, total_in holds the total size of
++   the uncompressed data and may be saved for use in the decompressor
++   (particularly if the decompressor wants to decompress everything in
++   a single step).
++*/
++
++                        /* constants */
++
++#define Z_NO_FLUSH      0
++#define Z_PARTIAL_FLUSH 1 /* will be removed, use Z_SYNC_FLUSH instead */
++#define Z_SYNC_FLUSH    2
++#define Z_FULL_FLUSH    3
++#define Z_FINISH        4
++#define Z_BLOCK         5
++/* Allowed flush values; see deflate() and inflate() below for details */
++
++#define Z_OK            0
++#define Z_STREAM_END    1
++#define Z_NEED_DICT     2
++#define Z_ERRNO        (-1)
++#define Z_STREAM_ERROR (-2)
++#define Z_DATA_ERROR   (-3)
++#define Z_MEM_ERROR    (-4)
++#define Z_BUF_ERROR    (-5)
++#define Z_VERSION_ERROR (-6)
++/* Return codes for the compression/decompression functions. Negative
++ * values are errors, positive values are used for special but normal events.
++ */
++
++#define Z_NO_COMPRESSION         0
++#define Z_BEST_SPEED             1
++#define Z_BEST_COMPRESSION       9
++#define Z_DEFAULT_COMPRESSION  (-1)
++/* compression levels */
++
++#define Z_FILTERED            1
++#define Z_HUFFMAN_ONLY        2
++#define Z_RLE                 3
++#define Z_DEFAULT_STRATEGY    0
++/* compression strategy; see deflateInit2() below for details */
++
++#define Z_BINARY   0
++#define Z_ASCII    1
++#define Z_UNKNOWN  2
++/* Possible values of the data_type field (though see inflate()) */
++
++#define Z_DEFLATED   8
++/* The deflate compression method (the only one supported in this version) */
++
++#define Z_NULL  0  /* for initializing zalloc, zfree, opaque */
++
++#define zlib_version zlibVersion()
++/* for compatibility with versions < 1.0.2 */
++
++                        /* basic functions */
++
++ZEXTERN const char * ZEXPORT zlibVersion OF((void));
++/* The application can compare zlibVersion and ZLIB_VERSION for consistency.
++   If the first character differs, the library code actually used is
++   not compatible with the zlib.h header file used by the application.
++   This check is automatically made by deflateInit and inflateInit.
++ */
++
++/*
++ZEXTERN int ZEXPORT deflateInit OF((z_streamp strm, int level));
++
++     Initializes the internal stream state for compression. The fields
++   zalloc, zfree and opaque must be initialized before by the caller.
++   If zalloc and zfree are set to Z_NULL, deflateInit updates them to
++   use default allocation functions.
++
++     The compression level must be Z_DEFAULT_COMPRESSION, or between 0 and 9:
++   1 gives best speed, 9 gives best compression, 0 gives no compression at
++   all (the input data is simply copied a block at a time).
++   Z_DEFAULT_COMPRESSION requests a default compromise between speed and
++   compression (currently equivalent to level 6).
++
++     deflateInit returns Z_OK if success, Z_MEM_ERROR if there was not
++   enough memory, Z_STREAM_ERROR if level is not a valid compression level,
++   Z_VERSION_ERROR if the zlib library version (zlib_version) is incompatible
++   with the version assumed by the caller (ZLIB_VERSION).
++   msg is set to null if there is no error message.  deflateInit does not
++   perform any compression: this will be done by deflate().
++*/
++
++
++ZEXTERN int ZEXPORT deflate OF((z_streamp strm, int flush));
++/*
++    deflate compresses as much data as possible, and stops when the input
++  buffer becomes empty or the output buffer becomes full. It may introduce some
++  output latency (reading input without producing any output) except when
++  forced to flush.
++
++    The detailed semantics are as follows. deflate performs one or both of the
++  following actions:
++
++  - Compress more input starting at next_in and update next_in and avail_in
++    accordingly. If not all input can be processed (because there is not
++    enough room in the output buffer), next_in and avail_in are updated and
++    processing will resume at this point for the next call of deflate().
++
++  - Provide more output starting at next_out and update next_out and avail_out
++    accordingly. This action is forced if the parameter flush is non zero.
++    Forcing flush frequently degrades the compression ratio, so this parameter
++    should be set only when necessary (in interactive applications).
++    Some output may be provided even if flush is not set.
++
++  Before the call of deflate(), the application should ensure that at least
++  one of the actions is possible, by providing more input and/or consuming
++  more output, and updating avail_in or avail_out accordingly; avail_out
++  should never be zero before the call. The application can consume the
++  compressed output when it wants, for example when the output buffer is full
++  (avail_out == 0), or after each call of deflate(). If deflate returns Z_OK
++  and with zero avail_out, it must be called again after making room in the
++  output buffer because there might be more output pending.
++
++    If the parameter flush is set to Z_SYNC_FLUSH, all pending output is
++  flushed to the output buffer and the output is aligned on a byte boundary, so
++  that the decompressor can get all input data available so far. (In particular
++  avail_in is zero after the call if enough output space has been provided
++  before the call.)  Flushing may degrade compression for some compression
++  algorithms and so it should be used only when necessary.
++
++    If flush is set to Z_FULL_FLUSH, all output is flushed as with
++  Z_SYNC_FLUSH, and the compression state is reset so that decompression can
++  restart from this point if previous compressed data has been damaged or if
++  random access is desired. Using Z_FULL_FLUSH too often can seriously degrade
++  the compression.
++
++    If deflate returns with avail_out == 0, this function must be called again
++  with the same value of the flush parameter and more output space (updated
++  avail_out), until the flush is complete (deflate returns with non-zero
++  avail_out). In the case of a Z_FULL_FLUSH or Z_SYNC_FLUSH, make sure that
++  avail_out is greater than six to avoid repeated flush markers due to
++  avail_out == 0 on return.
++
++    If the parameter flush is set to Z_FINISH, pending input is processed,
++  pending output is flushed and deflate returns with Z_STREAM_END if there
++  was enough output space; if deflate returns with Z_OK, this function must be
++  called again with Z_FINISH and more output space (updated avail_out) but no
++  more input data, until it returns with Z_STREAM_END or an error. After
++  deflate has returned Z_STREAM_END, the only possible operations on the
++  stream are deflateReset or deflateEnd.
++
++    Z_FINISH can be used immediately after deflateInit if all the compression
++  is to be done in a single step. In this case, avail_out must be at least
++  the value returned by deflateBound (see below). If deflate does not return
++  Z_STREAM_END, then it must be called again as described above.
++
++    deflate() sets strm->adler to the adler32 checksum of all input read
++  so far (that is, total_in bytes).
++
++    deflate() may update data_type if it can make a good guess about
++  the input data type (Z_ASCII or Z_BINARY). In doubt, the data is considered
++  binary. This field is only for information purposes and does not affect
++  the compression algorithm in any manner.
++
++    deflate() returns Z_OK if some progress has been made (more input
++  processed or more output produced), Z_STREAM_END if all input has been
++  consumed and all output has been produced (only when flush is set to
++  Z_FINISH), Z_STREAM_ERROR if the stream state was inconsistent (for example
++  if next_in or next_out was NULL), Z_BUF_ERROR if no progress is possible
++  (for example avail_in or avail_out was zero). Note that Z_BUF_ERROR is not
++  fatal, and deflate() can be called again with more input and more output
++  space to continue compressing.
++*/
++
++
++ZEXTERN int ZEXPORT deflateEnd OF((z_streamp strm));
++/*
++     All dynamically allocated data structures for this stream are freed.
++   This function discards any unprocessed input and does not flush any
++   pending output.
++
++     deflateEnd returns Z_OK if success, Z_STREAM_ERROR if the
++   stream state was inconsistent, Z_DATA_ERROR if the stream was freed
++   prematurely (some input or output was discarded). In the error case,
++   msg may be set but then points to a static string (which must not be
++   deallocated).
++*/
++
++
++/*
++ZEXTERN int ZEXPORT inflateInit OF((z_streamp strm));
++
++     Initializes the internal stream state for decompression. The fields
++   next_in, avail_in, zalloc, zfree and opaque must be initialized before by
++   the caller. If next_in is not Z_NULL and avail_in is large enough (the exact
++   value depends on the compression method), inflateInit determines the
++   compression method from the zlib header and allocates all data structures
++   accordingly; otherwise the allocation will be deferred to the first call of
++   inflate.  If zalloc and zfree are set to Z_NULL, inflateInit updates them to
++   use default allocation functions.
++
++     inflateInit returns Z_OK if success, Z_MEM_ERROR if there was not enough
++   memory, Z_VERSION_ERROR if the zlib library version is incompatible with the
++   version assumed by the caller.  msg is set to null if there is no error
++   message. inflateInit does not perform any decompression apart from reading
++   the zlib header if present: this will be done by inflate().  (So next_in and
++   avail_in may be modified, but next_out and avail_out are unchanged.)
++*/
++
++
++ZEXTERN int ZEXPORT inflate OF((z_streamp strm, int flush));
++/*
++    inflate decompresses as much data as possible, and stops when the input
++  buffer becomes empty or the output buffer becomes full. It may introduce
++  some output latency (reading input without producing any output) except when
++  forced to flush.
++
++  The detailed semantics are as follows. inflate performs one or both of the
++  following actions:
++
++  - Decompress more input starting at next_in and update next_in and avail_in
++    accordingly. If not all input can be processed (because there is not
++    enough room in the output buffer), next_in is updated and processing
++    will resume at this point for the next call of inflate().
++
++  - Provide more output starting at next_out and update next_out and avail_out
++    accordingly.  inflate() provides as much output as possible, until there
++    is no more input data or no more space in the output buffer (see below
++    about the flush parameter).
++
++  Before the call of inflate(), the application should ensure that at least
++  one of the actions is possible, by providing more input and/or consuming
++  more output, and updating the next_* and avail_* values accordingly.
++  The application can consume the uncompressed output when it wants, for
++  example when the output buffer is full (avail_out == 0), or after each
++  call of inflate(). If inflate returns Z_OK and with zero avail_out, it
++  must be called again after making room in the output buffer because there
++  might be more output pending.
++
++    The flush parameter of inflate() can be Z_NO_FLUSH, Z_SYNC_FLUSH,
++  Z_FINISH, or Z_BLOCK. Z_SYNC_FLUSH requests that inflate() flush as much
++  output as possible to the output buffer. Z_BLOCK requests that inflate() stop
++  if and when it get to the next deflate block boundary. When decoding the zlib
++  or gzip format, this will cause inflate() to return immediately after the
++  header and before the first block. When doing a raw inflate, inflate() will
++  go ahead and process the first block, and will return when it gets to the end
++  of that block, or when it runs out of data.
++
++    The Z_BLOCK option assists in appending to or combining deflate streams.
++  Also to assist in this, on return inflate() will set strm->data_type to the
++  number of unused bits in the last byte taken from strm->next_in, plus 64
++  if inflate() is currently decoding the last block in the deflate stream,
++  plus 128 if inflate() returned immediately after decoding an end-of-block
++  code or decoding the complete header up to just before the first byte of the
++  deflate stream. The end-of-block will not be indicated until all of the
++  uncompressed data from that block has been written to strm->next_out.  The
++  number of unused bits may in general be greater than seven, except when
++  bit 7 of data_type is set, in which case the number of unused bits will be
++  less than eight.
++
++    inflate() should normally be called until it returns Z_STREAM_END or an
++  error. However if all decompression is to be performed in a single step
++  (a single call of inflate), the parameter flush should be set to
++  Z_FINISH. In this case all pending input is processed and all pending
++  output is flushed; avail_out must be large enough to hold all the
++  uncompressed data. (The size of the uncompressed data may have been saved
++  by the compressor for this purpose.) The next operation on this stream must
++  be inflateEnd to deallocate the decompression state. The use of Z_FINISH
++  is never required, but can be used to inform inflate that a faster approach
++  may be used for the single inflate() call.
++
++     In this implementation, inflate() always flushes as much output as
++  possible to the output buffer, and always uses the faster approach on the
++  first call. So the only effect of the flush parameter in this implementation
++  is on the return value of inflate(), as noted below, or when it returns early
++  because Z_BLOCK is used.
++
++     If a preset dictionary is needed after this call (see inflateSetDictionary
++  below), inflate sets strm-adler to the adler32 checksum of the dictionary
++  chosen by the compressor and returns Z_NEED_DICT; otherwise it sets
++  strm->adler to the adler32 checksum of all output produced so far (that is,
++  total_out bytes) and returns Z_OK, Z_STREAM_END or an error code as described
++  below. At the end of the stream, inflate() checks that its computed adler32
++  checksum is equal to that saved by the compressor and returns Z_STREAM_END
++  only if the checksum is correct.
++
++    inflate() will decompress and check either zlib-wrapped or gzip-wrapped
++  deflate data.  The header type is detected automatically.  Any information
++  contained in the gzip header is not retained, so applications that need that
++  information should instead use raw inflate, see inflateInit2() below, or
++  inflateBack() and perform their own processing of the gzip header and
++  trailer.
++
++    inflate() returns Z_OK if some progress has been made (more input processed
++  or more output produced), Z_STREAM_END if the end of the compressed data has
++  been reached and all uncompressed output has been produced, Z_NEED_DICT if a
++  preset dictionary is needed at this point, Z_DATA_ERROR if the input data was
++  corrupted (input stream not conforming to the zlib format or incorrect check
++  value), Z_STREAM_ERROR if the stream structure was inconsistent (for example
++  if next_in or next_out was NULL), Z_MEM_ERROR if there was not enough memory,
++  Z_BUF_ERROR if no progress is possible or if there was not enough room in the
++  output buffer when Z_FINISH is used. Note that Z_BUF_ERROR is not fatal, and
++  inflate() can be called again with more input and more output space to
++  continue decompressing. If Z_DATA_ERROR is returned, the application may then
++  call inflateSync() to look for a good compression block if a partial recovery
++  of the data is desired.
++*/
++
++
++ZEXTERN int ZEXPORT inflateEnd OF((z_streamp strm));
++/*
++     All dynamically allocated data structures for this stream are freed.
++   This function discards any unprocessed input and does not flush any
++   pending output.
++
++     inflateEnd returns Z_OK if success, Z_STREAM_ERROR if the stream state
++   was inconsistent. In the error case, msg may be set but then points to a
++   static string (which must not be deallocated).
++*/
++
++                        /* Advanced functions */
++
++/*
++    The following functions are needed only in some special applications.
++*/
++
++/*
++ZEXTERN int ZEXPORT deflateInit2 OF((z_streamp strm,
++                                     int  level,
++                                     int  method,
++                                     int  windowBits,
++                                     int  memLevel,
++                                     int  strategy));
++
++     This is another version of deflateInit with more compression options. The
++   fields next_in, zalloc, zfree and opaque must be initialized before by
++   the caller.
++
++     The method parameter is the compression method. It must be Z_DEFLATED in
++   this version of the library.
++
++     The windowBits parameter is the base two logarithm of the window size
++   (the size of the history buffer). It should be in the range 8..15 for this
++   version of the library. Larger values of this parameter result in better
++   compression at the expense of memory usage. The default value is 15 if
++   deflateInit is used instead.
++
++     windowBits can also be -8..-15 for raw deflate. In this case, -windowBits
++   determines the window size. deflate() will then generate raw deflate data
++   with no zlib header or trailer, and will not compute an adler32 check value.
++
++     windowBits can also be greater than 15 for optional gzip encoding. Add
++   16 to windowBits to write a simple gzip header and trailer around the
++   compressed data instead of a zlib wrapper. The gzip header will have no
++   file name, no extra data, no comment, no modification time (set to zero),
++   no header crc, and the operating system will be set to 255 (unknown).
++
++     The memLevel parameter specifies how much memory should be allocated
++   for the internal compression state. memLevel=1 uses minimum memory but
++   is slow and reduces compression ratio; memLevel=9 uses maximum memory
++   for optimal speed. The default value is 8. See zconf.h for total memory
++   usage as a function of windowBits and memLevel.
++
++     The strategy parameter is used to tune the compression algorithm. Use the
++   value Z_DEFAULT_STRATEGY for normal data, Z_FILTERED for data produced by a
++   filter (or predictor), Z_HUFFMAN_ONLY to force Huffman encoding only (no
++   string match), or Z_RLE to limit match distances to one (run-length
++   encoding). Filtered data consists mostly of small values with a somewhat
++   random distribution. In this case, the compression algorithm is tuned to
++   compress them better. The effect of Z_FILTERED is to force more Huffman
++   coding and less string matching; it is somewhat intermediate between
++   Z_DEFAULT and Z_HUFFMAN_ONLY. Z_RLE is designed to be almost as fast as
++   Z_HUFFMAN_ONLY, but give better compression for PNG image data. The strategy
++   parameter only affects the compression ratio but not the correctness of the
++   compressed output even if it is not set appropriately.
++
++      deflateInit2 returns Z_OK if success, Z_MEM_ERROR if there was not enough
++   memory, Z_STREAM_ERROR if a parameter is invalid (such as an invalid
++   method). msg is set to null if there is no error message.  deflateInit2 does
++   not perform any compression: this will be done by deflate().
++*/
++
++ZEXTERN int ZEXPORT deflateSetDictionary OF((z_streamp strm,
++                                             const Bytef *dictionary,
++                                             uInt  dictLength));
++/*
++     Initializes the compression dictionary from the given byte sequence
++   without producing any compressed output. This function must be called
++   immediately after deflateInit, deflateInit2 or deflateReset, before any
++   call of deflate. The compressor and decompressor must use exactly the same
++   dictionary (see inflateSetDictionary).
++
++     The dictionary should consist of strings (byte sequences) that are likely
++   to be encountered later in the data to be compressed, with the most commonly
++   used strings preferably put towards the end of the dictionary. Using a
++   dictionary is most useful when the data to be compressed is short and can be
++   predicted with good accuracy; the data can then be compressed better than
++   with the default empty dictionary.
++
++     Depending on the size of the compression data structures selected by
++   deflateInit or deflateInit2, a part of the dictionary may in effect be
++   discarded, for example if the dictionary is larger than the window size in
++   deflate or deflate2. Thus the strings most likely to be useful should be
++   put at the end of the dictionary, not at the front.
++
++     Upon return of this function, strm->adler is set to the adler32 value
++   of the dictionary; the decompressor may later use this value to determine
++   which dictionary has been used by the compressor. (The adler32 value
++   applies to the whole dictionary even if only a subset of the dictionary is
++   actually used by the compressor.) If a raw deflate was requested, then the
++   adler32 value is not computed and strm->adler is not set.
++
++     deflateSetDictionary returns Z_OK if success, or Z_STREAM_ERROR if a
++   parameter is invalid (such as NULL dictionary) or the stream state is
++   inconsistent (for example if deflate has already been called for this stream
++   or if the compression method is bsort). deflateSetDictionary does not
++   perform any compression: this will be done by deflate().
++*/
++
++ZEXTERN int ZEXPORT deflateCopy OF((z_streamp dest,
++                                    z_streamp source));
++/*
++     Sets the destination stream as a complete copy of the source stream.
++
++     This function can be useful when several compression strategies will be
++   tried, for example when there are several ways of pre-processing the input
++   data with a filter. The streams that will be discarded should then be freed
++   by calling deflateEnd.  Note that deflateCopy duplicates the internal
++   compression state which can be quite large, so this strategy is slow and
++   can consume lots of memory.
++
++     deflateCopy returns Z_OK if success, Z_MEM_ERROR if there was not
++   enough memory, Z_STREAM_ERROR if the source stream state was inconsistent
++   (such as zalloc being NULL). msg is left unchanged in both source and
++   destination.
++*/
++
++ZEXTERN int ZEXPORT deflateReset OF((z_streamp strm));
++/*
++     This function is equivalent to deflateEnd followed by deflateInit,
++   but does not free and reallocate all the internal compression state.
++   The stream will keep the same compression level and any other attributes
++   that may have been set by deflateInit2.
++
++      deflateReset returns Z_OK if success, or Z_STREAM_ERROR if the source
++   stream state was inconsistent (such as zalloc or state being NULL).
++*/
++
++ZEXTERN int ZEXPORT deflateParams OF((z_streamp strm,
++                                      int level,
++                                      int strategy));
++/*
++     Dynamically update the compression level and compression strategy.  The
++   interpretation of level and strategy is as in deflateInit2.  This can be
++   used to switch between compression and straight copy of the input data, or
++   to switch to a different kind of input data requiring a different
++   strategy. If the compression level is changed, the input available so far
++   is compressed with the old level (and may be flushed); the new level will
++   take effect only at the next call of deflate().
++
++     Before the call of deflateParams, the stream state must be set as for
++   a call of deflate(), since the currently available input may have to
++   be compressed and flushed. In particular, strm->avail_out must be non-zero.
++
++     deflateParams returns Z_OK if success, Z_STREAM_ERROR if the source
++   stream state was inconsistent or if a parameter was invalid, Z_BUF_ERROR
++   if strm->avail_out was zero.
++*/
++
++ZEXTERN uLong ZEXPORT deflateBound OF((z_streamp strm,
++                                       uLong sourceLen));
++/*
++     deflateBound() returns an upper bound on the compressed size after
++   deflation of sourceLen bytes.  It must be called after deflateInit()
++   or deflateInit2().  This would be used to allocate an output buffer
++   for deflation in a single pass, and so would be called before deflate().
++*/
++
++ZEXTERN int ZEXPORT deflatePrime OF((z_streamp strm,
++                                     int bits,
++                                     int value));
++/*
++     deflatePrime() inserts bits in the deflate output stream.  The intent
++  is that this function is used to start off the deflate output with the
++  bits leftover from a previous deflate stream when appending to it.  As such,
++  this function can only be used for raw deflate, and must be used before the
++  first deflate() call after a deflateInit2() or deflateReset().  bits must be
++  less than or equal to 16, and that many of the least significant bits of
++  value will be inserted in the output.
++
++      deflatePrime returns Z_OK if success, or Z_STREAM_ERROR if the source
++   stream state was inconsistent.
++*/
++
++/*
++ZEXTERN int ZEXPORT inflateInit2 OF((z_streamp strm,
++                                     int  windowBits));
++
++     This is another version of inflateInit with an extra parameter. The
++   fields next_in, avail_in, zalloc, zfree and opaque must be initialized
++   before by the caller.
++
++     The windowBits parameter is the base two logarithm of the maximum window
++   size (the size of the history buffer).  It should be in the range 8..15 for
++   this version of the library. The default value is 15 if inflateInit is used
++   instead. windowBits must be greater than or equal to the windowBits value
++   provided to deflateInit2() while compressing, or it must be equal to 15 if
++   deflateInit2() was not used. If a compressed stream with a larger window
++   size is given as input, inflate() will return with the error code
++   Z_DATA_ERROR instead of trying to allocate a larger window.
++
++     windowBits can also be -8..-15 for raw inflate. In this case, -windowBits
++   determines the window size. inflate() will then process raw deflate data,
++   not looking for a zlib or gzip header, not generating a check value, and not
++   looking for any check values for comparison at the end of the stream. This
++   is for use with other formats that use the deflate compressed data format
++   such as zip.  Those formats provide their own check values. If a custom
++   format is developed using the raw deflate format for compressed data, it is
++   recommended that a check value such as an adler32 or a crc32 be applied to
++   the uncompressed data as is done in the zlib, gzip, and zip formats.  For
++   most applications, the zlib format should be used as is. Note that comments
++   above on the use in deflateInit2() applies to the magnitude of windowBits.
++
++     windowBits can also be greater than 15 for optional gzip decoding. Add
++   32 to windowBits to enable zlib and gzip decoding with automatic header
++   detection, or add 16 to decode only the gzip format (the zlib format will
++   return a Z_DATA_ERROR).
++
++     inflateInit2 returns Z_OK if success, Z_MEM_ERROR if there was not enough
++   memory, Z_STREAM_ERROR if a parameter is invalid (such as a negative
++   memLevel). msg is set to null if there is no error message.  inflateInit2
++   does not perform any decompression apart from reading the zlib header if
++   present: this will be done by inflate(). (So next_in and avail_in may be
++   modified, but next_out and avail_out are unchanged.)
++*/
++
++ZEXTERN int ZEXPORT inflateSetDictionary OF((z_streamp strm,
++                                             const Bytef *dictionary,
++                                             uInt  dictLength));
++/*
++     Initializes the decompression dictionary from the given uncompressed byte
++   sequence. This function must be called immediately after a call of inflate
++   if this call returned Z_NEED_DICT. The dictionary chosen by the compressor
++   can be determined from the adler32 value returned by this call of
++   inflate. The compressor and decompressor must use exactly the same
++   dictionary (see deflateSetDictionary).
++
++     inflateSetDictionary returns Z_OK if success, Z_STREAM_ERROR if a
++   parameter is invalid (such as NULL dictionary) or the stream state is
++   inconsistent, Z_DATA_ERROR if the given dictionary doesn't match the
++   expected one (incorrect adler32 value). inflateSetDictionary does not
++   perform any decompression: this will be done by subsequent calls of
++   inflate().
++*/
++
++ZEXTERN int ZEXPORT inflateSync OF((z_streamp strm));
++/*
++    Skips invalid compressed data until a full flush point (see above the
++  description of deflate with Z_FULL_FLUSH) can be found, or until all
++  available input is skipped. No output is provided.
++
++    inflateSync returns Z_OK if a full flush point has been found, Z_BUF_ERROR
++  if no more input was provided, Z_DATA_ERROR if no flush point has been found,
++  or Z_STREAM_ERROR if the stream structure was inconsistent. In the success
++  case, the application may save the current current value of total_in which
++  indicates where valid compressed data was found. In the error case, the
++  application may repeatedly call inflateSync, providing more input each time,
++  until success or end of the input data.
++*/
++
++ZEXTERN int ZEXPORT inflateCopy OF((z_streamp dest,
++                                    z_streamp source));
++/*
++     Sets the destination stream as a complete copy of the source stream.
++
++     This function can be useful when randomly accessing a large stream.  The
++   first pass through the stream can periodically record the inflate state,
++   allowing restarting inflate at those points when randomly accessing the
++   stream.
++
++     inflateCopy returns Z_OK if success, Z_MEM_ERROR if there was not
++   enough memory, Z_STREAM_ERROR if the source stream state was inconsistent
++   (such as zalloc being NULL). msg is left unchanged in both source and
++   destination.
++*/
++
++ZEXTERN int ZEXPORT inflateReset OF((z_streamp strm));
++/*
++     This function is equivalent to inflateEnd followed by inflateInit,
++   but does not free and reallocate all the internal decompression state.
++   The stream will keep attributes that may have been set by inflateInit2.
++
++      inflateReset returns Z_OK if success, or Z_STREAM_ERROR if the source
++   stream state was inconsistent (such as zalloc or state being NULL).
++*/
++
++/*
++ZEXTERN int ZEXPORT inflateBackInit OF((z_stream FAR *strm, int windowBits,
++                                        unsigned char FAR *window));
++
++     Initialize the internal stream state for decompression using inflateBack()
++   calls.  The fields zalloc, zfree and opaque in strm must be initialized
++   before the call.  If zalloc and zfree are Z_NULL, then the default library-
++   derived memory allocation routines are used.  windowBits is the base two
++   logarithm of the window size, in the range 8..15.  window is a caller
++   supplied buffer of that size.  Except for special applications where it is
++   assured that deflate was used with small window sizes, windowBits must be 15
++   and a 32K byte window must be supplied to be able to decompress general
++   deflate streams.
++
++     See inflateBack() for the usage of these routines.
++
++     inflateBackInit will return Z_OK on success, Z_STREAM_ERROR if any of
++   the paramaters are invalid, Z_MEM_ERROR if the internal state could not
++   be allocated, or Z_VERSION_ERROR if the version of the library does not
++   match the version of the header file.
++*/
++
++typedef unsigned (*in_func) OF((void FAR *, unsigned char FAR * FAR *));
++typedef int (*out_func) OF((void FAR *, unsigned char FAR *, unsigned));
++
++ZEXTERN int ZEXPORT inflateBack OF((z_stream FAR *strm,
++                                    in_func in, void FAR *in_desc,
++                                    out_func out, void FAR *out_desc));
++/*
++     inflateBack() does a raw inflate with a single call using a call-back
++   interface for input and output.  This is more efficient than inflate() for
++   file i/o applications in that it avoids copying between the output and the
++   sliding window by simply making the window itself the output buffer.  This
++   function trusts the application to not change the output buffer passed by
++   the output function, at least until inflateBack() returns.
++
++     inflateBackInit() must be called first to allocate the internal state
++   and to initialize the state with the user-provided window buffer.
++   inflateBack() may then be used multiple times to inflate a complete, raw
++   deflate stream with each call.  inflateBackEnd() is then called to free
++   the allocated state.
++
++     A raw deflate stream is one with no zlib or gzip header or trailer.
++   This routine would normally be used in a utility that reads zip or gzip
++   files and writes out uncompressed files.  The utility would decode the
++   header and process the trailer on its own, hence this routine expects
++   only the raw deflate stream to decompress.  This is different from the
++   normal behavior of inflate(), which expects either a zlib or gzip header and
++   trailer around the deflate stream.
++
++     inflateBack() uses two subroutines supplied by the caller that are then
++   called by inflateBack() for input and output.  inflateBack() calls those
++   routines until it reads a complete deflate stream and writes out all of the
++   uncompressed data, or until it encounters an error.  The function's
++   parameters and return types are defined above in the in_func and out_func
++   typedefs.  inflateBack() will call in(in_desc, &buf) which should return the
++   number of bytes of provided input, and a pointer to that input in buf.  If
++   there is no input available, in() must return zero--buf is ignored in that
++   case--and inflateBack() will return a buffer error.  inflateBack() will call
++   out(out_desc, buf, len) to write the uncompressed data buf[0..len-1].  out()
++   should return zero on success, or non-zero on failure.  If out() returns
++   non-zero, inflateBack() will return with an error.  Neither in() nor out()
++   are permitted to change the contents of the window provided to
++   inflateBackInit(), which is also the buffer that out() uses to write from.
++   The length written by out() will be at most the window size.  Any non-zero
++   amount of input may be provided by in().
++
++     For convenience, inflateBack() can be provided input on the first call by
++   setting strm->next_in and strm->avail_in.  If that input is exhausted, then
++   in() will be called.  Therefore strm->next_in must be initialized before
++   calling inflateBack().  If strm->next_in is Z_NULL, then in() will be called
++   immediately for input.  If strm->next_in is not Z_NULL, then strm->avail_in
++   must also be initialized, and then if strm->avail_in is not zero, input will
++   initially be taken from strm->next_in[0 .. strm->avail_in - 1].
++
++     The in_desc and out_desc parameters of inflateBack() is passed as the
++   first parameter of in() and out() respectively when they are called.  These
++   descriptors can be optionally used to pass any information that the caller-
++   supplied in() and out() functions need to do their job.
++
++     On return, inflateBack() will set strm->next_in and strm->avail_in to
++   pass back any unused input that was provided by the last in() call.  The
++   return values of inflateBack() can be Z_STREAM_END on success, Z_BUF_ERROR
++   if in() or out() returned an error, Z_DATA_ERROR if there was a format
++   error in the deflate stream (in which case strm->msg is set to indicate the
++   nature of the error), or Z_STREAM_ERROR if the stream was not properly
++   initialized.  In the case of Z_BUF_ERROR, an input or output error can be
++   distinguished using strm->next_in which will be Z_NULL only if in() returned
++   an error.  If strm->next is not Z_NULL, then the Z_BUF_ERROR was due to
++   out() returning non-zero.  (in() will always be called before out(), so
++   strm->next_in is assured to be defined if out() returns non-zero.)  Note
++   that inflateBack() cannot return Z_OK.
++*/
++
++ZEXTERN int ZEXPORT inflateBackEnd OF((z_stream FAR *strm));
++/*
++     All memory allocated by inflateBackInit() is freed.
++
++     inflateBackEnd() returns Z_OK on success, or Z_STREAM_ERROR if the stream
++   state was inconsistent.
++*/
++
++ZEXTERN uLong ZEXPORT zlibCompileFlags OF((void));
++/* Return flags indicating compile-time options.
++
++    Type sizes, two bits each, 00 = 16 bits, 01 = 32, 10 = 64, 11 = other:
++     1.0: size of uInt
++     3.2: size of uLong
++     5.4: size of voidpf (pointer)
++     7.6: size of z_off_t
++
++    Compiler, assembler, and debug options:
++     8: DEBUG
++     9: ASMV or ASMINF -- use ASM code
++     10: ZLIB_WINAPI -- exported functions use the WINAPI calling convention
++     11: 0 (reserved)
++
++    One-time table building (smaller code, but not thread-safe if true):
++     12: BUILDFIXED -- build static block decoding tables when needed
++     13: DYNAMIC_CRC_TABLE -- build CRC calculation tables when needed
++     14,15: 0 (reserved)
++
++    Library content (indicates missing functionality):
++     16: NO_GZCOMPRESS -- gz* functions cannot compress (to avoid linking
++                          deflate code when not needed)
++     17: NO_GZIP -- deflate can't write gzip streams, and inflate can't detect
++                    and decode gzip streams (to avoid linking crc code)
++     18-19: 0 (reserved)
++
++    Operation variations (changes in library functionality):
++     20: PKZIP_BUG_WORKAROUND -- slightly more permissive inflate
++     21: FASTEST -- deflate algorithm with only one, lowest compression level
++     22,23: 0 (reserved)
++
++    The sprintf variant used by gzprintf (zero is best):
++     24: 0 = vs*, 1 = s* -- 1 means limited to 20 arguments after the format
++     25: 0 = *nprintf, 1 = *printf -- 1 means gzprintf() not secure!
++     26: 0 = returns value, 1 = void -- 1 means inferred string length returned
++
++    Remainder:
++     27-31: 0 (reserved)
++ */
++
++
++                        /* utility functions */
++
++/*
++     The following utility functions are implemented on top of the
++   basic stream-oriented functions. To simplify the interface, some
++   default options are assumed (compression level and memory usage,
++   standard memory allocation functions). The source code of these
++   utility functions can easily be modified if you need special options.
++*/
++
++ZEXTERN int ZEXPORT compress OF((Bytef *dest,   uLongf *destLen,
++                                 const Bytef *source, uLong sourceLen));
++/*
++     Compresses the source buffer into the destination buffer.  sourceLen is
++   the byte length of the source buffer. Upon entry, destLen is the total
++   size of the destination buffer, which must be at least the value returned
++   by compressBound(sourceLen). Upon exit, destLen is the actual size of the
++   compressed buffer.
++     This function can be used to compress a whole file at once if the
++   input file is mmap'ed.
++     compress returns Z_OK if success, Z_MEM_ERROR if there was not
++   enough memory, Z_BUF_ERROR if there was not enough room in the output
++   buffer.
++*/
++
++ZEXTERN int ZEXPORT compress2 OF((Bytef *dest,   uLongf *destLen,
++                                  const Bytef *source, uLong sourceLen,
++                                  int level));
++/*
++     Compresses the source buffer into the destination buffer. The level
++   parameter has the same meaning as in deflateInit.  sourceLen is the byte
++   length of the source buffer. Upon entry, destLen is the total size of the
++   destination buffer, which must be at least the value returned by
++   compressBound(sourceLen). Upon exit, destLen is the actual size of the
++   compressed buffer.
++
++     compress2 returns Z_OK if success, Z_MEM_ERROR if there was not enough
++   memory, Z_BUF_ERROR if there was not enough room in the output buffer,
++   Z_STREAM_ERROR if the level parameter is invalid.
++*/
++
++ZEXTERN uLong ZEXPORT compressBound OF((uLong sourceLen));
++/*
++     compressBound() returns an upper bound on the compressed size after
++   compress() or compress2() on sourceLen bytes.  It would be used before
++   a compress() or compress2() call to allocate the destination buffer.
++*/
++
++ZEXTERN int ZEXPORT uncompress OF((Bytef *dest,   uLongf *destLen,
++                                   const Bytef *source, uLong sourceLen));
++/*
++     Decompresses the source buffer into the destination buffer.  sourceLen is
++   the byte length of the source buffer. Upon entry, destLen is the total
++   size of the destination buffer, which must be large enough to hold the
++   entire uncompressed data. (The size of the uncompressed data must have
++   been saved previously by the compressor and transmitted to the decompressor
++   by some mechanism outside the scope of this compression library.)
++   Upon exit, destLen is the actual size of the compressed buffer.
++     This function can be used to decompress a whole file at once if the
++   input file is mmap'ed.
++
++     uncompress returns Z_OK if success, Z_MEM_ERROR if there was not
++   enough memory, Z_BUF_ERROR if there was not enough room in the output
++   buffer, or Z_DATA_ERROR if the input data was corrupted or incomplete.
++*/
++
++
++typedef voidp gzFile;
++
++ZEXTERN gzFile ZEXPORT gzopen  OF((const char *path, const char *mode));
++/*
++     Opens a gzip (.gz) file for reading or writing. The mode parameter
++   is as in fopen ("rb" or "wb") but can also include a compression level
++   ("wb9") or a strategy: 'f' for filtered data as in "wb6f", 'h' for
++   Huffman only compression as in "wb1h", or 'R' for run-length encoding
++   as in "wb1R". (See the description of deflateInit2 for more information
++   about the strategy parameter.)
++
++     gzopen can be used to read a file which is not in gzip format; in this
++   case gzread will directly read from the file without decompression.
++
++     gzopen returns NULL if the file could not be opened or if there was
++   insufficient memory to allocate the (de)compression state; errno
++   can be checked to distinguish the two cases (if errno is zero, the
++   zlib error is Z_MEM_ERROR).  */
++
++ZEXTERN gzFile ZEXPORT gzdopen  OF((int fd, const char *mode));
++/*
++     gzdopen() associates a gzFile with the file descriptor fd.  File
++   descriptors are obtained from calls like open, dup, creat, pipe or
++   fileno (in the file has been previously opened with fopen).
++   The mode parameter is as in gzopen.
++     The next call of gzclose on the returned gzFile will also close the
++   file descriptor fd, just like fclose(fdopen(fd), mode) closes the file
++   descriptor fd. If you want to keep fd open, use gzdopen(dup(fd), mode).
++     gzdopen returns NULL if there was insufficient memory to allocate
++   the (de)compression state.
++*/
++
++ZEXTERN int ZEXPORT gzsetparams OF((gzFile file, int level, int strategy));
++/*
++     Dynamically update the compression level or strategy. See the description
++   of deflateInit2 for the meaning of these parameters.
++     gzsetparams returns Z_OK if success, or Z_STREAM_ERROR if the file was not
++   opened for writing.
++*/
++
++ZEXTERN int ZEXPORT    gzread  OF((gzFile file, voidp buf, unsigned len));
++/*
++     Reads the given number of uncompressed bytes from the compressed file.
++   If the input file was not in gzip format, gzread copies the given number
++   of bytes into the buffer.
++     gzread returns the number of uncompressed bytes actually read (0 for
++   end of file, -1 for error). */
++
++ZEXTERN int ZEXPORT    gzwrite OF((gzFile file,
++                                   voidpc buf, unsigned len));
++/*
++     Writes the given number of uncompressed bytes into the compressed file.
++   gzwrite returns the number of uncompressed bytes actually written
++   (0 in case of error).
++*/
++
++ZEXTERN int ZEXPORTVA   gzprintf OF((gzFile file, const char *format, ...));
++/*
++     Converts, formats, and writes the args to the compressed file under
++   control of the format string, as in fprintf. gzprintf returns the number of
++   uncompressed bytes actually written (0 in case of error).  The number of
++   uncompressed bytes written is limited to 4095. The caller should assure that
++   this limit is not exceeded. If it is exceeded, then gzprintf() will return
++   return an error (0) with nothing written. In this case, there may also be a
++   buffer overflow with unpredictable consequences, which is possible only if
++   zlib was compiled with the insecure functions sprintf() or vsprintf()
++   because the secure snprintf() or vsnprintf() functions were not available.
++*/
++
++ZEXTERN int ZEXPORT gzputs OF((gzFile file, const char *s));
++/*
++      Writes the given null-terminated string to the compressed file, excluding
++   the terminating null character.
++      gzputs returns the number of characters written, or -1 in case of error.
++*/
++
++ZEXTERN char * ZEXPORT gzgets OF((gzFile file, char *buf, int len));
++/*
++      Reads bytes from the compressed file until len-1 characters are read, or
++   a newline character is read and transferred to buf, or an end-of-file
++   condition is encountered.  The string is then terminated with a null
++   character.
++      gzgets returns buf, or Z_NULL in case of error.
++*/
++
++ZEXTERN int ZEXPORT    gzputc OF((gzFile file, int c));
++/*
++      Writes c, converted to an unsigned char, into the compressed file.
++   gzputc returns the value that was written, or -1 in case of error.
++*/
++
++ZEXTERN int ZEXPORT    gzgetc OF((gzFile file));
++/*
++      Reads one byte from the compressed file. gzgetc returns this byte
++   or -1 in case of end of file or error.
++*/
++
++ZEXTERN int ZEXPORT    gzungetc OF((int c, gzFile file));
++/*
++      Push one character back onto the stream to be read again later.
++   Only one character of push-back is allowed.  gzungetc() returns the
++   character pushed, or -1 on failure.  gzungetc() will fail if a
++   character has been pushed but not read yet, or if c is -1. The pushed
++   character will be discarded if the stream is repositioned with gzseek()
++   or gzrewind().
++*/
++
++ZEXTERN int ZEXPORT    gzflush OF((gzFile file, int flush));
++/*
++     Flushes all pending output into the compressed file. The parameter
++   flush is as in the deflate() function. The return value is the zlib
++   error number (see function gzerror below). gzflush returns Z_OK if
++   the flush parameter is Z_FINISH and all output could be flushed.
++     gzflush should be called only when strictly necessary because it can
++   degrade compression.
++*/
++
++ZEXTERN z_off_t ZEXPORT    gzseek OF((gzFile file,
++                                      z_off_t offset, int whence));
++/*
++      Sets the starting position for the next gzread or gzwrite on the
++   given compressed file. The offset represents a number of bytes in the
++   uncompressed data stream. The whence parameter is defined as in lseek(2);
++   the value SEEK_END is not supported.
++     If the file is opened for reading, this function is emulated but can be
++   extremely slow. If the file is opened for writing, only forward seeks are
++   supported; gzseek then compresses a sequence of zeroes up to the new
++   starting position.
++
++      gzseek returns the resulting offset location as measured in bytes from
++   the beginning of the uncompressed stream, or -1 in case of error, in
++   particular if the file is opened for writing and the new starting position
++   would be before the current position.
++*/
++
++ZEXTERN int ZEXPORT    gzrewind OF((gzFile file));
++/*
++     Rewinds the given file. This function is supported only for reading.
++
++   gzrewind(file) is equivalent to (int)gzseek(file, 0L, SEEK_SET)
++*/
++
++ZEXTERN z_off_t ZEXPORT    gztell OF((gzFile file));
++/*
++     Returns the starting position for the next gzread or gzwrite on the
++   given compressed file. This position represents a number of bytes in the
++   uncompressed data stream.
++
++   gztell(file) is equivalent to gzseek(file, 0L, SEEK_CUR)
++*/
++
++ZEXTERN int ZEXPORT gzeof OF((gzFile file));
++/*
++     Returns 1 when EOF has previously been detected reading the given
++   input stream, otherwise zero.
++*/
++
++ZEXTERN int ZEXPORT    gzclose OF((gzFile file));
++/*
++     Flushes all pending output if necessary, closes the compressed file
++   and deallocates all the (de)compression state. The return value is the zlib
++   error number (see function gzerror below).
++*/
++
++ZEXTERN const char * ZEXPORT gzerror OF((gzFile file, int *errnum));
++/*
++     Returns the error message for the last error which occurred on the
++   given compressed file. errnum is set to zlib error number. If an
++   error occurred in the file system and not in the compression library,
++   errnum is set to Z_ERRNO and the application may consult errno
++   to get the exact error code.
++*/
++
++ZEXTERN void ZEXPORT gzclearerr OF((gzFile file));
++/*
++     Clears the error and end-of-file flags for file. This is analogous to the
++   clearerr() function in stdio. This is useful for continuing to read a gzip
++   file that is being written concurrently.
++*/
++
++                        /* checksum functions */
++
++/*
++     These functions are not related to compression but are exported
++   anyway because they might be useful in applications using the
++   compression library.
++*/
++
++ZEXTERN uLong ZEXPORT adler32 OF((uLong adler, const Bytef *buf, uInt len));
++
++/*
++     Update a running Adler-32 checksum with the bytes buf[0..len-1] and
++   return the updated checksum. If buf is NULL, this function returns
++   the required initial value for the checksum.
++   An Adler-32 checksum is almost as reliable as a CRC32 but can be computed
++   much faster. Usage example:
++
++     uLong adler = adler32(0L, Z_NULL, 0);
++
++     while (read_buffer(buffer, length) != EOF) {
++       adler = adler32(adler, buffer, length);
++     }
++     if (adler != original_adler) error();
++*/
++
++ZEXTERN uLong ZEXPORT crc32   OF((uLong crc, const Bytef *buf, uInt len));
++/*
++     Update a running crc with the bytes buf[0..len-1] and return the updated
++   crc. If buf is NULL, this function returns the required initial value
++   for the crc. Pre- and post-conditioning (one's complement) is performed
++   within this function so it shouldn't be done by the application.
++   Usage example:
++
++     uLong crc = crc32(0L, Z_NULL, 0);
++
++     while (read_buffer(buffer, length) != EOF) {
++       crc = crc32(crc, buffer, length);
++     }
++     if (crc != original_crc) error();
++*/
++
++
++                        /* various hacks, don't look :) */
++
++/* deflateInit and inflateInit are macros to allow checking the zlib version
++ * and the compiler's view of z_stream:
++ */
++ZEXTERN int ZEXPORT deflateInit_ OF((z_streamp strm, int level,
++                                     const char *version, int stream_size));
++ZEXTERN int ZEXPORT inflateInit_ OF((z_streamp strm,
++                                     const char *version, int stream_size));
++ZEXTERN int ZEXPORT deflateInit2_ OF((z_streamp strm, int  level, int  method,
++                                      int windowBits, int memLevel,
++                                      int strategy, const char *version,
++                                      int stream_size));
++ZEXTERN int ZEXPORT inflateInit2_ OF((z_streamp strm, int  windowBits,
++                                      const char *version, int stream_size));
++ZEXTERN int ZEXPORT inflateBackInit_ OF((z_stream FAR *strm, int windowBits,
++                                         unsigned char FAR *window,
++                                         const char *version,
++                                         int stream_size));
++#define deflateInit(strm, level) \
++        deflateInit_((strm), (level),       ZLIB_VERSION, sizeof(z_stream))
++#define inflateInit(strm) \
++        inflateInit_((strm),                ZLIB_VERSION, sizeof(z_stream))
++#define deflateInit2(strm, level, method, windowBits, memLevel, strategy) \
++        deflateInit2_((strm),(level),(method),(windowBits),(memLevel),\
++                      (strategy),           ZLIB_VERSION, sizeof(z_stream))
++#define inflateInit2(strm, windowBits) \
++        inflateInit2_((strm), (windowBits), ZLIB_VERSION, sizeof(z_stream))
++#define inflateBackInit(strm, windowBits, window) \
++        inflateBackInit_((strm), (windowBits), (window), \
++        ZLIB_VERSION, sizeof(z_stream))
++
++
++#if !defined(ZUTIL_H) && !defined(NO_DUMMY_DECL)
++    struct internal_state {int dummy;}; /* hack for buggy compilers */
++#endif
++
++ZEXTERN const char   * ZEXPORT zError           OF((int err));
++ZEXTERN int            ZEXPORT inflateSyncPoint OF((z_streamp z));
++ZEXTERN const uLongf * ZEXPORT get_crc_table    OF((void));
++
++#ifdef __cplusplus
++}
++#endif
++
++#endif /* ZLIB_H */
diff -ruN php-5.5.1.orig/fink/patches/033-we_WANT_libtool.patch php-5.5.1/fink/patches/033-we_WANT_libtool.patch
--- php-5.5.1.orig/fink/patches/033-we_WANT_libtool.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/033-we_WANT_libtool.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,25 @@
+Description:
+ upstream ships an out of date version of libtool.  this ensures that
+ we build against an up-to-date version of libtool by running libtoolize
+ as part of our build process (this is called indirectly via ./buildconf.sh
+ from debian/rules)
+ .
+ note that we don't touch the libtool.m4 that they ship here, and this file
+ gets included in the build process as part of the phpize stuff.  however,
+ this is solved in ./debian/rules where it's overwritten with a symlink.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/build/build2.mk
++++ php5/build/build2.mk
+@@ -46,7 +46,8 @@ $(TOUCH_FILES):
+ 
+ aclocal.m4: configure.in acinclude.m4
+ 	@echo rebuilding $@
+-	cat acinclude.m4 ./build/libtool.m4 > $@
++	libtoolize --copy --install --automake --force
++	aclocal
+ 
+ configure: aclocal.m4 configure.in $(config_m4_files)
+ 	@echo rebuilding $@
diff -ruN php-5.5.1.orig/fink/patches/034-apache2_umask_fix.patch php-5.5.1/fink/patches/034-apache2_umask_fix.patch
--- php-5.5.1.orig/fink/patches/034-apache2_umask_fix.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/034-apache2_umask_fix.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,50 @@
+Description: Save and restore umask across requests correctly.
+ .
+ Check if this is still an issue not addressed by upstream in some
+ other way already.
+Origin: other
+Bug-Debian: http://bugs.debian.org/286225
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- a/sapi/apache2handler/sapi_apache2.c
++++ b/sapi/apache2handler/sapi_apache2.c
+@@ -468,6 +468,19 @@ static apr_status_t php_server_context_c
+ 	return APR_SUCCESS;
+ }
+ 
++static int saved_umask;
++
++static void php_save_umask(void)
++{
++	saved_umask = umask(077);
++	umask(saved_umask);
++}
++
++static void php_restore_umask(void)
++{
++	umask(saved_umask);
++}
++
+ static int php_apache_request_ctor(request_rec *r, php_struct *ctx TSRMLS_DC)
+ {
+ 	char *content_length;
+@@ -658,6 +671,8 @@ zend_first_try {
+ 	} else {
+ 		zend_file_handle zfd;
+ 
++		php_save_umask();
++
+ 		zfd.type = ZEND_HANDLE_FILENAME;
+ 		zfd.filename = (char *) r->filename;
+ 		zfd.free_filename = 0;
+@@ -669,6 +684,9 @@ zend_first_try {
+ 			zend_execute_scripts(ZEND_INCLUDE TSRMLS_CC, NULL, 1, &zfd);
+ 		}
+ 
++		php_restore_umask();
++
++
+ 		apr_table_set(r->notes, "mod_php_memory_usage",
+ 			apr_psprintf(ctx->r->pool, "%zu", zend_memory_peak_usage(1 TSRMLS_CC)));
+ 	}
diff -ruN php-5.5.1.orig/fink/patches/036-fd_setsize_fix.patch php-5.5.1/fink/patches/036-fd_setsize_fix.patch
--- php-5.5.1.orig/fink/patches/036-fd_setsize_fix.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/036-fd_setsize_fix.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,27 @@
+Description: Fixes misuse of FD_SET()
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/sockets/sockets.c
++++ php5/ext/sockets/sockets.c
+@@ -780,6 +780,7 @@ static int php_sock_array_to_fd_set(zval
+ 
+ 		php_sock = (php_socket*) zend_fetch_resource(element TSRMLS_CC, -1, le_socket_name, NULL, 1, le_socket);
+ 		if (!php_sock) continue; /* If element is not a resource, skip it */
++		if (php_sock->bsd_socket > FD_SETSIZE) continue; /* must ignore it */
+ 
+ 		PHP_SAFE_FD_SET(php_sock->bsd_socket, fds);
+ 		if (php_sock->bsd_socket > *max_fd) {
+--- php5.orig/ext/standard/streamsfuncs.c
++++ php5/ext/standard/streamsfuncs.c
+@@ -628,6 +628,9 @@ static int stream_array_to_fd_set(zval *
+ 
+ 			php_socket_t this_fd = (php_socket_t)tmp_fd;
+ 
++			if (this_fd > FD_SETSIZE)
++				continue;
++
+ 			PHP_SAFE_FD_SET(this_fd, fds);
+ 
+ 			if (this_fd > *max_fd) {
diff -ruN php-5.5.1.orig/fink/patches/043-recode_size_t.patch php-5.5.1/fink/patches/043-recode_size_t.patch
--- php-5.5.1.orig/fink/patches/043-recode_size_t.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/043-recode_size_t.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,17 @@
+Description: Check for possible overflows in recode_string()
+Origin: vendor
+Bug-Debian: http://bugs.debian.org/294986, http://bugs.debian.org/459020
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/recode/recode.c
++++ php5/ext/recode/recode.c
+@@ -149,7 +149,7 @@ PHP_FUNCTION(recode_string)
+ 	int req_len, str_len;
+ 	char *req, *str;
+ 
+-	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "ss", &req, &req_len, &str, &str_len) == FAILURE) {
++	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "ss", &req, &req_len, &str, &str_len) == FAILURE || str_len < 0) {
+ 		return;
+ 	}
+ 
diff -ruN php-5.5.1.orig/fink/patches/044-strtod_arm_fix.patch php-5.5.1/fink/patches/044-strtod_arm_fix.patch
--- php-5.5.1.orig/fink/patches/044-strtod_arm_fix.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/044-strtod_arm_fix.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,54 @@
+--- php5.orig/Zend/zend_strtod.c
++++ php5/Zend/zend_strtod.c
+@@ -152,14 +152,25 @@ typedef unsigned long int uint32_t;
+ #define IEEE_LITTLE_ENDIAN
+ #endif
+ 
+-#if defined(__arm__) && !defined(__VFP_FP__)
+-/*
+- *  * Although the CPU is little endian the FP has different
+- *   * byte and word endianness. The byte order is still little endian
+- *    * but the word order is big endian.
+- *     */
+-#define IEEE_BIG_ENDIAN
++#if defined(__arm__) || defined(__thumb__)
++/* ARM traditionally used big-endian words; and within those words the
++   byte ordering was big or little endian depending upon the target.
++   Modern floating-point formats are naturally ordered; in this case
++   __VFP_FP__ will be defined, even if soft-float. */
+ #undef IEEE_LITTLE_ENDIAN
++#undef IEEE_BIG_ENDIAN
++#if defined(__VFP_FP__) || defined(__MAVERICK__)
++# ifdef __ARMEL__
++#  define IEEE_LITTLE_ENDIAN
++# else
++#  define IEEE_BIG_ENDIAN
++# endif
++#else
++# define IEEE_BIG_ENDIAN
++# ifdef __ARMEL__
++#  define IEEE_BYTES_LITTLE_ENDIAN
++# endif
++#endif
+ #endif
+ 
+ #ifdef __vax__
+@@ -267,8 +278,7 @@ BEGIN_EXTERN_C()
+ 
+ #if defined(IEEE_LITTLE_ENDIAN) + defined(IEEE_BIG_ENDIAN) + defined(VAX) + \
+ 		    defined(IBM) != 1
+-	Exactly one of IEEE_LITTLE_ENDIAN IEEE_BIG_ENDIAN, VAX, or
+-	IBM should be defined.
++#error "Exactly one of IEEE_LITTLE_ENDIAN IEEE_BIG_ENDIAN, VAX, or IBM should be defined."
+ #endif
+ 
+ 	typedef union {
+@@ -288,7 +298,7 @@ BEGIN_EXTERN_C()
+  * An alternative that might be better on some machines is
+  * #define Storeinc(a,b,c) (*a++ = b << 16 | c & 0xffff)
+  */
+-#if defined(IEEE_LITTLE_ENDIAN) + defined(VAX) + defined(__arm__)
++#if defined(IEEE_LITTLE_ENDIAN) + defined(VAX) + defined(IEEE_BYTES_LITTLE_ENDIAN)
+ #define Storeinc(a,b,c) (((unsigned short *)a)[1] = (unsigned short)b, \
+ 		((unsigned short *)a)[0] = (unsigned short)c, a++)
+ #else
diff -ruN php-5.5.1.orig/fink/patches/045-exif_nesting_level.patch php-5.5.1/fink/patches/045-exif_nesting_level.patch
--- php-5.5.1.orig/fink/patches/045-exif_nesting_level.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/045-exif_nesting_level.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,16 @@
+Description: Increase maximum exif nesting level.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/exif/exif.c
++++ php5/ext/exif/exif.c
+@@ -99,7 +99,7 @@ typedef unsigned char uchar;
+ 
+ #define EFREE_IF(ptr)	if (ptr) efree(ptr)
+ 
+-#define MAX_IFD_NESTING_LEVEL 100
++#define MAX_IFD_NESTING_LEVEL 250
+ 
+ /* {{{ arginfo */
+ ZEND_BEGIN_ARG_INFO(arginfo_exif_tagname, 0)
diff -ruN php-5.5.1.orig/fink/patches/047-zts_with_dl.patch php-5.5.1/fink/patches/047-zts_with_dl.patch
--- php-5.5.1.orig/fink/patches/047-zts_with_dl.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/047-zts_with_dl.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,15 @@
+--- php5.orig/ext/standard/dl.c
++++ php5/ext/standard/dl.c
+@@ -74,12 +74,7 @@ PHPAPI PHP_FUNCTION(dl)
+ 		(strcmp(sapi_module.name, "cli") != 0) &&
+ 		(strncmp(sapi_module.name, "embed", 5) != 0)
+ 	) {
+-#ifdef ZTS
+-		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Not supported in multithreaded Web servers - use extension=%s in your php.ini", filename);
+-		RETURN_FALSE;
+-#else
+ 		php_error_docref(NULL TSRMLS_CC, E_DEPRECATED, "dl() is deprecated - use extension=%s in your php.ini", filename);
+-#endif
+ 	}
+ 
+ 	php_dl(filename, MODULE_TEMPORARY, return_value, 0 TSRMLS_CC);
diff -ruN php-5.5.1.orig/fink/patches/052-phpinfo_no_configure.patch php-5.5.1/fink/patches/052-phpinfo_no_configure.patch
--- php-5.5.1.orig/fink/patches/052-phpinfo_no_configure.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/052-phpinfo_no_configure.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,33 @@
+Description: Disable configure parameters on phpinfo() output
+ .
+ Patch needs to be discussed with upstream and the issues that lead to
+ its addition re-checked.  Quoting changelog entry:
+ .
+ Add [...], which disables the display of our "Configure Command" in
+ phpinfo(), which was the source of many bogus bug reports over the
+ years, due to people misinterpreting its meaning.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/standard/info.c
++++ php5/ext/standard/info.c
+@@ -709,7 +709,7 @@ PHPAPI void php_print_info(int flag TSRM
+ #ifdef ARCHITECTURE
+ 		php_info_print_table_row(2, "Architecture", ARCHITECTURE);
+ #endif
+-#ifdef CONFIGURE_COMMAND
++#if 0
+ 		php_info_print_table_row(2, "Configure Command", CONFIGURE_COMMAND );
+ #endif
+ 
+--- php5.orig/ext/standard/tests/general_functions/phpinfo.phpt
++++ php5/ext/standard/tests/general_functions/phpinfo.phpt
+@@ -20,7 +20,6 @@ PHP Version => %s
+ 
+ System => %s
+ Build Date => %s%a
+-Configure Command => %s
+ Server API => Command Line Interface
+ Virtual Directory Support => %s
+ Configuration File (php.ini) Path => %s
diff -ruN php-5.5.1.orig/fink/patches/053-extension_api.patch php-5.5.1/fink/patches/053-extension_api.patch
--- php-5.5.1.orig/fink/patches/053-extension_api.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/053-extension_api.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,59 @@
+Description: Adds --phpapi argument to php-config(1)
+ .
+ TODO: make it more generic and add it to the man page.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/configure.in
++++ php5/configure.in
+@@ -1177,8 +1177,13 @@ dnl Build extension directory path
+ 
+ ZEND_MODULE_API_NO=`$EGREP '#define ZEND_MODULE_API_NO ' $srcdir/Zend/zend_modules.h|$SED 's/#define ZEND_MODULE_API_NO //'`
+ 
++DEBIAN_PHP_API=$ZEND_MODULE_API_NO
++if echo "$CPPFLAGS $CFLAGS" | grep -q -- -D_FILE_OFFSET_BITS=64; then
++  DEBIAN_PHP_API="${DEBIAN_PHP_API}+lfs"
++fi
++
+ if test -z "$EXTENSION_DIR"; then
+-  extbasedir=$ZEND_MODULE_API_NO
++  extbasedir=$DEBIAN_PHP_API
+   if test "$oldstyleextdir" = "yes"; then
+     if test "$PHP_DEBUG" = "1"; then
+       part1=debug
+@@ -1321,6 +1326,7 @@ PHP_SUBST(CXX)
+ PHP_SUBST(CXXFLAGS)
+ PHP_SUBST(CXXFLAGS_CLEAN)
+ PHP_SUBST_OLD(DEBUG_CFLAGS)
++PHP_SUBST_OLD(DEBIAN_PHP_API)
+ PHP_SUBST_OLD(EXTENSION_DIR)
+ PHP_SUBST_OLD(EXTRA_LDFLAGS)
+ PHP_SUBST_OLD(EXTRA_LDFLAGS_PROGRAM)
+--- php5.orig/scripts/php-config.in
++++ php5/scripts/php-config.in
+@@ -19,6 +19,7 @@ php_cli_binary=NONE
+ php_cgi_binary=NONE
+ configure_options="@CONFIGURE_OPTIONS@"
+ php_sapis="@PHP_INSTALLED_SAPIS@"
++phpapi="@DEBIAN_PHP_API@"
+ 
+ # Set php_cli_binary and php_cgi_binary if available
+ for sapi in $php_sapis; do
+@@ -57,6 +58,8 @@ case "$1" in
+   echo $include_dir;;
+ --php-binary)
+   echo $php_binary;;
++--phpapi)
++  echo $phpapi;;
+ --php-sapis)
+   echo $php_sapis;;
+ --configure-options)
+@@ -80,6 +83,7 @@ Options:
+   --man-dir           [$man_dir]
+   --php-binary        [$php_binary]
+   --php-sapis         [$php_sapis]
++  --phpapi            [$phpapi]
+   --configure-options [$configure_options]
+   --version           [$version]
+   --vernum            [$vernum]
diff -ruN php-5.5.1.orig/fink/patches/057-no_apache_installed.patch php-5.5.1/fink/patches/057-no_apache_installed.patch
--- php-5.5.1.orig/fink/patches/057-no_apache_installed.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/057-no_apache_installed.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,89 @@
+Description: Disable installed-apache configure check
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/sapi/apache2handler/config.m4
++++ php5/sapi/apache2handler/config.m4
+@@ -58,13 +58,13 @@ if test "$PHP_APXS2" != "no"; then
+ 
+   APACHE_CFLAGS="$APACHE_CPPFLAGS -I$APXS_INCLUDEDIR $APR_CFLAGS $APU_CFLAGS"
+ 
+-  # Test that we're trying to configure with apache 2.x
+-  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
+-  if test "$APACHE_VERSION" -le 2000000; then
+-    AC_MSG_ERROR([You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)])
+-  elif test "$APACHE_VERSION" -lt 2000044; then
+-    AC_MSG_ERROR([Please note that Apache version >= 2.0.44 is required])
+-  fi
++dnl  # Test that we're trying to configure with apache 2.x
++dnl  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
++dnl  if test "$APACHE_VERSION" -le 2000000; then
++dnl    AC_MSG_ERROR([You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)])
++dnl  elif test "$APACHE_VERSION" -lt 2000044; then
++dnl    AC_MSG_ERROR([Please note that Apache version >= 2.0.44 is required])
++dnl  fi
+ 
+   APXS_LIBEXECDIR='$(INSTALL_ROOT)'`$APXS -q LIBEXECDIR`
+   if test -z `$APXS -q SYSCONFDIR`; then
+--- php5.orig/sapi/apache/config.m4
++++ php5/sapi/apache/config.m4
+@@ -56,11 +56,11 @@ if test "$PHP_APXS" != "no"; then
+   APXS_HTTPD=`$APXS -q SBINDIR`/`$APXS -q TARGET`
+   APACHE_INCLUDE=-I$APXS_INCLUDEDIR
+ 
+-  # Test that we're trying to configure with apache 1.x
+-  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
+-  if test "$APACHE_VERSION" -ge 2000000; then
+-    AC_MSG_ERROR([You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2]) 
+-  fi
++dnl  # Test that we're trying to configure with apache 1.x
++dnl  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
++dnl  if test "$APACHE_VERSION" -ge 2000000; then
++dnl    AC_MSG_ERROR([You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2]) 
++dnl  fi
+ 
+   for flag in $APXS_CFLAGS; do
+     case $flag in
+--- php5.orig/sapi/apache2filter/config.m4
++++ php5/sapi/apache2filter/config.m4
+@@ -59,13 +59,13 @@ if test "$PHP_APXS2FILTER" != "no"; then
+ 
+   APACHE_CFLAGS="$APACHE_CPPFLAGS -I$APXS_INCLUDEDIR $APR_CFLAGS $APU_CFLAGS"
+ 
+-  # Test that we're trying to configure with apache 2.x
+-  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
+-  if test "$APACHE_VERSION" -le 2000000; then
+-    AC_MSG_ERROR([You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)])
+-  elif test "$APACHE_VERSION" -lt 2000040; then
+-    AC_MSG_ERROR([Please note that Apache version >= 2.0.40 is required])
+-  fi
++dnl  # Test that we're trying to configure with apache 2.x
++dnl  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
++dnl  if test "$APACHE_VERSION" -le 2000000; then
++dnl    AC_MSG_ERROR([You have enabled Apache 2 support while your server is Apache 1.3.  Please use the appropiate switch --with-apxs (without the 2)])
++dnl  elif test "$APACHE_VERSION" -lt 2000040; then
++dnl    AC_MSG_ERROR([Please note that Apache version >= 2.0.40 is required])
++dnl  fi
+ 
+   APXS_LIBEXECDIR='$(INSTALL_ROOT)'`$APXS -q LIBEXECDIR`
+   if test -z `$APXS -q SYSCONFDIR`; then
+--- php5.orig/sapi/apache_hooks/config.m4
++++ php5/sapi/apache_hooks/config.m4
+@@ -57,11 +57,11 @@ if test "$PHP_APACHE_HOOKS" != "no"; the
+   APXS_HTTPD=`$APXS -q SBINDIR`/`$APXS -q TARGET`
+   APACHE_INCLUDE=-I$APXS_INCLUDEDIR
+ 
+-  # Test that we're trying to configure with apache 1.x
+-  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
+-  if test "$APACHE_VERSION" -ge 2000000; then
+-    AC_MSG_ERROR([You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2]) 
+-  fi
++dnl  # Test that we're trying to configure with apache 1.x
++dnl  PHP_AP_EXTRACT_VERSION($APXS_HTTPD)
++dnl  if test "$APACHE_VERSION" -ge 2000000; then
++dnl    AC_MSG_ERROR([You have enabled Apache 1.3 support while your server is Apache 2.  Please use the appropiate switch --with-apxs2]) 
++dnl  fi
+ 
+   for flag in $APXS_CFLAGS; do
+     case $flag in
diff -ruN php-5.5.1.orig/fink/patches/100-recode_is_shared.patch php-5.5.1/fink/patches/100-recode_is_shared.patch
--- php-5.5.1.orig/fink/patches/100-recode_is_shared.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/100-recode_is_shared.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,16 @@
+Description: Turn recode conflicts error message into a warning. The
+ recode extension is packaged as a shared library in Debian.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/recode/config9.m4
++++ php5/ext/recode/config9.m4
+@@ -13,6 +13,6 @@ if test "$PHP_RECODE" != "no"; then
+   fi
+ 
+   if test -n "$recode_conflict"; then
+-    AC_MSG_ERROR([recode extension can not be configured together with:$recode_conflict])
++    AC_MSG_WARN([recode extension can not be used together with:$recode_conflict])
+   fi
+ fi
diff -ruN php-5.5.1.orig/fink/patches/108-64_bit_datetime.patch php-5.5.1/fink/patches/108-64_bit_datetime.patch
--- php-5.5.1.orig/fink/patches/108-64_bit_datetime.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/108-64_bit_datetime.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,12 @@
+--- php5.orig/ext/standard/datetime.c
++++ php5/ext/standard/datetime.c
+@@ -20,6 +20,9 @@
+ 
+ /* $Id$ */
+ 
++#define _XOPEN_SOURCE	/* needed to get strptime() declared */
++#define _BSD_SOURCE		/* needed to get ulong declared */
++
+ #include "php.h"
+ #include "zend_operators.h"
+ #include "datetime.h"
diff -ruN php-5.5.1.orig/fink/patches/112-proc_open.patch php-5.5.1/fink/patches/112-proc_open.patch
--- php-5.5.1.orig/fink/patches/112-proc_open.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/112-proc_open.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,11 @@
+--- php5.orig/ext/standard/proc_open.c
++++ php5/ext/standard/proc_open.c
+@@ -61,7 +61,7 @@
+  * */
+ #ifdef PHP_CAN_SUPPORT_PROC_OPEN
+ 
+-#if 0 && HAVE_PTSNAME && HAVE_GRANTPT && HAVE_UNLOCKPT && HAVE_SYS_IOCTL_H && HAVE_TERMIOS_H
++#if HAVE_PTSNAME && HAVE_GRANTPT && HAVE_UNLOCKPT && HAVE_SYS_IOCTL_H && HAVE_TERMIOS_H
+ # include <sys/ioctl.h>
+ # include <termios.h>
+ # define PHP_CAN_DO_PTS	1
diff -ruN php-5.5.1.orig/fink/patches/113-php.ini_securitynotes.patch php-5.5.1/fink/patches/113-php.ini_securitynotes.patch
--- php-5.5.1.orig/fink/patches/113-php.ini_securitynotes.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/113-php.ini_securitynotes.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,20 @@
+Description: Adds security notices to php.ini settings
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- php5.orig/php.ini-development
++++ php5/php.ini-development
+@@ -305,6 +305,12 @@ serialize_precision = 17
+ ; or per-virtualhost web server configuration file. This directive is
+ ; *NOT* affected by whether Safe Mode is turned On or Off.
+ ; http://php.net/open-basedir
++ 
++; NOTE: this is considered a "broken" security measure.
++;       Applications relying on this feature will not receive full
++;       support by the security team.  For more information please
++;       see /usr/share/doc/php5-common/README.Debian.security
++;
+ ;open_basedir =
+ 
+ ; This directive allows you to disable certain functions for security reasons.
diff -ruN php-5.5.1.orig/fink/patches/116-posixness_fix.patch php-5.5.1/fink/patches/116-posixness_fix.patch
--- php-5.5.1.orig/fink/patches/116-posixness_fix.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/116-posixness_fix.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,52 @@
+--- php5.orig/TSRM/tsrm_config_common.h
++++ php5/TSRM/tsrm_config_common.h
+@@ -1,6 +1,10 @@
+ #ifndef TSRM_CONFIG_COMMON_H
+ #define TSRM_CONFIG_COMMON_H
+ 
++#ifndef PATH_MAX
++#define PATH_MAX 4096
++#endif
++
+ #ifndef __CYGWIN__
+ # if WINNT|WIN32
+ #  define TSRM_WIN32
+--- php5.orig/ext/date/lib/parse_tz.c
++++ php5/ext/date/lib/parse_tz.c
+@@ -18,6 +18,10 @@
+ 
+ /* $Id$ */
+ 
++#ifndef PATH_MAX
++#define PATH_MAX 4096
++#endif
++
+ #include "timelib.h"
+ 
+ #include <stdio.h>
+--- php5.orig/ext/standard/proc_open.c
++++ php5/ext/standard/proc_open.c
+@@ -24,6 +24,10 @@
+ # define __EXTENSIONS__	1	/* Solaris: uint */
+ #endif
+ 
++#ifndef PATH_MAX
++#define PATH_MAX 4096
++#endif
++
+ #include "php.h"
+ #include <stdio.h>
+ #include <ctype.h>
+--- php5.orig/main/php.h
++++ php5/main/php.h
+@@ -244,6 +244,10 @@ END_EXTERN_C()
+ /* macros */
+ #define STR_PRINT(str)	((str)?(str):"")
+ 
++#ifndef PATH_MAX
++#define PATH_MAX 4096
++#endif
++
+ #ifndef MAXPATHLEN
+ # ifdef PATH_MAX
+ #  define MAXPATHLEN PATH_MAX
diff -ruN php-5.5.1.orig/fink/patches/PEAR-Builder-print-info-about-php5-dev.patch php-5.5.1/fink/patches/PEAR-Builder-print-info-about-php5-dev.patch
--- php-5.5.1.orig/fink/patches/PEAR-Builder-print-info-about-php5-dev.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/PEAR-Builder-print-info-about-php5-dev.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,10 @@
+--- a/PEAR/Builder.php	2011-05-14 20:43:01.000000000 +0000
++++ b/PEAR/Builder.php		2011-05-26 15:56:41.096485701 +0000
+@@ -309,6 +309,8 @@ class PEAR_Builder extends PEAR_Common
+         }
+ 
+         if (!$err) {
++             print "If the command failed with 'phpize: not found' then you need to install php5-dev package";
++             print "You can do it by running 'apt-get install php5-dev' as a root user";
+             return $this->raiseError("`phpize' failed");
+         }
diff -ruN php-5.5.1.orig/fink/patches/Zend_OpCache_GNUHurd_fix.patch php-5.5.1/fink/patches/Zend_OpCache_GNUHurd_fix.patch
--- php-5.5.1.orig/fink/patches/Zend_OpCache_GNUHurd_fix.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/Zend_OpCache_GNUHurd_fix.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,109 @@
+--- php5.orig/ext/opcache/ZendAccelerator.h
++++ php5/ext/opcache/ZendAccelerator.h
+@@ -80,6 +80,9 @@
+ # endif
+ # include <direct.h>
+ #else
++# ifndef MAXPATHLEN
++#  define MAXPATHLEN     4096
++# endif
+ # include <sys/param.h>
+ #endif
+ 
+@@ -100,7 +103,7 @@ extern int lock_file;
+ # elif defined(__svr4__)
+ #  define FLOCK_STRUCTURE(name, type, whence, start, len) \
+ 		struct flock name = {type, whence, start, len}
+-# elif defined(__linux__) || defined(__hpux)
++# elif defined(__linux__) || defined(__hpux) || defined(__GNU__)
+ #  define FLOCK_STRUCTURE(name, type, whence, start, len) \
+ 		struct flock name = {type, whence, start, len, 0}
+ # elif defined(_AIX)
+@@ -111,6 +114,12 @@ extern int lock_file;
+ #   define FLOCK_STRUCTURE(name, type, whence, start, len) \
+ 		struct flock name = {type, whence, start, len}
+ #  endif
++# elif defined(HAVE_FLOCK_BSD)
++#  define FLOCK_STRUCTURE(name, type, whence, start, len) \
++		struct flock name = {start, len, -1, type, whence}
++# elif defined(HAVE_FLOCK_LINUX)
++#  define FLOCK_STRUCTURE(name, type, whence, start, len) \
++		struct flock name = {type, whence, start, len}
+ # else
+ #  error "Don't know how to define struct flock"
+ # endif
+--- php5.orig/ext/opcache/config.m4
++++ php5/ext/opcache/config.m4
+@@ -326,38 +326,42 @@ int main() {
+     msg=yes,msg=no,msg=no)
+   AC_MSG_RESULT([$msg])
+ 
+-  AC_MSG_CHECKING(for known struct flock definition)
+-  dnl Copied from ZendAccelerator.h
+-  AC_TRY_RUN([
+-#include <fcntl.h>
+-#include <stdlib.h>
++flock_type=unknown
++AC_MSG_CHECKING("whether flock struct is linux ordered")
++AC_TRY_RUN([
++  #include <fcntl.h>
++  struct flock lock = { 1, 2, 3, 4, 5 };
++  int main() { 
++    if(lock.l_type == 1 && lock.l_whence == 2 && lock.l_start == 3 && lock.l_len == 4) {
++		return 0;
++    }
++    return 1;
++  } 
++], [
++	flock_type=linux
++    AC_DEFINE([HAVE_FLOCK_LINUX], [], [Struct flock is Linux-type])
++    AC_MSG_RESULT("yes")
++], AC_MSG_RESULT("no") )
+ 
+-#ifndef ZEND_WIN32
+-extern int lock_file;
++AC_MSG_CHECKING("whether flock struct is BSD ordered")
++AC_TRY_RUN([
++  #include <fcntl.h>
++  struct flock lock = { 1, 2, 3, 4, 5 };
++  int main() { 
++    if(lock.l_start == 1 && lock.l_len == 2 && lock.l_type == 4 && lock.l_whence == 5) {
++		return 0;
++    }
++    return 1;
++  } 
++], [
++	flock_type=bsd
++    AC_DEFINE([HAVE_FLOCK_BSD], [], [Struct flock is BSD-type]) 
++    AC_MSG_RESULT("yes")
++], AC_MSG_RESULT("no") )
+ 
+-# if defined(__FreeBSD__) || defined(__FreeBSD_kernel__) || (defined(__APPLE__) && defined(__MACH__)/* Darwin */) || defined(__OpenBSD__) || defined(__NetBSD__)
+-#  define FLOCK_STRUCTURE(name, type, whence, start, len) \
+-                struct flock name = {start, len, -1, type, whence}
+-# elif defined(__svr4__)
+-#  define FLOCK_STRUCTURE(name, type, whence, start, len) \
+-                struct flock name = {type, whence, start, len}
+-# elif defined(__linux__) || defined(__hpux)
+-#  define FLOCK_STRUCTURE(name, type, whence, start, len) \
+-                struct flock name = {type, whence, start, len, 0}
+-# elif defined(_AIX)
+-#  if defined(_LARGE_FILES) || defined(__64BIT__)
+-#   define FLOCK_STRUCTURE(name, type, whence, start, len) \
+-                struct flock name = {type, whence, 0, 0, 0, start, len }
+-#  else
+-#   define FLOCK_STRUCTURE(name, type, whence, start, len) \
+-                struct flock name = {type, whence, start, len}
+-#  endif
+-# else
+-#  error "Don't know how to define struct flock"
+-# endif
+-#endif
+-int main() { return 0; }
+-], [], [AC_MSG_ERROR([Don't know how to define struct flock on this system[,] set --enable-opcache=no])], [])
++if test "$flock_type" == "unknown"; then
++	AC_MSG_ERROR([Don't know how to define struct flock on this system[,] set --enable-opcache=no])
++fi
+   
+   PHP_NEW_EXTENSION(opcache,
+ 	ZendAccelerator.c \
diff -ruN php-5.5.1.orig/fink/patches/backport-upstream-lp592442.patch php-5.5.1/fink/patches/backport-upstream-lp592442.patch
--- php-5.5.1.orig/fink/patches/backport-upstream-lp592442.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/backport-upstream-lp592442.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,21 @@
+--- a/ext/openssl/xp_ssl.c
++++ b/ext/openssl/xp_ssl.c
+@@ -395,6 +395,18 @@ static inline int php_openssl_setup_cryp
+ 	}
+ #endif
+ 
++#if OPENSSL_VERSION_NUMBER >= 0x0090806fL
++	{
++		zval **val;
++
++		if (stream->context && SUCCESS == php_stream_context_get_option(
++								stream->context, "ssl", "no_ticket", &val) &&
++						zval_is_true(*val)) {
++					SSL_CTX_set_options(sslsock->ctx, SSL_OP_NO_TICKET);
++		}
++	}
++#endif
++
+ 	sslsock->ssl_handle = php_SSL_new_from_context(sslsock->ctx, stream TSRMLS_CC);
+ 	if (sslsock->ssl_handle == NULL) {
+ 		php_error_docref(NULL TSRMLS_CC, E_WARNING, "failed to create an SSL handle");
diff -ruN php-5.5.1.orig/fink/patches/broken_5.3_test-posix_uname.patch php-5.5.1/fink/patches/broken_5.3_test-posix_uname.patch
--- php-5.5.1.orig/fink/patches/broken_5.3_test-posix_uname.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/broken_5.3_test-posix_uname.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,53 @@
+Author: Sean Finney <seanius@debian.org>
+Description: Fix two failing tests
+ * ext/posix/tests/posix_uname.phpt: removed
+ * ext/posix/tests/posix_uname_basic.phpt: backported fix from upstream.
+Bug: http://bugs.php.net/bug.php?id=50982
+Bug-Debian: http://bugs.debian.org/570286
+--- a/ext/posix/tests/posix_uname.phpt
++++ /dev/null
+@@ -1,35 +0,0 @@
+---TEST--
+-Test posix_uname()
+---DESCRIPTION--
+-Gets information about the system.
+-Source code: ext/posix/posix.c
+---CREDITS--
+-Falko Menge, mail at falko-menge dot de
+-PHP Testfest Berlin 2009-05-10
+---SKIPIF--
+-<?php 
+-	if (!extension_loaded('posix')) { 
+-        die('SKIP - POSIX extension not available');
+-    }
+-?>
+---FILE--
+-<?php
+-    $uname = posix_uname();
+-    unset($uname['domainname']);
+-    var_dump($uname);
+-?>
+-===DONE===
+---EXPECTF--
+-array(5) {
+-  ["sysname"]=>
+-  string(%d) "%s"
+-  ["nodename"]=>
+-  string(%d) "%s"
+-  ["release"]=>
+-  string(%d) "%s"
+-  ["version"]=>
+-  string(%d) "%s"
+-  ["machine"]=>
+-  string(%d) "%s"
+-}
+-===DONE===
+--- a/ext/posix/tests/posix_uname_basic.phpt
++++ b/ext/posix/tests/posix_uname_basic.phpt
+@@ -25,4 +25,4 @@ Array
+     [machine] => %s
+ )
+ ===DONE====
+-  
+\ No newline at end of file
++  
diff -ruN php-5.5.1.orig/fink/patches/bug53070.patch php-5.5.1/fink/patches/bug53070.patch
--- php-5.5.1.orig/fink/patches/bug53070.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/bug53070.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,20 @@
+--- a/ext/enchant/enchant.c
++++ b/ext/enchant/enchant.c
+@@ -429,6 +429,8 @@ PHP_FUNCTION(enchant_broker_set_dict_pat
+ 	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "rls", &broker, &dict_type, &value, &value_len) == FAILURE) {
+ 		RETURN_FALSE;
+ 	}
++	
++	PHP_ENCHANT_GET_BROKER;
+ 
+ 	if (!value_len) {
+ 		RETURN_FALSE;
+@@ -485,6 +487,8 @@ PHP_FUNCTION(enchant_broker_get_dict_pat
+ 		default:
+ 			RETURN_FALSE;
+ 	}
++	
++	PHP_ENCHANT_GET_BROKER;
+ 
+ 	RETURN_STRING(value, 1);
+ }
diff -ruN php-5.5.1.orig/fink/patches/deprecate_short_open_tag php-5.5.1/fink/patches/deprecate_short_open_tag
--- php-5.5.1.orig/fink/patches/deprecate_short_open_tag	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/deprecate_short_open_tag	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,36 @@
+--- a/Zend/zend_language_scanner.l
++++ b/Zend/zend_language_scanner.l
+@@ -1513,6 +1513,7 @@ NEWLINE ("\r"|"\n"|"\r\n")
+ 
+ <INITIAL>"<?=" {
+ 	if (CG(short_tags)) {
++		zend_error(E_DEPRECATED, "Usage of short open tag <? is not recommended and will be disabled by default in future versions of PHP");
+ 		zendlval->value.str.val = yytext; /* no copying - intentional */
+ 		zendlval->value.str.len = yyleng;
+ 		zendlval->type = IS_STRING;
+@@ -1549,6 +1550,7 @@ NEWLINE ("\r"|"\n"|"\r\n")
+ 
+ <INITIAL>"<?" {
+ 	if (CG(short_tags)) {
++		zend_error(E_DEPRECATED, "Usage of short open tag <? is not recommended and will be disabled by default in future versions of PHP");
+ 		zendlval->value.str.val = yytext; /* no copying - intentional */
+ 		zendlval->value.str.len = yyleng;
+ 		zendlval->type = IS_STRING;
+--- a/Zend/zend_language_scanner.c
++++ b/Zend/zend_language_scanner.c
+@@ -1019,6 +1019,7 @@ yy6:
+ #line 1550 "Zend/zend_language_scanner.l"
+ 		{
+ 	if (CG(short_tags)) {
++		zend_error(E_DEPRECATED, "Usage of short open tag <? is not recommended and will be disabled by default in future versions of PHP");
+ 		zendlval->value.str.val = yytext; /* no copying - intentional */
+ 		zendlval->value.str.len = yyleng;
+ 		zendlval->type = IS_STRING;
+@@ -1298,6 +1299,7 @@ yy45:
+ #line 1514 "Zend/zend_language_scanner.l"
+ 		{
+ 	if (CG(short_tags)) {
++		zend_error(E_DEPRECATED, "Usage of short open tag <? is not recommended and will be disabled by default in future versions of PHP");
+ 		zendlval->value.str.val = yytext; /* no copying - intentional */
+ 		zendlval->value.str.len = yyleng;
+ 		zendlval->type = IS_STRING;
diff -ruN php-5.5.1.orig/fink/patches/dont-gitclean-in-build.patch php-5.5.1/fink/patches/dont-gitclean-in-build.patch
--- php-5.5.1.orig/fink/patches/dont-gitclean-in-build.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/dont-gitclean-in-build.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,18 @@
+Author: Sean Finney <seanius@debian.org>
+Description: Don't run git-clean via buildconf
+ Calling buildconf indirectly invokes vcsclean, which calls the gitclean-work
+ target of build/build.mk, which calls among other things git clean -X -f -d,
+ which in turn nukes the quilt .pc directory making life quite difficult for
+ us.
+ .
+ This patch doesn't need to go upstream, as they likely don't want to support
+ having a patch system on top of their source.
+--- php5.orig/build/build.mk
++++ php5/build/build.mk
+@@ -75,6 +75,5 @@ gitclean-work:
+ 	@if (test ! -f '.git/info/exclude' || grep -s "git-ls-files" .git/info/exclude); then \
+ 		(echo "Rebuild .git/info/exclude" && echo '*.o' > .git/info/exclude && git svn propget svn:ignore | grep -v config.nice >> .git/info/exclude); \
+ 	fi; \
+-	git clean -X -f -d;
+ 
+ .PHONY: $(ALWAYS) snapshot
diff -ruN php-5.5.1.orig/fink/patches/expose_all_built_and_installed_apis.patch php-5.5.1/fink/patches/expose_all_built_and_installed_apis.patch
--- php-5.5.1.orig/fink/patches/expose_all_built_and_installed_apis.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/expose_all_built_and_installed_apis.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,27 @@
+--- php5.orig/scripts/man1/php-config.1.in
++++ php5/scripts/man1/php-config.1.in
+@@ -44,7 +44,7 @@ Full path to php CLI or CGI binary
+ .TP
+ .PD 0
+ .B \-\-php-sapis
+-Show all SAPI modules available
++Show all SAPI modules installed on the Debian system
+ .TP
+ .PD 0
+ .B \-\-configure-options
+--- php5.orig/scripts/php-config.in
++++ php5/scripts/php-config.in
+@@ -18,9 +18,12 @@ exe_extension="@EXEEXT@"
+ php_cli_binary=NONE
+ php_cgi_binary=NONE
+ configure_options="@CONFIGURE_OPTIONS@"
+-php_sapis="@PHP_INSTALLED_SAPIS@"
++#php_sapis="@PHP_INSTALLED_SAPIS@"
+ phpapi="@DEBIAN_PHP_API@"
+ 
++# Query the dpkg database for available PHP5 sapis
++php_sapis=$(dpkg-query -W -f='${binary:Package} ' libapache2-mod-php5 libapache2-mod-php5filter php5-cgi php5-cli php5-fpm libphp5-embed 2>/dev/null | sed -e 's|libapache2-mod-php5|apache2handler|;s|libapache2-mod-php5filter|apache2filter|;s|php5-cgi|cgi|;s|php5-cli|cli|;s|php5-fpm|fpm|;s|libphp5-embed|embed|;')
++
+ # Set php_cli_binary and php_cgi_binary if available
+ for sapi in $php_sapis; do
+   case $sapi in
diff -ruN php-5.5.1.orig/fink/patches/fink_quirks.patch php-5.5.1/fink/patches/fink_quirks.patch
--- php-5.5.1.orig/fink/patches/fink_quirks.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/fink_quirks.patch	2013-08-09 09:15:20.000000000 -0600
@@ -0,0 +1,271 @@
+Description: Changes to make php use versioned paths and other minor
+ cleanup changes.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- a/configure.in
++++ b/configure.in
+@@ -1068,7 +1068,7 @@ if test "$PHP_CLI" = "no"; then
+ fi
+ 
+ PHP_ARG_WITH(pear, [whether to install PEAR],
+-[  --with-pear=DIR         Install PEAR in DIR @<:@PREFIX/lib/php@:>@
++[  --with-pear=DIR         Install PEAR in DIR @<:@PREFIX/lib/php5@:>@
+   --without-pear          Do not install PEAR], DEFAULT, yes)
+ 
+ if test "$PHP_PEAR" != "no"; then
+@@ -1098,7 +1098,7 @@ dnl
+   if test "$PHP_PEAR" = "DEFAULT" || test "$PHP_PEAR" = "yes"; then
+     case $PHP_LAYOUT in
+       GNU) PEAR_INSTALLDIR=$datadir/pear;;
+-      *)   PEAR_INSTALLDIR=$libdir/php;;
++      *)   PEAR_INSTALLDIR=$libdir/php5;;
+     esac
+   fi
+ 
+@@ -1153,12 +1153,12 @@ test "$program_suffix" = "NONE" && progr
+ 
+ case $libdir in
+   '${exec_prefix}/lib')
+-    libdir=$libdir/php
++    libdir=$libdir/php5
+     ;;
+ esac
+ case $datadir in
+   '${prefix}/share')
+-    datadir=$datadir/php
++    datadir=$datadir/php5
+     ;;
+ esac
+ 
+@@ -1225,7 +1225,7 @@ EXPANDED_SYSCONFDIR=`eval echo $sysconfd
+ EXPANDED_DATADIR=$datadir
+ EXPANDED_PHP_CONFIG_FILE_PATH=`eval echo "$PHP_CONFIG_FILE_PATH"`
+ EXPANDED_PHP_CONFIG_FILE_SCAN_DIR=`eval echo "$PHP_CONFIG_FILE_SCAN_DIR"`
+-INCLUDE_PATH=.:$EXPANDED_PEAR_INSTALLDIR
++INCLUDE_PATH=.:$EXPANDED_PEAR_INSTALLDIR:/usr/share/pear
+ 
+ exec_prefix=$old_exec_prefix
+ libdir=$old_libdir
+--- a/ext/ext_skel
++++ b/ext/ext_skel
+@@ -70,7 +70,7 @@ if test -d "$extname" ; then
+ fi
+ 
+ if test -z "$skel_dir"; then
+-  skel_dir="skeleton"
++  skel_dir="@FINKPREFIX@/lib/php5/skeleton"
+ fi
+ 
+ ## convert skel_dir to full path
+--- a/php.ini-development
++++ b/php.ini-development
+@@ -702,7 +702,7 @@ default_mimetype = "text/html"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+ 
+ ; UNIX: "/path1:/path2"
+-;include_path = ".:/php/includes"
++;include_path = ".:@FINKPREFIX@/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include_path = ".;c:\php\includes"
+--- a/php.ini-production
++++ b/php.ini-production
+@@ -702,7 +702,7 @@ default_mimetype = "text/html"
+ ;;;;;;;;;;;;;;;;;;;;;;;;;
+ 
+ ; UNIX: "/path1:/path2"
+-;include_path = ".:/php/includes"
++;include_path = ".:@FINKPREFIX@/share/php"
+ ;
+ ; Windows: "\path1;\path2"
+ ;include_path = ".;c:\php\includes"
+@@ -863,51 +863,6 @@ default_socket_timeout = 60
+ ; If you only provide the name of the extension, PHP will look for it in its
+ ; default extension directory.
+ ;
+-; Windows Extensions
+-; Note that ODBC support is built in, so no dll is needed for it.
+-; Note that many DLL files are located in the extensions/ (PHP 4) ext/ (PHP 5)
+-; extension folders as well as the separate PECL DLL download (PHP 5).
+-; Be sure to appropriately set the extension_dir directive.
+-;
+-;extension=php_bz2.dll
+-;extension=php_curl.dll
+-;extension=php_fileinfo.dll
+-;extension=php_gd2.dll
+-;extension=php_gettext.dll
+-;extension=php_gmp.dll
+-;extension=php_intl.dll
+-;extension=php_imap.dll
+-;extension=php_interbase.dll
+-;extension=php_ldap.dll
+-;extension=php_mbstring.dll
+-;extension=php_exif.dll      ; Must be after mbstring as it depends on it
+-;extension=php_mysql.dll
+-;extension=php_mysqli.dll
+-;extension=php_oci8.dll      ; Use with Oracle 10gR2 Instant Client
+-;extension=php_oci8_11g.dll  ; Use with Oracle 11gR2 Instant Client
+-;extension=php_openssl.dll
+-;extension=php_pdo_firebird.dll
+-;extension=php_pdo_mysql.dll
+-;extension=php_pdo_oci.dll
+-;extension=php_pdo_odbc.dll
+-;extension=php_pdo_pgsql.dll
+-;extension=php_pdo_sqlite.dll
+-;extension=php_pgsql.dll
+-;extension=php_pspell.dll
+-;extension=php_shmop.dll
+-
+-; The MIBS data available in the PHP distribution must be installed. 
+-; See http://www.php.net/manual/en/snmp.installation.php 
+-;extension=php_snmp.dll
+-
+-;extension=php_soap.dll
+-;extension=php_sockets.dll
+-;extension=php_sqlite3.dll
+-;extension=php_sybase_ct.dll
+-;extension=php_tidy.dll
+-;extension=php_xmlrpc.dll
+-;extension=php_xsl.dll
+-;extension=php_zip.dll
+ 
+ ;;;;;;;;;;;;;;;;;;;
+ ; Module Settings ;
+--- a/sapi/caudium/config.m4
++++ b/sapi/caudium/config.m4
+@@ -26,8 +26,8 @@ if test "$PHP_CAUDIUM" != "no"; then
+     AC_MSG_ERROR([Could not find a pike in $PHP_CAUDIUM/bin/])
+   fi
+   if $PIKE -e 'float v; int rel;sscanf(version(), "Pike v%f release %d", v, rel);v += rel/10000.0; if(v < 7.0268) exit(1); exit(0);'; then
+-    PIKE_MODULE_DIR=`$PIKE --show-paths 2>&1| grep '^Module' | sed -e 's/.*: //'`
+-    PIKE_INCLUDE_DIR=`echo $PIKE_MODULE_DIR | sed -e 's,lib/pike/modules,include/pike,' -e 's,lib/modules,include/pike,' `
++    PIKE_MODULE_DIR=`$PIKE --show-paths 2>&1| grep '^Master file' | sed -e 's/.*: //' -e 's/master.pike/modules/'`
++    PIKE_INCLUDE_DIR=`echo $PIKE_MODULE_DIR | sed -e 's,lib/modules,,' -e 's,modules,include,' `
+     if test -z "$PIKE_INCLUDE_DIR" || test -z "$PIKE_MODULE_DIR"; then
+       AC_MSG_ERROR(Failed to figure out Pike module and include directories)
+     fi
+@@ -84,7 +84,9 @@ if test "$PHP_CAUDIUM" != "no"; then
+   PIKE_VERSION=`$PIKE -e 'string v; int rel;sscanf(version(), "Pike v%s release %d", v, rel); write(v+"."+rel);'`   
+   AC_DEFINE(HAVE_CAUDIUM,1,[Whether to compile with Caudium support])
+   PHP_SELECT_SAPI(caudium, shared, caudium.c)
+-  INSTALL_IT="\$(INSTALL) -m 0755 $SAPI_SHARED $PHP_CAUDIUM/lib/$PIKE_VERSION/PHP5.so"
++  dnl FIXME: This is the ugliest hack in the world!
++  dnl INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/ && \$(INSTALL) -m 0755 $SAPI_SHARED \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/php5.so"
++  INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/ && \$(INSTALL) -m 0755 .$SAPI_SHARED \$(INSTALL_ROOT)$PHP_CAUDIUM/lib/$PIKE_VERSION/PHP5.so"
+   RESULT="  *** Pike binary used:         $PIKE
+   *** Pike include dir(s) used: $PIKE_INCLUDE_DIR
+   *** Pike version:             $PIKE_VERSION"
+--- a/sapi/cli/php.1.in
++++ b/sapi/cli/php.1.in
+@@ -374,13 +374,14 @@ Shows configuration for extension
+ Show configuration file names
+ .SH FILES
+ .TP 15
+-.B php\-cli.ini
++.B @FINKPREFIX@/etc/php5/cli/php.ini
+ The configuration file for the CLI version of PHP.
+ .TP
+-.B php.ini
+-The standard configuration file will only be used when 
+-.B php\-cli.ini
+-cannot be found.
++.B @FINKPREFIX@/etc/php5/cgi/php.ini
++The configuration file for the CGI version of PHP.
++.TP
++.B @FINKPREFIX@/etc/php5/apache2/php.ini
++The configuration file for the version of PHP that apache2 uses.
+ .SH EXAMPLES
+ .TP 5
+ \fIphp \-r 'echo "Hello World\\n";'\fP
+--- a/scripts/Makefile.frag
++++ b/scripts/Makefile.frag
+@@ -3,8 +3,8 @@
+ # Build environment install
+ #
+ 
+-phpincludedir = $(includedir)/php
+-phpbuilddir = $(libdir)/build
++phpincludedir = $(includedir)/php5
++phpbuilddir = $(prefix)/lib/php5/build
+ 
+ BUILD_FILES = \
+ 	scripts/phpize.m4 \
+--- a/scripts/php-config.in
++++ b/scripts/php-config.in
+@@ -6,9 +6,9 @@ datarootdir="@datarootdir@"
+ exec_prefix="@exec_prefix@"
+ version="@PHP_VERSION@"
+ vernum="@PHP_VERSION_ID@"
+-include_dir="@includedir@/php"
+-includes="-I$include_dir -I$include_dir/main -I$include_dir/TSRM -I$include_dir/Zend -I$include_dir/ext -I$include_dir/ext/date/lib"
+-ldflags="@PHP_LDFLAGS@"
++include_dir="@includedir@/php5"
++includes="-I$include_dir -I$include_dir/main -I$include_dir/TSRM -I$include_dir/Zend -I$include_dir/ext -I$include_dir/ext/date/lib"
++ldflags="-L$prefix/lib/php5 @PHP_LDFLAGS@"
+ libs="@EXTRA_LIBS@"
+ extension_dir='@EXTENSION_DIR@'
+ man_dir=`eval echo @mandir@`
+--- a/scripts/phpize.in
++++ b/scripts/phpize.in
+@@ -4,8 +4,8 @@
+ prefix='@prefix@'
+ datarootdir='@datarootdir@'
+ exec_prefix="`eval echo @exec_prefix@`"
+-phpdir="`eval echo @libdir@`/build"
+-includedir="`eval echo @includedir@`/php"
++phpdir="$prefix/lib/php5/build"
++includedir="$prefix/include/php5"
+ builddir="`pwd`"
+ SED="@SED@"
+ 
+--- php-5.4.3.orig/ext/pdo/config.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/ext/pdo/config.m4	2012-06-12 15:33:12.000000000 -0600
+@@ -39,7 +39,7 @@
+ 
+   if test "$ext_shared" = "yes" ; then
+     case $host_alias in
+-      *darwin*)
++      *darwin7*)
+           AC_MSG_ERROR([
+ Due to the way that loadable modules work on OSX/Darwin, you need to
+ compile the PDO package statically into the PHP core.
+--- php-5.4.3.orig/ext/gd/config.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/ext/gd/config.m4	2012-06-12 15:46:05.000000000 -0600
+@@ -101,7 +101,7 @@
+ AC_DEFUN([PHP_GD_JPEG],[
+   if test "$PHP_JPEG_DIR" != "no"; then
+ 
+-    for i in $PHP_JPEG_DIR /usr/local /usr; do
++    for i in $PHP_JPEG_DIR @FINKPREFIX@ /usr/local /usr; do
+       test -f $i/include/jpeglib.h && GD_JPEG_DIR=$i && break
+     done
+ 
+@@ -126,7 +126,7 @@
+ AC_DEFUN([PHP_GD_PNG],[
+   if test "$PHP_PNG_DIR" != "no"; then
+ 
+-    for i in $PHP_PNG_DIR /usr/local /usr; do
++    for i in $PHP_PNG_DIR @FINKPREFIX@ /usr/local /usr; do
+       test -f $i/include/png.h && GD_PNG_DIR=$i && break
+     done
+ 
+@@ -159,7 +159,7 @@
+
+     for i in $PHP_XPM_DIR /usr/local /usr/X11R6 /usr; do
+       test -f $i/include/xpm.h && GD_XPM_DIR=$i && GD_XPM_INC=$i && break
+-      test -f $i/include/X11/xpm.h && GD_XPM_DIR=$i && GD_XPM_INC=$i/X11 && break
++      test -f $i/include/X11/xpm.h && GD_XPM_DIR=$i && GD_XPM_INC=$i/include && break
+     done
+
+     if test -z "$GD_XPM_DIR"; then
+@@ -184,7 +184,7 @@
+ AC_DEFUN([PHP_GD_FREETYPE2],[
+   if test "$PHP_FREETYPE_DIR" != "no"; then
+ 
+-    for i in $PHP_FREETYPE_DIR /usr/local /usr; do
++    for i in $PHP_FREETYPE_DIR @FINKPREFIX@ /usr/local /usr; do
+       if test -f "$i/include/freetype2/freetype/freetype.h"; then
+         FREETYPE2_DIR=$i
+         FREETYPE2_INC_DIR=$i/include/freetype2
diff -ruN php-5.5.1.orig/fink/patches/fix_broken_5.3_tests.patch php-5.5.1/fink/patches/fix_broken_5.3_tests.patch
--- php-5.5.1.orig/fink/patches/fix_broken_5.3_tests.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/fix_broken_5.3_tests.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,30 @@
+Author: Sean Finney <seanius@debian.org>
+Description: Fix another small batch of broken test cases
+ * ext/standard/tests/php_ini_loaded_file.phpt: this test only works if
+   you call run-tests directly, but the included Makefile invokes the
+   test in such a way that it fails (it explicitly loads an ini file,
+   and the test assumes that none are loaded).  since it therefore seems
+   like a somewhat useless test it has been removed.
+ * cli/tests/006.phpt: $subject is <required> according to the docs for
+   the two pcre functions that report it as such, so the expected string has
+   been updated to match the output.
+ * php.orig/ext/posix/tests/posix_errno_variation2.phpt: SIGKILL is not
+   a defined constant unless the pcntl extension is loaded.  As was
+   done elsewhere (posix_kill_basic.phpt, which oddly seems to do the
+   same *incredibly sketchy* test that's done here), it's passed as a
+   variable hardcoded to 9 instead.  Did i mention that this test is
+   sketchy?
+Origin: vendor
+--- php5.orig/ext/posix/tests/posix_errno_variation2.phpt
++++ php5/ext/posix/tests/posix_errno_variation2.phpt
+@@ -21,7 +21,9 @@ do {
+   $result = shell_exec("ps -p " . $pid);
+ } while (strstr($pid, $result)); 
+ 
+-posix_kill($pid, SIGKILL);
++/* don't depend on SIGKILL being defined (pcntl might not not be loaded) */
++$SIGKILL = 9;
++posix_kill($pid, $SIGKILL);
+ var_dump(posix_errno());
+ 
+ ?>
diff -ruN php-5.5.1.orig/fink/patches/fix_broken_sha2_test.patch php-5.5.1/fink/patches/fix_broken_sha2_test.patch
--- php-5.5.1.orig/fink/patches/fix_broken_sha2_test.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/fix_broken_sha2_test.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,39 @@
+--- php5.orig/ext/standard/config.m4
++++ php5/ext/standard/config.m4
+@@ -182,12 +182,12 @@ AC_TRY_RUN([
+ 
+ main() {
+ #if HAVE_CRYPT
+-    char salt[30], answer[80];
+-    
+-    salt[0]='$'; salt[1]='6'; salt[2]='$'; salt[3]='$'; salt[4]='b'; salt[5]='a'; salt[6]='r'; salt[7]='\0';
++    char salt[21], answer[21+86];
++
++    strcpy(salt,"\$6\$rasmuslerdorf\$");
+     strcpy(answer, salt);
+-    strcpy(&answer[29],"$6$$QMXjqd7rHQZPQ1yHsXkQqC1FBzDiVfTHXL.LaeDAeVV.IzMaV9VU4MQ8kPuZa2SOP1A0RPm772EaFYjpEJtdu.");
+-    exit (strcmp((char *)crypt("foo",salt),answer));
++    strcat(answer, "EeHCRjm0bljalWuALHSTs1NB9ipEiLEXLhYeXdOpx22gmlmVejnVXFhd84cEKbYxCo.XuUTrW.RLraeEnsvWs/");
++    exit (strcmp((char *)crypt("rasmuslerdorf",salt),answer));
+ #else
+ 	exit(0);
+ #endif
+@@ -211,12 +211,13 @@ AC_TRY_RUN([
+ 
+ main() {
+ #if HAVE_CRYPT
+-    char salt[30], answer[80];
+-    salt[0]='$'; salt[1]='5'; salt[2]='$'; salt[3]='$'; salt[4]='s'; salt[5]='a'; salt[6]='l'; salt[7]='t';  salt[8]='s'; salt[9]='t'; salt[10]='r'; salt[11]='i'; salt[12]='n'; salt[13]='g'; salt[14]='\0';    
+-    strcat(salt,"");
++    char salt[21], answer[21+43];
++
++    strcpy(salt,"\$5\$rasmuslerdorf\$");
+     strcpy(answer, salt);
+-    strcpy(&answer[29], "$5$saltstring$5B8vYYiY.CVt1RlTTf8KbXBH3hsxY/GNooZaBBGWEc5");
+-    exit (strcmp((char *)crypt("foo",salt),answer));
++    strcat(answer, "cFAm2puLCujQ9t.0CxiFIIvFi4JyQx5UncCt/xRIX23");
++    exit (strcmp((char *)crypt("rasmuslerdorf",salt),answer));
++
+ #else
+ 	exit(0);
+ #endif
diff -ruN php-5.5.1.orig/fink/patches/fix_broken_upstream_tests.patch php-5.5.1/fink/patches/fix_broken_upstream_tests.patch
--- php-5.5.1.orig/fink/patches/fix_broken_upstream_tests.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/fix_broken_upstream_tests.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,25 @@
+Description: Add missing settings to fix upstream tests
+Origin: vendor
+Forwarded: http://bugs.php.net/50796
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/soap/tests/server009.phpt
++++ php5/ext/soap/tests/server009.phpt
+@@ -10,6 +10,7 @@ SOAP Server 9: setclass and setpersisten
+ --INI--
+ session.auto_start=1
+ session.save_handler=files
++session.save_path=temp_session_store
+ --FILE--
+ <?php
+ class foo {
+--- php5.orig/ext/standard/tests/general_functions/phpinfo.phpt
++++ php5/ext/standard/tests/general_functions/phpinfo.phpt
+@@ -1,5 +1,7 @@
+ --TEST--
+ phpinfo()
++--SKIPIF--
++<?php die("SKIP phpinfo - test suite's handling of "%s" is incompatible with this test"); ?>
+ --FILE--
+ <?php
+ var_dump(phpinfo());
diff -ruN php-5.5.1.orig/fink/patches/force_libmysqlclient_r.patch php-5.5.1/fink/patches/force_libmysqlclient_r.patch
--- php-5.5.1.orig/fink/patches/force_libmysqlclient_r.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/force_libmysqlclient_r.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,41 @@
+Description: Force linking to mysqlclient_r to avoid symbol conflicts.
+ apr-util's mysql driver is linked against that version of the library
+ but due to missing proper symbols versioning we are forced to link to
+ the re-entrant library too.
+Origin: other, http://bugs.debian.org/469081
+Forwarded: not-needed
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/mysql/config.m4
++++ php5/ext/mysql/config.m4
+@@ -76,7 +76,7 @@ elif test "$PHP_MYSQL" != "no"; then
+ Note that the MySQL client library is not bundled anymore!])
+   fi
+ 
+-  if test "$enable_maintainer_zts" = "yes"; then
++  if true || test "$enable_maintainer_zts" = "yes"; then
+     MYSQL_LIBNAME=mysqlclient_r
+   else
+     MYSQL_LIBNAME=mysqlclient
+--- php5.orig/ext/mysqli/config.m4
++++ php5/ext/mysqli/config.m4
+@@ -25,7 +25,7 @@ elif test "$PHP_MYSQLI" != "no"; then
+     MYSQL_LIB_CFG='--libmysqld-libs'
+     dnl mysqlnd doesn't support embedded, so we have to add some extra stuff
+     mysqli_extra_sources="mysqli_embedded.c"
+-  elif test "$enable_maintainer_zts" = "yes"; then
++  elif true || test "$enable_maintainer_zts" = "yes"; then
+     MYSQL_LIB_CFG='--libs_r'
+     MYSQL_LIB_NAME='mysqlclient_r'
+   else
+--- php5.orig/ext/pdo_mysql/config.m4
++++ php5/ext/pdo_mysql/config.m4
+@@ -55,7 +55,7 @@ if test "$PHP_PDO_MYSQL" != "no"; then
+       if test "x$SED" = "x"; then
+         AC_PATH_PROG(SED, sed)
+       fi
+-      if test "$enable_maintainer_zts" = "yes"; then
++      if true || test "$enable_maintainer_zts" = "yes"; then
+         PDO_MYSQL_LIBNAME=mysqlclient_r
+         PDO_MYSQL_LIBS=`$PDO_MYSQL_CONFIG --libs_r | $SED -e "s/'//g"`
+       else
diff -ruN php-5.5.1.orig/fink/patches/fpm-config.patch php-5.5.1/fink/patches/fpm-config.patch
--- php-5.5.1.orig/fink/patches/fpm-config.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/fpm-config.patch	2013-08-08 10:51:19.000000000 -0600
@@ -0,0 +1,54 @@
+Description: Add major version number to paths and allow process pools
+ to be configured in individual files in @FINKPREFIX@/etc/php5/fpm/pool.d/
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-07-30
+
+--- php5.orig/sapi/fpm/php-fpm.conf.in
++++ php5/sapi/fpm/php-fpm.conf.in
+@@ -12,7 +12,7 @@
+ ; Relative path can also be used. They will be prefixed by:
+ ;  - the global prefix if it's been set (-p argument)
+ ;  - @prefix@ otherwise
+-;include=etc/fpm.d/*.conf
++;include=@EXPANDED_SYSCONFDIR@/php5/fpm/*.conf
+ 
+ ;;;;;;;;;;;;;;;;;;
+ ; Global Options ;
+@@ -22,14 +22,14 @@
+ ; Pid file
+ ; Note: the default prefix is @EXPANDED_LOCALSTATEDIR@
+ ; Default Value: none
+-;pid = run/php-fpm.pid
++pid = @EXPANDED_LOCALSTATEDIR@/run/php5-fpm.pid
+ 
+ ; Error log file
+ ; If it's set to "syslog", log is sent to syslogd instead of being written
+ ; in a local file.
+ ; Note: the default prefix is @EXPANDED_LOCALSTATEDIR@
+ ; Default Value: log/php-fpm.log
+-;error_log = log/php-fpm.log
++error_log = @EXPANDED_LOCALSTATEDIR@/log/php5-fpm.log
+ 
+ ; syslog_facility is used to specify what type of program is logging the
+ ; message. This lets syslogd specify that messages from different facilities
+@@ -124,6 +124,10 @@
+ ; used in logs and stats. There is no limitation on the number of pools which
+ ; FPM can handle. Your system will tell you anyway :)
+ 
++; To configure the pools it is recommended to have one .conf file per
++; pool in the following directory:
++include=@EXPANDED_SYSCONFDIR@/php5/fpm/pool.d/*.conf
++
+ ; Start a new pool named 'www'.
+ ; the variable $pool can we used in any directive and will be replaced by the
+ ; pool name ('www' here)
+@@ -466,7 +470,7 @@ pm.max_spare_servers = 3
+ ; Chdir to this directory at the start.
+ ; Note: relative path can be used.
+ ; Default Value: current directory or / when chroot
+-;chdir = /var/www
++chdir = /
+  
+ ; Redirect worker stdout and stderr into main error log. If not set, stdout and
+ ; stderr will be redirected to /dev/null according to FastCGI specs.
diff -ruN php-5.5.1.orig/fink/patches/gd-libJPEG-Version.patch php-5.5.1/fink/patches/gd-libJPEG-Version.patch
--- php-5.5.1.orig/fink/patches/gd-libJPEG-Version.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/gd-libJPEG-Version.patch	2013-08-08 10:37:38.000000000 -0600
@@ -0,0 +1,13 @@
+diff -ruN php-5.4.3.orig/ext/gd/libgd/gd_compat.c php-5.4.3.patched/ext/gd/libgd/gd_compat.c
+--- php-5.4.3.orig/ext/gd/libgd/gd_compat.c	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.patched/ext/gd/libgd/gd_compat.c	2012-06-07 11:57:03.000000000 -0600
+@@ -20,6 +20,9 @@
+ 		case 62:
+ 			return "6b";
+ 			break;
++		case 80:
++			return "8";
++			break;
+ 		default:
+ 			return "unknown";
+ 	}
diff -ruN php-5.5.1.orig/fink/patches/gdIOCtx.patch php-5.5.1/fink/patches/gdIOCtx.patch
--- php-5.5.1.orig/fink/patches/gdIOCtx.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/gdIOCtx.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,119 @@
+--- php5.orig/ext/gd/gd_ctx.c
++++ php5/ext/gd/gd_ctx.c
+@@ -46,33 +46,6 @@ static void _php_image_output_ctxfree(st
+ 	}
+ }
+ 
+-static void _php_image_stream_putc(struct gdIOCtx *ctx, int c)  {
+-	char ch = (char) c;
+-	php_stream * stream = (php_stream *)ctx->data;
+-	TSRMLS_FETCH();
+-	php_stream_write(stream, &ch, 1);
+-}
+-
+-static int _php_image_stream_putbuf(struct gdIOCtx *ctx, const void* buf, int l)
+-{
+-	php_stream * stream = (php_stream *)ctx->data;
+-	TSRMLS_FETCH();
+-	return php_stream_write(stream, (void *)buf, l);
+-}
+-
+-static void _php_image_stream_ctxfree(struct gdIOCtx *ctx)
+-{
+-	TSRMLS_FETCH();
+-
+-	if(ctx->data) {
+-		php_stream_close((php_stream *) ctx->data);
+-		ctx->data = NULL;
+-	}
+-	if(ctx) {
+-		efree(ctx);
+-	}
+-}
+-
+ /* {{{ _php_image_output_ctx */
+ static void _php_image_output_ctx(INTERNAL_FUNCTION_PARAMETERS, int image_type, char *tn, void (*func_p)())
+ {
+@@ -81,12 +54,11 @@ static void _php_image_output_ctx(INTERN
+ 	int file_len = 0;
+ 	long quality, basefilter;
+ 	gdImagePtr im;
++	FILE *fp = NULL;
+ 	int argc = ZEND_NUM_ARGS();
+ 	int q = -1, i;
+ 	int f = -1;
+ 	gdIOCtx *ctx = NULL;
+-	zval *to_zval = NULL;
+-	php_stream *stream;
+ 
+ 	/* The third (quality) parameter for Wbmp stands for the threshold when called from image2wbmp().
+ 	 * The third (quality) parameter for Wbmp and Xbm stands for the foreground color index when called
+@@ -103,7 +75,7 @@ static void _php_image_output_ctx(INTERN
+ 		 * PHP_GDIMG_TYPE_WBM 
+ 		 * PHP_GDIMG_TYPE_WEBP 
+ 		 * */
+-		if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "r|z/!ll", &imgind, &to_zval, &quality, &basefilter) == FAILURE) {
++		if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "r|p!ll", &imgind, &file, &file_len, &quality, &basefilter) == FAILURE) {
+ 			return;
+ 		}
+ 	}
+@@ -117,21 +89,19 @@ static void _php_image_output_ctx(INTERN
+ 		}
+ 	}
+ 
+-	if (argc > 1 && to_zval != NULL) {
+-		if (Z_TYPE_P(to_zval) == IS_RESOURCE) {
+-			php_stream_from_zval_no_verify(stream, &to_zval);
+-			if (stream == NULL) {
+-				RETURN_FALSE;
+-			}
+-		} else if (Z_TYPE_P(to_zval) == IS_STRING) {
+-			stream = php_stream_open_wrapper(Z_STRVAL_P(to_zval), "wb", REPORT_ERRORS|IGNORE_PATH|IGNORE_URL_WIN, NULL);
+-			if (stream == NULL) {
+-				RETURN_FALSE;
+-			}
+-		} else {
+-			php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid 2nd parameter, it must a filename or a stream");
++	if (argc > 1 && file_len) {
++		if (strlen(file) != file_len) {
++			RETURN_FALSE;
++		}
++		PHP_GD_CHECK_OPEN_BASEDIR(file, "Invalid filename");
++
++		fp = VCWD_FOPEN(file, "wb");
++		if (!fp) {
++			php_error_docref(NULL TSRMLS_CC, E_WARNING, "Unable to open '%s' for writing: %s", file, strerror(errno));
+ 			RETURN_FALSE;
+ 		}
++
++		ctx = gdNewFileCtx(fp);
+ 	} else {
+ 		ctx = emalloc(sizeof(gdIOCtx));
+ 		ctx->putC = _php_image_output_putc;
+@@ -145,14 +115,6 @@ static void _php_image_output_ctx(INTERN
+ #endif
+ 	}
+ 
+-	if (!ctx)	{
+-		ctx = emalloc(sizeof(gdIOCtx));
+-		ctx->putC = _php_image_stream_putc;
+-		ctx->putBuf = _php_image_stream_putbuf;
+-		ctx->gd_free = _php_image_stream_ctxfree;
+-		ctx->data = (void *)stream;
+-	}
+-
+ 	switch(image_type) {
+ 		case PHP_GDIMG_CONVERT_WBM:
+ 			if(q<0||q>255) {
+@@ -191,6 +153,11 @@ static void _php_image_output_ctx(INTERN
+ 
+ 	ctx->gd_free(ctx);
+ 
++	if(fp) {
++		fflush(fp);
++		fclose(fp);
++	}
++
+ 	RETURN_TRUE;
+ }
+ /* }}} */
diff -ruN php-5.5.1.orig/fink/patches/giconv_is_inferior.patch php-5.5.1/fink/patches/giconv_is_inferior.patch
--- php-5.5.1.orig/fink/patches/giconv_is_inferior.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/giconv_is_inferior.patch	2013-08-08 17:36:32.000000000 -0600
@@ -0,0 +1,60 @@
+--- php-5.4.3.orig/acinclude.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/acinclude.m4	2012-06-12 15:48:09.000000000 -0600
+@@ -2475,14 +2475,14 @@
+   if test "$found_iconv" = "no"; then
+ 
+     for i in $PHP_ICONV /usr/local /usr; do
+-      if test -r $i/include/giconv.h; then
+-        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
++      if test -r $i/include/iconv.h; then
+         ICONV_DIR=$i
+-        iconv_lib_name=giconv
++        iconv_lib_name=iconv
+         break
+-      elif test -r $i/include/iconv.h; then
++      elif test -r $i/include/giconv.h; then
++        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
+         ICONV_DIR=$i
+-        iconv_lib_name=iconv
++        iconv_lib_name=giconv
+         break
+       fi
+     done
+--- php-5.4.3.orig/aclocal.m4	2012-05-08 00:19:30.000000000 -0600
++++ php-5.4.3.old/aclocal.m4	2012-06-12 15:49:10.000000000 -0600
+@@ -2475,14 +2475,14 @@
+   if test "$found_iconv" = "no"; then
+ 
+     for i in $PHP_ICONV /usr/local /usr; do
+-      if test -r $i/include/giconv.h; then
+-        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
++      if test -r $i/include/iconv.h; then
+         ICONV_DIR=$i
+-        iconv_lib_name=giconv
++        iconv_lib_name=iconv
+         break
+-      elif test -r $i/include/iconv.h; then
++      elif test -r $i/include/giconv.h; then
++        AC_DEFINE(HAVE_GICONV_H, 1, [ ])
+         ICONV_DIR=$i
+-        iconv_lib_name=iconv
++        iconv_lib_name=giconv
+         break
+       fi
+     done
+--- php-5.4.3.orig/ext/iconv/config.m4	2012-05-07 23:22:56.000000000 -0600
++++ php-5.4.3.old/ext/iconv/config.m4	2012-06-12 15:50:36.000000000 -0600
+@@ -31,10 +31,10 @@
+     CFLAGS="-I$PHP_ICONV_PREFIX/include $CFLAGS"
+     LDFLAGS="-L$PHP_ICONV_PREFIX/$PHP_LIBDIR $LDFLAGS"
+ 
+-    if test -r "$PHP_ICONV_PREFIX/include/giconv.h"; then
+-      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/giconv.h"
+-    else
++    if test -r "$PHP_ICONV_PREFIX/include/iconv.h"; then
+       PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/iconv.h"
++    else
++      PHP_ICONV_H_PATH="$PHP_ICONV_PREFIX/include/giconv.h"
+     fi 
+ 
+     AC_MSG_CHECKING([if iconv is glibc's])
diff -ruN php-5.5.1.orig/fink/patches/hurd-noptrace.diff php-5.5.1/fink/patches/hurd-noptrace.diff
--- php-5.5.1.orig/fink/patches/hurd-noptrace.diff	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/hurd-noptrace.diff	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,14 @@
+--- php5.orig/sapi/fpm/config.m4
++++ php5/sapi/fpm/config.m4
+@@ -147,6 +147,11 @@ AC_DEFUN([AC_FPM_TRACE],
+         pid_t child;
+         int status;
+ 
++        /* broken ptrace on Hurd, avoid hanging */
++        #ifdef __GNU__
++        return 10;
++        #endif
++
+         if ( (child = fork()) ) { /* parent */
+           int ret = 0;
+ 
diff -ruN php-5.5.1.orig/fink/patches/libdb_is_-ldb php-5.5.1/fink/patches/libdb_is_-ldb
--- php-5.5.1.orig/fink/patches/libdb_is_-ldb	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/libdb_is_-ldb	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,17 @@
+Description: Let configure check detect version-less libdbs to support
+ newer versions without patching the configure code.
+Origin: vendor
+Forwarded: no
+Last-Update: 2010-01-18
+
+--- php5.orig/ext/dba/config.m4
++++ php5/ext/dba/config.m4
+@@ -362,7 +362,7 @@ if test "$PHP_DB4" != "no"; then
+       break
+     fi
+   done
+-  PHP_DBA_DB_CHECK(4, db-5.1 db-5.0 db-4.8 db-4.7 db-4.6 db-4.5 db-4.4 db-4.3 db-4.2 db-4.1 db-4.0 db-4 db4 db, [(void)db_create((DB**)0, (DB_ENV*)0, 0)])
++  PHP_DBA_DB_CHECK(4, db, [(void)db_create((DB**)0, (DB_ENV*)0, 0)])
+ fi
+ PHP_DBA_STD_RESULT(db4,Berkeley DB4)
+ 
diff -ruN php-5.5.1.orig/fink/patches/libtool2.2.patch php-5.5.1/fink/patches/libtool2.2.patch
--- php-5.5.1.orig/fink/patches/libtool2.2.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/libtool2.2.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,31 @@
+--- php5.orig/scripts/phpize.in
++++ php5/scripts/phpize.in
+@@ -6,10 +6,16 @@ datarootdir='@datarootdir@'
+ exec_prefix="`eval echo @exec_prefix@`"
+ phpdir="$prefix/lib/php5/build"
+ includedir="$prefix/include/php5"
++aclocaldir="$prefix/share/aclocal"
+ builddir="`pwd`"
+ SED="@SED@"
+ 
+-FILES_BUILD="mkdep.awk scan_makefile_in.awk shtool libtool.m4"
++FILES_BUILD="mkdep.awk scan_makefile_in.awk shtool"
++if [ -f "$aclocaldir/ltsugar.m4" ]; then
++    LIBTOOL_FILES="libtool.m4 ltoptions.m4 ltsugar.m4 ltversion.m4 lt~obsolete.m4"
++else
++    LIBTOOL_FILES="libtool.m4"
++fi
+ FILES="acinclude.m4 Makefile.global config.sub config.guess ltmain.sh run-tests*.php"
+ CLEAN_FILES="$FILES *.o *.lo *.la .deps .libs/ build/ include/ modules/ install-sh \
+ 	mkinstalldirs missing config.nice config.sub config.guess configure configure.in \
+@@ -145,8 +151,9 @@ phpize_copy_files()
+   test -d build || mkdir build
+  
+   (cd "$phpdir" && cp $FILES_BUILD "$builddir"/build)
++  (cd "$aclocaldir" && cp $LIBTOOL_FILES "$builddir"/build)
+   (cd "$phpdir" && cp $FILES "$builddir")
+-  (cd "$builddir" && cat acinclude.m4 ./build/libtool.m4 > aclocal.m4)
++  (cd "$builddir/build" && cat ../acinclude.m4 $LIBTOOL_FILES > ../aclocal.m4)
+ }
+ 
+ phpize_replace_prefix()
diff -ruN php-5.5.1.orig/fink/patches/libxml2_ABIfix.patch php-5.5.1/fink/patches/libxml2_ABIfix.patch
--- php-5.5.1.orig/fink/patches/libxml2_ABIfix.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/libxml2_ABIfix.patch	2013-08-08 10:38:02.000000000 -0600
@@ -0,0 +1,51 @@
+diff -ruN php-5.4.4.orig/ext/dom/documenttype.c php-5.4.4.fixed/ext/dom/documenttype.c
+--- php-5.4.4.orig/ext/dom/documenttype.c	2012-06-12 22:54:23.000000000 -0600
++++ php-5.4.4.fixed/ext/dom/documenttype.c	2013-08-07 15:50:52.000000000 -0600
+@@ -205,7 +205,7 @@
+ 		if (buff != NULL) {
+ 			xmlNodeDumpOutput (buff, NULL, (xmlNodePtr) intsubset, 0, 0, NULL);
+ 			xmlOutputBufferFlush(buff);
+-			ZVAL_STRINGL(*retval, buff->buffer->content, buff->buffer->use, 1);
++			ZVAL_STRINGL(*retval, xmlBufContent(buff->buffer), xmlBufUse(buff->buffer), 1);
+ 			(void)xmlOutputBufferClose(buff);
+ 			return SUCCESS;
+ 		}
+diff -ruN php-5.4.4.orig/ext/dom/node.c php-5.4.4.fixed/ext/dom/node.c
+--- php-5.4.4.orig/ext/dom/node.c	2012-06-12 22:54:23.000000000 -0600
++++ php-5.4.4.fixed/ext/dom/node.c	2013-08-07 15:42:42.000000000 -0600
+@@ -1895,9 +1895,9 @@
+         RETVAL_FALSE;
+     } else {
+ 		if (mode == 0) {
+-			ret = buf->buffer->use;
++			ret = xmlBufUse(buf->buffer);
+ 			if (ret > 0) {
+-				RETVAL_STRINGL((char *) buf->buffer->content, ret, 1);
++				RETVAL_STRINGL((char *) xmlBufContent(buf->buffer), ret, 1);
+ 			} else {
+ 				RETVAL_EMPTY_STRING();
+ 			}
+diff -ruN php-5.4.4.orig/ext/simplexml/simplexml.c php-5.4.4.fixed/ext/simplexml/simplexml.c
+--- php-5.4.4.orig/ext/simplexml/simplexml.c	2012-06-12 22:54:23.000000000 -0600
++++ php-5.4.4.fixed/ext/simplexml/simplexml.c	2013-08-07 15:58:50.000000000 -0600
+@@ -1417,7 +1417,7 @@
+ 
+ 			xmlNodeDumpOutput(outbuf, (xmlDocPtr) sxe->document->ptr, node, 0, 0, ((xmlDocPtr) sxe->document->ptr)->encoding);
+ 			xmlOutputBufferFlush(outbuf);
+-			RETVAL_STRINGL((char *)outbuf->buffer->content, outbuf->buffer->use, 1);
++			RETVAL_STRINGL((char *)xmlBufContent(outbuf->buffer), xmlBufUse(outbuf->buffer), 1);
+ 			xmlOutputBufferClose(outbuf);
+ 		}
+ 	} else {
+diff -ruN php-5.4.4.orig/ext/xmlwriter/php_xmlwriter.c php-5.4.4.fixed/ext/xmlwriter/php_xmlwriter.c
+--- php-5.4.4.orig/ext/xmlwriter/php_xmlwriter.c	2012-06-12 22:54:23.000000000 -0600
++++ php-5.4.4.fixed/ext/xmlwriter/php_xmlwriter.c	2013-08-07 16:01:14.000000000 -0600
+@@ -1914,7 +1914,7 @@
+ 		}
+ 		output_bytes = xmlTextWriterFlush(ptr);
+ 		if (buffer) {
+-			RETVAL_STRING((char *) buffer->content, 1);
++			RETVAL_STRING((char *) xmlBufContent(buffer), 1);
+ 			if (empty) {
+ 				xmlBufferEmpty(buffer);
+ 			}
diff -ruN php-5.5.1.orig/fink/patches/lp564920-fix-big-files.patch php-5.5.1/fink/patches/lp564920-fix-big-files.patch
--- php-5.5.1.orig/fink/patches/lp564920-fix-big-files.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/lp564920-fix-big-files.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,22 @@
+Description: don't mmap large files
+Author: Marc Deslauriers <marc.deslauriers@ubuntu.com>
+Bug: http://bugs.php.net/bug.php?id=52102
+Ubuntu-Bug: https://bugs.edge.launchpad.net/ubuntu/+source/php5/+bug/564920
+
+--- php5.orig/main/streams/plain_wrapper.c
++++ php5/main/streams/plain_wrapper.c
+@@ -631,7 +631,13 @@ static int php_stdiop_set_option(php_str
+ 				
+ 				switch (value) {
+ 					case PHP_STREAM_MMAP_SUPPORTED:
+-						return fd == -1 ? PHP_STREAM_OPTION_RETURN_ERR : PHP_STREAM_OPTION_RETURN_OK;
++						if (fd == -1)
++							return PHP_STREAM_OPTION_RETURN_ERR;
++						/* Don't mmap large files */
++						do_fstat(data, 1);
++						if (data->sb.st_size > 4 * 1024 * 1024)
++							return PHP_STREAM_OPTION_RETURN_ERR;
++						return PHP_STREAM_OPTION_RETURN_OK;
+ 
+ 					case PHP_STREAM_MMAP_MAP_RANGE:
+ 						do_fstat(data, 1);
diff -ruN php-5.5.1.orig/fink/patches/move_gdImagePaletteToTrueColor_to_gd_color.patch php-5.5.1/fink/patches/move_gdImagePaletteToTrueColor_to_gd_color.patch
--- php-5.5.1.orig/fink/patches/move_gdImagePaletteToTrueColor_to_gd_color.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/move_gdImagePaletteToTrueColor_to_gd_color.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,156 @@
+--- a/ext/gd/libgd/gd.c
++++ b/ext/gd/libgd/gd.c
+@@ -3013,70 +3013,3 @@ void gdImageGetClip (gdImagePtr im, int
+ 	*y2P = im->cy2;
+ }
+ 
+-/* convert a palette image to true color */
+-int gdImagePaletteToTrueColor(gdImagePtr src)
+-{
+-	unsigned int y;
+-	unsigned char alloc_y = 0, alloc_aa = 0;
+-	unsigned int yy;
+-
+-	if (src == NULL) {
+-		return 0;
+-	}
+-
+-	if (src->trueColor == 1) {
+-		return 1;
+-	} else {
+-		unsigned int x;
+-		const unsigned int sy = gdImageSY(src);
+-		const unsigned int sx = gdImageSX(src);
+-
+-		src->tpixels = (int **) gdMalloc(sizeof(int *) * sy);
+-		if (src->tpixels == NULL) {
+-			return 0;
+-		}
+-
+-		for (y = 0; y < sy; y++) {
+-			const unsigned char *src_row = src->pixels[y];
+-			int * dst_row;
+-
+-			/* no need to calloc it, we overwrite all pxl anyway */
+-			src->tpixels[y] = (int *) gdMalloc(sx * sizeof(int));
+-			if (src->tpixels[y] == NULL) {
+-				goto clean_on_error;
+-			}
+-
+-			dst_row = src->tpixels[y];
+-			for (x = 0; x < sx; x++) {
+-				const unsigned char c = *(src_row + x);
+-				if (c == src->transparent) {
+-					*(dst_row + x) = gdTrueColorAlpha(0, 0, 0, 127);;
+-				} else {
+-					*(dst_row + x) = gdTrueColorAlpha(src->red[c], src->green[c], src->blue[c], src->alpha[c]);
+-				}
+-			}
+-		}
+-	}
+-
+-	/* free old palette buffer */
+-	for (yy = y - 1; yy >= yy - 1; yy--) {
+-		gdFree(src->pixels[yy]);
+-	}
+-	gdFree(src->pixels);
+-	src->trueColor = 1;
+-	src->pixels = NULL;
+-	src->alphaBlendingFlag = 0;
+-	src->saveAlphaFlag = 1;
+-	return 1;
+-
+-clean_on_error:
+-	if (y > 0) {
+-
+-		for (yy = y; yy >= yy - 1; y--) {
+-			gdFree(src->tpixels[y]);
+-		}
+-		gdFree(src->tpixels);
+-	}
+-	return 0;
+-}
+-
+--- a/ext/gd/libgd/gd_color.c
++++ b/ext/gd/libgd/gd_color.c
+@@ -65,3 +65,70 @@ int gdImageColorMatch (gdImagePtr im1, g
+ }
+ 
+ 
++/* convert a palette image to true color */
++int gdImagePaletteToTrueColor(gdImagePtr src)
++{
++	unsigned int y;
++	unsigned char alloc_y = 0, alloc_aa = 0;
++	unsigned int yy;
++
++	if (src == NULL) {
++		return 0;
++	}
++
++	if (src->trueColor == 1) {
++		return 1;
++	} else {
++		unsigned int x;
++		const unsigned int sy = gdImageSY(src);
++		const unsigned int sx = gdImageSX(src);
++
++		src->tpixels = (int **) gdMalloc(sizeof(int *) * sy);
++		if (src->tpixels == NULL) {
++			return 0;
++		}
++
++		for (y = 0; y < sy; y++) {
++			const unsigned char *src_row = src->pixels[y];
++			int * dst_row;
++
++			/* no need to calloc it, we overwrite all pxl anyway */
++			src->tpixels[y] = (int *) gdMalloc(sx * sizeof(int));
++			if (src->tpixels[y] == NULL) {
++				goto clean_on_error;
++			}
++
++			dst_row = src->tpixels[y];
++			for (x = 0; x < sx; x++) {
++				const unsigned char c = *(src_row + x);
++				if (c == src->transparent) {
++					*(dst_row + x) = gdTrueColorAlpha(0, 0, 0, 127);;
++				} else {
++					*(dst_row + x) = gdTrueColorAlpha(src->red[c], src->green[c], src->blue[c], src->alpha[c]);
++				}
++			}
++		}
++	}
++
++	/* free old palette buffer */
++	for (yy = y - 1; yy >= yy - 1; yy--) {
++		gdFree(src->pixels[yy]);
++	}
++	gdFree(src->pixels);
++	src->trueColor = 1;
++	src->pixels = NULL;
++	src->alphaBlendingFlag = 0;
++	src->saveAlphaFlag = 1;
++	return 1;
++
++clean_on_error:
++	if (y > 0) {
++
++		for (yy = y; yy >= yy - 1; y--) {
++			gdFree(src->tpixels[y]);
++		}
++		gdFree(src->tpixels);
++	}
++	return 0;
++}
++
+--- a/ext/gd/libgd/gd_compat.h
++++ b/ext/gd/libgd/gd_compat.h
+@@ -55,5 +55,7 @@ gdImagePtr gdImageRotate (gdImagePtr src
+ 
+ int gdImageColorMatch (gdImagePtr im1, gdImagePtr im2);
+ 
++int gdImagePaletteToTrueColor(gdImagePtr src);
++
+ #endif
+ 
diff -ruN php-5.5.1.orig/fink/patches/mssql-null-exception.patch php-5.5.1/fink/patches/mssql-null-exception.patch
--- php-5.5.1.orig/fink/patches/mssql-null-exception.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/mssql-null-exception.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,13 @@
+--- php5.orig/ext/pdo_dblib/dblib_driver.c
++++ php5/ext/pdo_dblib/dblib_driver.c
+@@ -362,8 +362,10 @@ static int pdo_dblib_handle_factory(pdo_
+ 		goto cleanup;
+ 	}
+ 
++#if PHP_DBLIB_IS_MSSQL
+ 	/* dblib do not return more than this length from text/image */
+ 	DBSETOPT(H->link, DBTEXTLIMIT, "2147483647");
++#endif
+ 
+ 	/* limit text/image from network */
+ 	DBSETOPT(H->link, DBTEXTSIZE, "2147483647");
diff -ruN php-5.5.1.orig/fink/patches/php-5.2.4-embed-darwin.patch php-5.5.1/fink/patches/php-5.2.4-embed-darwin.patch
--- php-5.5.1.orig/fink/patches/php-5.2.4-embed-darwin.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-5.2.4-embed-darwin.patch	2013-08-08 10:37:50.000000000 -0600
@@ -0,0 +1,33 @@
+--- a/sapi/embed/config.m4
++++ b/sapi/embed/config.m4
+@@ -12,7 +12,8 @@ if test "$PHP_EMBED" != "no"; then
+   case "$PHP_EMBED" in
+     yes|shared)
+       PHP_EMBED_TYPE=shared
+-      INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)\$(prefix)/lib; \$(INSTALL) -m 0755 $SAPI_SHARED \$(INSTALL_ROOT)\$(prefix)/lib"
++      EXTRA_LDFLAGS_DARWIN="-dynamiclib -version-info \$(PHP_MAJOR_VERSION):\$(PHP_MINOR_VERSION):\$(PHP_RELEASE_VERSION) -L@FINKPREFIX@/lib"
++      INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)\$(libdir); \$(LIBTOOL) --mode=install \$(INSTALL) -m 0755 \$(OVERALL_TARGET) \$(INSTALL_ROOT)\$(libdir)"
+       ;;
+     static)
+       PHP_EMBED_TYPE=static
+--- a/Makefile.global	2012-06-12 22:54:23.000000000 -0600
++++ b/Makefile.global	2012-06-15 20:16:37.000000000 -0600
+@@ -16,7 +16,7 @@
+ build-binaries: $(PHP_BINARIES)
+ 
+ libphp$(PHP_MAJOR_VERSION).la: $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS)
+-	$(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(EXTRA_CFLAGS) -rpath $(phptempdir) $(EXTRA_LDFLAGS) $(LDFLAGS) $(PHP_RPATHS) $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS) $(EXTRA_LIBS) $(ZEND_EXTRA_LIBS) -o $@
++	$(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(EXTRA_CFLAGS) -rpath $(libdir) $(EXTRA_LDFLAGS_DARWIN) $(LDFLAGS) $(PHP_RPATHS) $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS) $(EXTRA_LIBS) $(ZEND_EXTRA_LIBS) -o $@
+ 	-@$(LIBTOOL) --silent --mode=install cp $@ $(phptempdir)/$@ >/dev/null 2>&1
+ 
+ libs/libphp$(PHP_MAJOR_VERSION).bundle: $(PHP_GLOBAL_OBJS) $(PHP_SAPI_OBJS)
+--- a/configure.in	2012-06-12 22:54:23.000000000 -0600
++++ b/configure.in	2012-06-16 11:05:07.000000000 -0600
+@@ -1323,6 +1323,7 @@
+ PHP_SUBST_OLD(DEBUG_CFLAGS)
+ PHP_SUBST_OLD(EXTENSION_DIR)
+ PHP_SUBST_OLD(EXTRA_LDFLAGS)
++PHP_SUBST_OLD(EXTRA_LDFLAGS_DARWIN)
+ PHP_SUBST_OLD(EXTRA_LDFLAGS_PROGRAM)
+ PHP_SUBST_OLD(EXTRA_LIBS)
+ PHP_SUBST_OLD(ZEND_EXTRA_LIBS)
diff -ruN php-5.5.1.orig/fink/patches/php-5.2.4-embed.patch php-5.5.1/fink/patches/php-5.2.4-embed.patch
--- php-5.5.1.orig/fink/patches/php-5.2.4-embed.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-5.2.4-embed.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,11 @@
+--- php5.orig/sapi/embed/config.m4
++++ php5/sapi/embed/config.m4
+@@ -12,7 +12,7 @@ if test "$PHP_EMBED" != "no"; then
+   case "$PHP_EMBED" in
+     yes|shared)
+       PHP_EMBED_TYPE=shared
+-      INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)\$(prefix)/lib; \$(INSTALL) -m 0755 $SAPI_SHARED \$(INSTALL_ROOT)\$(prefix)/lib"
++      INSTALL_IT="\$(mkinstalldirs) \$(INSTALL_ROOT)\$(libdir); \$(LIBTOOL) --mode=install \$(INSTALL) -m 0755 \$(OVERALL_TARGET) \$(INSTALL_ROOT)\$(libdir)"
+       ;;
+     static)
+       PHP_EMBED_TYPE=static
diff -ruN php-5.5.1.orig/fink/patches/php-5.2.4-norpath.patch php-5.5.1/fink/patches/php-5.2.4-norpath.patch
--- php-5.5.1.orig/fink/patches/php-5.2.4-norpath.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-5.2.4-norpath.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,18 @@
+--- php5.orig/acinclude.m4
++++ php5/acinclude.m4
+@@ -432,6 +432,7 @@ AC_DEFUN([PHP_EVAL_INCLINE],[
+ dnl internal, don't use
+ AC_DEFUN([_PHP_ADD_LIBPATH_GLOBAL],[
+   PHP_RUN_ONCE(LIBPATH, $1, [
++    test "x$PHP_RPATH" != "xno" &&
+     test -n "$ld_runpath_switch" && LDFLAGS="$LDFLAGS $ld_runpath_switch$1"
+     LDFLAGS="$LDFLAGS -L$1"
+     PHP_RPATHS="$PHP_RPATHS $1"
+@@ -451,6 +452,7 @@ AC_DEFUN([PHP_ADD_LIBPATH],[
+     ],[
+       if test "$ext_shared" = "yes"; then
+         $2="-L$ai_p [$]$2"
++        test "x$PHP_RPATH" != "xno" && \
+         test -n "$ld_runpath_switch" && $2="$ld_runpath_switch$ai_p [$]$2"
+       else
+         _PHP_ADD_LIBPATH_GLOBAL([$ai_p])
diff -ruN php-5.5.1.orig/fink/patches/php-5.3.3-macropen.patch php-5.5.1/fink/patches/php-5.3.3-macropen.patch
--- php-5.5.1.orig/fink/patches/php-5.3.3-macropen.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-5.3.3-macropen.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,36 @@
+--- php5.orig/ext/dba/dba.c
++++ php5/ext/dba/dba.c
+@@ -906,7 +906,7 @@ static void php_dba_open(INTERNAL_FUNCTI
+ 		}
+ 	}
+ 
+-	if (error || hptr->open(info, &error TSRMLS_CC) != SUCCESS) {
++	if (error || (hptr->open)(info, &error TSRMLS_CC) != SUCCESS) {
+ 		dba_close(info TSRMLS_CC);
+ 		php_error_docref2(NULL TSRMLS_CC, Z_STRVAL_PP(args[0]), Z_STRVAL_PP(args[1]), E_WARNING, "Driver initialization failed for handler: %s%s%s", hptr->name, error?": ":"", error?error:"");
+ 		FREENOW;
+--- php5.orig/ext/dba/dba_db3.c
++++ php5/ext/dba/dba_db3.c
+@@ -91,7 +91,7 @@ DBA_OPEN_FUNC(db3)
+ 
+ 	if ((err=db_create(&dbp, NULL, 0)) == 0) {
+ 	    dbp->set_errcall(dbp, php_dba_db3_errcall_fcn);
+-	    if ((err=dbp->open(dbp, info->path, NULL, type, gmode, filemode)) == 0) {
++	    if ((err=(dbp->open)(dbp, info->path, NULL, type, gmode, filemode)) == 0) {
+ 			dba_db3_data *data;
+ 
+ 			data = pemalloc(sizeof(*data), info->flags&DBA_PERSISTENT);
+--- php5.orig/ext/dba/dba_db4.c
++++ php5/ext/dba/dba_db4.c
+@@ -126,9 +126,9 @@ DBA_OPEN_FUNC(db4)
+ 	    dbp->set_errcall(dbp, php_dba_db4_errcall_fcn);
+ 	    if (
+ #if (DB_VERSION_MAJOR > 4 || (DB_VERSION_MAJOR == 4 && DB_VERSION_MINOR >= 1))
+-			(err=dbp->open(dbp, 0, info->path, NULL, type, gmode, filemode)) == 0) {
++			(err=(dbp->open)(dbp, 0, info->path, NULL, type, gmode, filemode)) == 0) {
+ #else
+-			(err=dbp->open(dbp, info->path, NULL, type, gmode, filemode)) == 0) {
++			(err=(dbp->open)(dbp, info->path, NULL, type, gmode, filemode)) == 0) {
+ #endif
+ 			dba_db4_data *data;
+ 
diff -ruN php-5.5.1.orig/fink/patches/php-5.3.9-gnusrc.patch php-5.5.1/fink/patches/php-5.3.9-gnusrc.patch
--- php-5.5.1.orig/fink/patches/php-5.3.9-gnusrc.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-5.3.9-gnusrc.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,105 @@
+--- php5.orig/configure.in
++++ php5/configure.in
+@@ -136,6 +136,8 @@ AC_DEFUN([PHP_EXT_DIR],[ext/$1])dnl
+ AC_DEFUN([PHP_EXT_SRCDIR],[$abs_srcdir/ext/$1])dnl
+ AC_DEFUN([PHP_ALWAYS_SHARED],[])dnl
+ 
++AC_DEFINE([_GNU_SOURCE], 1, [Define to enable GNU C Library extensions])
++
+ dnl Setting up the PHP version based on the information above.
+ dnl -------------------------------------------------------------------------
+ 
+--- php5.orig/ext/interbase/interbase.c
++++ php5/ext/interbase/interbase.c
+@@ -24,7 +24,6 @@
+ #include "config.h"
+ #endif
+ 
+-#define _GNU_SOURCE
+ 
+ #include "php.h"
+ 
+--- php5.orig/ext/pdo_firebird/firebird_driver.c
++++ php5/ext/pdo_firebird/firebird_driver.c
+@@ -22,7 +22,6 @@
+ #include "config.h"
+ #endif
+ 
+-#define _GNU_SOURCE
+ 
+ #include "php.h"
+ #ifdef ZEND_ENGINE_2
+--- php5.orig/ext/standard/file.c
++++ php5/ext/standard/file.c
+@@ -112,9 +112,6 @@ php_file_globals file_globals;
+ #endif
+ 
+ #if defined(HAVE_FNMATCH) && !defined(PHP_WIN32)
+-# ifndef _GNU_SOURCE
+-#  define _GNU_SOURCE
+-# endif
+ # include <fnmatch.h>
+ #endif
+ 
+--- php5.orig/ext/zlib/zlib_fopen_wrapper.c
++++ php5/ext/zlib/zlib_fopen_wrapper.c
+@@ -19,8 +19,6 @@
+ 
+ /* $Id$ */
+ 
+-#define _GNU_SOURCE
+-
+ #include "php.h"
+ #include "php_zlib.h"
+ #include "fopen_wrappers.h"
+--- php5.orig/main/php.h
++++ php5/main/php.h
+@@ -30,6 +30,7 @@
+ #define PHP_HAVE_STREAMS
+ #define YYDEBUG 0
+ 
++#include "php_config.h"
+ #include "php_version.h"
+ #include "zend.h"
+ #include "zend_qsort.h"
+--- php5.orig/main/streams/cast.c
++++ php5/main/streams/cast.c
+@@ -18,7 +18,6 @@
+ 
+ /* $Id$ */
+ 
+-#define _GNU_SOURCE
+ #include "php.h"
+ #include "php_globals.h"
+ #include "php_network.h"
+--- php5.orig/main/streams/memory.c
++++ php5/main/streams/memory.c
+@@ -18,7 +18,6 @@
+ 
+ /* $Id$ */
+ 
+-#define _GNU_SOURCE
+ #include "php.h"
+ 
+ PHPAPI int php_url_decode(char *str, int len);
+--- php5.orig/main/streams/streams.c
++++ php5/main/streams/streams.c
+@@ -21,7 +21,6 @@
+ 
+ /* $Id$ */
+ 
+-#define _GNU_SOURCE
+ #include "php.h"
+ #include "php_globals.h"
+ #include "php_network.h"
+--- php5.orig/Zend/zend_language_parser.c
++++ php5/Zend/zend_language_parser.c
+@@ -75,6 +75,8 @@
+ 
+ /* Copy the first part of user declarations.  */
+ 
++#include <string.h>
++
+ 
+ /*
+    +----------------------------------------------------------------------+
diff -ruN php-5.5.1.orig/fink/patches/php-5.3.9-mysqlnd.patch php-5.5.1/fink/patches/php-5.3.9-mysqlnd.patch
--- php-5.5.1.orig/fink/patches/php-5.3.9-mysqlnd.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-5.3.9-mysqlnd.patch	2013-08-08 10:49:45.000000000 -0600
@@ -0,0 +1,22 @@
+--- php5.orig/ext/mysqlnd/mysqlnd.c
++++ php5/ext/mysqlnd/mysqlnd.c
+@@ -921,7 +921,7 @@ MYSQLND_METHOD(mysqlnd_conn_data, connec
+ 		if (host_len == sizeof("localhost") - 1 && !strncasecmp(host, "localhost", host_len)) {
+ 			DBG_INF_FMT("socket=%s", socket_or_pipe? socket_or_pipe:"n/a");
+ 			if (!socket_or_pipe) {
+-				socket_or_pipe = "/tmp/mysql.sock";
++				socket_or_pipe = "@FINKPREFIX@/var/run/mysqld/mysqld.sock";
+ 			}
+ 			transport_len = mnd_sprintf(&transport, 0, "unix://%s", socket_or_pipe);
+ 			unix_socket = TRUE;
+--- php5.orig/ext/pdo_mysql/pdo_mysql.c
++++ php5/ext/pdo_mysql/pdo_mysql.c
+@@ -50,7 +50,7 @@ ZEND_DECLARE_MODULE_GLOBALS(pdo_mysql)
+ #  define PDO_MYSQL_UNIX_ADDR PHP_MYSQL_UNIX_SOCK_ADDR
+ # else
+ #  if !PHP_WIN32
+-#   define PDO_MYSQL_UNIX_ADDR "/tmp/mysql.sock"
++#   define PDO_MYSQL_UNIX_ADDR "@FINKPREFIX@/var/run/mysqld/mysqld.sock"
+ #  else
+ #   define PDO_MYSQL_UNIX_ADDR NULL
+ #  endif
diff -ruN php-5.5.1.orig/fink/patches/php-5.4.0-dlopen.patch php-5.5.1/fink/patches/php-5.4.0-dlopen.patch
--- php-5.5.1.orig/fink/patches/php-5.4.0-dlopen.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-5.4.0-dlopen.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,17 @@
+--- php5.orig/Zend/zend.h
++++ php5/Zend/zend.h
+@@ -90,11 +90,11 @@
+ # endif
+ 
+ # if defined(RTLD_GROUP) && defined(RTLD_WORLD) && defined(RTLD_PARENT)
+-#  define DL_LOAD(libname)			dlopen(libname, RTLD_LAZY | RTLD_GLOBAL | RTLD_GROUP | RTLD_WORLD | RTLD_PARENT)
++#  define DL_LOAD(libname)			dlopen(libname, RTLD_NOW  | RTLD_GLOBAL | RTLD_GROUP | RTLD_WORLD | RTLD_PARENT)
+ # elif defined(RTLD_DEEPBIND)
+-#  define DL_LOAD(libname)			dlopen(libname, RTLD_LAZY | RTLD_GLOBAL | RTLD_DEEPBIND)
++#  define DL_LOAD(libname)			dlopen(libname, RTLD_NOW  | RTLD_GLOBAL | RTLD_DEEPBIND)
+ # else
+-#  define DL_LOAD(libname)			dlopen(libname, RTLD_LAZY | RTLD_GLOBAL)
++#  define DL_LOAD(libname)			dlopen(libname, RTLD_NOW  | RTLD_GLOBAL)
+ # endif
+ # define DL_UNLOAD					dlclose
+ # if defined(DLSYM_NEEDS_UNDERSCORE)
diff -ruN php-5.5.1.orig/fink/patches/php-fpm-listen-on-unix-socket.patch php-5.5.1/fink/patches/php-fpm-listen-on-unix-socket.patch
--- php-5.5.1.orig/fink/patches/php-fpm-listen-on-unix-socket.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-fpm-listen-on-unix-socket.patch	2013-08-08 10:50:03.000000000 -0600
@@ -0,0 +1,11 @@
+--- php5.orig/sapi/fpm/php-fpm.conf.in
++++ php5/sapi/fpm/php-fpm.conf.in
+@@ -160,7 +160,7 @@ group = @php_fpm_group@
+ ;                            specific port;
+ ;   '/path/to/unix/socket' - to listen on a unix socket.
+ ; Note: This value is mandatory.
+-listen = 127.0.0.1:9000
++listen = @FINKPREFIX@/var/run/php5-fpm.sock
+ 
+ ; Set listen(2) backlog.
+ ; Default Value: 128 (-1 on FreeBSD and OpenBSD)
diff -ruN php-5.5.1.orig/fink/patches/php-fpm-m68k.patch php-5.5.1/fink/patches/php-fpm-m68k.patch
--- php-5.5.1.orig/fink/patches/php-fpm-m68k.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-fpm-m68k.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,55 @@
+Description: add Linux/m68k atomic code
+Origin: libgcc 4.7
+Bug: https://bugs.php.net/bug.php?id=60925
+Author: Thorsten Glaser <tg@debian.org>
+
+--- php5.orig/sapi/fpm/fpm/fpm_atomic.h
++++ php5/sapi/fpm/fpm/fpm_atomic.h
+@@ -5,6 +5,12 @@
+ #ifndef FPM_ATOMIC_H
+ #define FPM_ATOMIC_H 1
+ 
++#if defined(__m68k__)
++#define _GNU_SOURCE
++#include <unistd.h>
++#include <sys/syscall.h>
++#endif
++
+ #if HAVE_INTTYPES_H
+ # include <inttypes.h>
+ #else
+@@ -137,6 +143,34 @@ static inline atomic_uint_t atomic_cmp_s
+ #error Sparc v8 and predecessors are not and will not be supported (see bug report 53310)
+ #endif /* #if (__sparcv9 || __sparcv9__) */
+ 
++#elif defined(__m68k__) && defined(__linux__)
++
++typedef signed int atomic_int_t __attribute__((__aligned__(4)));
++typedef unsigned int atomic_uint_t __attribute__((__aligned__(4)));
++typedef volatile unsigned int atomic_t __attribute__((__aligned__(4)));
++
++#ifndef SYS_atomic_cmpxchg_32
++#define SYS_atomic_cmpxchg_32 335
++#endif
++
++static inline atomic_uint_t atomic_cas_32(atomic_t *lock, atomic_uint_t old, atomic_uint_t new) /* {{{ */
++{
++	register atomic_t *a0 asm("a0") = lock;
++	register atomic_uint_t d2 asm("d2") = old;
++	register atomic_uint_t d1 asm("d1") = new;
++	register atomic_uint_t d0 asm("d0") = SYS_atomic_cmpxchg_32;
++
++	asm volatile("trap #0" : "+r" (d0), "+r" (d1), "+r" (a0) : "r" (d2) : "memory", "a1");
++	return (d0);
++}
++/* }}} */
++
++static inline atomic_uint_t atomic_cmp_set(atomic_t *lock, atomic_uint_t old, atomic_uint_t set) /* {{{ */
++{
++	return (atomic_cas_32(lock, old, set) == old);
++}
++/* }}} */
++
+ #else
+ 
+ #error Unsupported processor. Please open a bug report (bugs.php.net).
diff -ruN php-5.5.1.orig/fink/patches/php-fpm-man-section-and-cleanup.patch php-5.5.1/fink/patches/php-fpm-man-section-and-cleanup.patch
--- php-5.5.1.orig/fink/patches/php-fpm-man-section-and-cleanup.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-fpm-man-section-and-cleanup.patch	2013-08-08 17:27:31.000000000 -0600
@@ -0,0 +1,45 @@
+Description: Fix php-fpm's manpage section to match location of binary
+ (/usr/sbin,) additionally, remove some stuff that is useless or
+ doesn't apply to Debian.
+Origin: vendor
+Forwarded: http://bugs.php.net/52476
+Last-Update: 2010-07-29
+
+--- php5.orig/sapi/fpm/php-fpm.8.in
++++ php5/sapi/fpm/php-fpm.8.in
+@@ -126,22 +126,8 @@ The configuration file for the php-fpm d
+ .TP
+ .B php.ini
+ The standard php configuration file.
+-.SH EXAMPLES
+-For any unix systems which use init.d for their main process manager, you should use the init script provided to start and stop the php-fpm daemon.
+-.P
+-.PD 1
+-.RS
+-sudo /etc/init.d/php-fpm start
+-.RE
+-.TP
+-For any unix systems which use systemd for their main process manager, you should use the unit file provided to start and stop the php-fpm daemon.
+-.P
+-.PD 1
+-.RS
+-sudo systemctl start php-fpm.service
+-.RE
+-.TP
+-If your installation has no appropriate init script, launch php-fpm with no arguments. It will launch as a daemon (background process) by default. The file @php_fpm_localstatedir@/run/php-fpm.pid determines whether php-fpm is already up and running. Once started, php-fpm then responds to several POSIX signals:
++.SH SIGNAL
++Once started, php-fpm then responds to several POSIX signals:
+ .P
+ .PD 0
+ .RS
+@@ -155,10 +141,6 @@ If your installation has no appropriate
+ .RE
+ .PD 1
+ .P
+-.SH TIPS
+-The PHP-FPM CGI daemon will work well with most popular webservers, including Apache2, lighttpd and nginx.
+-.PD 1
+-.P
+ .SH SEE ALSO
+ The PHP-FPM website:
+ .PD 0
diff -ruN php-5.5.1.orig/fink/patches/php-fpm-sysconfdir.patch php-5.5.1/fink/patches/php-fpm-sysconfdir.patch
--- php-5.5.1.orig/fink/patches/php-fpm-sysconfdir.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/php-fpm-sysconfdir.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,11 @@
+--- php5.orig/sapi/fpm/fpm/fpm_conf.c
++++ php5/sapi/fpm/fpm/fpm_conf.c
+@@ -1638,7 +1638,7 @@ int fpm_conf_init_main(int test_conf, in
+ 		char *tmp;
+ 
+ 		if (fpm_globals.prefix == NULL) {
+-			spprintf(&tmp, 0, "%s/php-fpm.conf", PHP_SYSCONFDIR);
++			spprintf(&tmp, 0, "%s/php5/fpm/php-fpm.conf", PHP_SYSCONFDIR);
+ 		} else {
+ 			spprintf(&tmp, 0, "%s/etc/php-fpm.conf", fpm_globals.prefix);
+ 		}
diff -ruN php-5.5.1.orig/fink/patches/qdbm-is-usr_include_qdbm.patch php-5.5.1/fink/patches/qdbm-is-usr_include_qdbm.patch
--- php-5.5.1.orig/fink/patches/qdbm-is-usr_include_qdbm.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/qdbm-is-usr_include_qdbm.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,20 @@
+Description: Look for qdbm under $prefix/include/qdbm too.
+ The Debian package ships the header files under that directory, for
+ unknown reasons.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-02-21
+
+--- php5.orig/ext/dba/config.m4
++++ php5/ext/dba/config.m4
+@@ -113,6 +113,10 @@ if test "$PHP_QDBM" != "no"; then
+       THIS_PREFIX=$i
+       THIS_INCLUDE=$i/include/depot.h
+       break
++    elif test -f "$i/include/qdbm/depot.h"; then
++      THIS_PREFIX=$i
++      THIS_INCLUDE=$i/include/qdbm/depot.h
++      break
+     fi
+   done
+ 
diff -ruN php-5.5.1.orig/fink/patches/series php-5.5.1/fink/patches/series
--- php-5.5.1.orig/fink/patches/series	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/series	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,54 @@
+001-libtool_fixes.patch
+002-static_openssl.patch
+004-ldap_fix.patch
+006-debian_quirks.patch
+libtool2.2.patch
+033-we_WANT_libtool.patch
+036-fd_setsize_fix.patch
+043-recode_size_t.patch
+044-strtod_arm_fix.patch
+045-exif_nesting_level.patch
+047-zts_with_dl.patch
+052-phpinfo_no_configure.patch
+053-extension_api.patch
+057-no_apache_installed.patch
+100-recode_is_shared.patch
+108-64_bit_datetime.patch
+112-proc_open.patch
+113-php.ini_securitynotes.patch
+116-posixness_fix.patch
+libdb_is_-ldb
+fix_broken_upstream_tests.patch
+use_embedded_timezonedb.patch
+force_libmysqlclient_r.patch
+mssql-null-exception.patch
+sybase-alias.patch
+strcmp_null-OnUpdateErrorLog.patch
+#deprecate_short_open_tag
+fix_broken_5.3_tests.patch
+dont-gitclean-in-build.patch
+#broken_5.3_test-posix_uname.patch
+shtool_mkdir_-p_-race-condition.patch
+qdbm-is-usr_include_qdbm.patch
+use_embedded_timezonedb_fixes.patch
+fix_broken_sha2_test.patch
+session_save_path.patch
+#install-programs_parallel_FTBFS.patch
+php-fpm-man-section-and-cleanup.patch
+fpm-config.patch
+php-fpm-sysconfdir.patch
+lp564920-fix-big-files.patch
+temporary-path-fixes-for-multiarch.patch
+gdIOCtx.patch
+hurd-noptrace.diff
+php-5.3.9-mysqlnd.patch
+php-5.3.9-gnusrc.patch
+php-5.3.3-macropen.patch
+php-5.2.4-norpath.patch
+php-fpm-listen-on-unix-socket.patch
+0001-Add-information-about-which-INI-file-is-which-inside.patch
+php-5.2.4-embed.patch
+php-5.4.0-dlopen.patch
+php-fpm-m68k.patch
+expose_all_built_and_installed_apis.patch
+Zend_OpCache_GNUHurd_fix.patch
diff -ruN php-5.5.1.orig/fink/patches/session_save_path.patch php-5.5.1/fink/patches/session_save_path.patch
--- php-5.5.1.orig/fink/patches/session_save_path.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/session_save_path.patch	2013-08-08 10:50:40.000000000 -0600
@@ -0,0 +1,40 @@
+Description: Set the default session.save_path dir to @FINKPREFIX@/var/lib/php5.
+ This is the directory that has been used in Debian to store the
+ session files and is partially protected by dir permissions.
+Origin: vendor
+Forwarded: not-needed
+Last-Update: 2010-05-01
+
+--- php5.orig/ext/session/session.c
++++ php5/ext/session/session.c
+@@ -733,7 +733,7 @@ static ZEND_INI_MH(OnUpdateSmartStr) /*
+ /* {{{ PHP_INI
+  */
+ PHP_INI_BEGIN()
+-	STD_PHP_INI_ENTRY("session.save_path",          "",          PHP_INI_ALL, OnUpdateSaveDir,save_path,          php_ps_globals,    ps_globals)
++	STD_PHP_INI_ENTRY("session.save_path",          "@FINKPREFIX@/var/lib/php5",          PHP_INI_ALL, OnUpdateSaveDir,save_path,          php_ps_globals,    ps_globals)
+ 	STD_PHP_INI_ENTRY("session.name",               "PHPSESSID", PHP_INI_ALL, OnUpdateName, session_name,       php_ps_globals,    ps_globals)
+ 	PHP_INI_ENTRY("session.save_handler",           "files",     PHP_INI_ALL, OnUpdateSaveHandler)
+ 	STD_PHP_INI_BOOLEAN("session.auto_start",       "0",         PHP_INI_ALL, OnUpdateBool,   auto_start,         php_ps_globals,    ps_globals)
+--- php5.orig/php.ini-development
++++ php5/php.ini-development
+@@ -1403,7 +1403,7 @@ session.save_handler = files
+ ; where MODE is the octal representation of the mode. Note that this
+ ; does not overwrite the process's umask.
+ ; http://php.net/session.save-path
+-;session.save_path = "/tmp"
++;session.save_path = "@FINKPREFIX@/var/lib/php5"
+ 
+ ; Whether to use cookies.
+ ; http://php.net/session.use-cookies
+--- php5.orig/php.ini-production
++++ php5/php.ini-production
+@@ -1352,7 +1352,7 @@ session.save_handler = files
+ ; where MODE is the octal representation of the mode. Note that this
+ ; does not overwrite the process's umask.
+ ; http://php.net/session.save-path
+-;session.save_path = "/tmp"
++;session.save_path = "@FINKPREFIX@/var/lib/php5"
+ 
+ ; Whether to use cookies.
+ ; http://php.net/session.use-cookies
diff -ruN php-5.5.1.orig/fink/patches/shtool_mkdir_-p_-race-condition.patch php-5.5.1/fink/patches/shtool_mkdir_-p_-race-condition.patch
--- php-5.5.1.orig/fink/patches/shtool_mkdir_-p_-race-condition.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/shtool_mkdir_-p_-race-condition.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,25 @@
+Description: Workaround a race condition in shtool's mkdir -p
+ This workaround can be affected by another race condition where a
+ different process running under a different user creates the directory,
+ which would make the chown/chmod calls fail.
+ .
+ This is the version of the patch sent to shtool upstream.
+Origin: vendor
+Forwarded: yes
+Last-Update: 2010-02-18
+
+--- php5.orig/build/shtool
++++ php5/build/shtool
+@@ -1003,7 +1003,11 @@ mkdir )
+                     if [ ".$opt_t" = .yes ]; then
+                         echo "mkdir $pathcomp" 1>&2
+                     fi
+-                    mkdir $pathcomp || errstatus=$?
++                    mkdir $pathcomp || {
++                        _errstatus=$?
++                        [ -d "$pathcomp" ] || errstatus=${_errstatus}
++                        unset _errstatus
++                    }
+                     if [ ".$opt_o" != . ]; then
+                         if [ ".$opt_t" = .yes ]; then
+                             echo "chown $opt_o $pathcomp" 1>&2
diff -ruN php-5.5.1.orig/fink/patches/strcmp_null-OnUpdateErrorLog.patch php-5.5.1/fink/patches/strcmp_null-OnUpdateErrorLog.patch
--- php-5.5.1.orig/fink/patches/strcmp_null-OnUpdateErrorLog.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/strcmp_null-OnUpdateErrorLog.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,13 @@
+--- /dev/null
++++ php5/tests/func/null-new_val.phpt
+@@ -0,0 +1,10 @@
++--TEST--
++ini_restore strcmp NULL new_val
++--FILE--
++<?php
++
++ini_set('error_log','ini_set_works');
++ini_restore('error_log');
++
++?>
++--EXPECT--
diff -ruN php-5.5.1.orig/fink/patches/sybase-alias.patch php-5.5.1/fink/patches/sybase-alias.patch
--- php-5.5.1.orig/fink/patches/sybase-alias.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/sybase-alias.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,41 @@
+--- php5.orig/ext/mssql/php_mssql.c
++++ php5/ext/mssql/php_mssql.c
+@@ -178,6 +178,38 @@ const zend_function_entry mssql_function
+  	PHP_FE(mssql_execute,				arginfo_mssql_execute)
+ 	PHP_FE(mssql_free_statement,		arginfo_mssql_free_statement)
+  	PHP_FE(mssql_guid_string,			arginfo_mssql_guid_string)
++#if !defined(PHP_WIN32) && !defined(HAVE_SYBASE_CT)
++        PHP_FALIAS(sybase_connect, mssql_connect,		arginfo_mssql_connect)
++        PHP_FALIAS(sybase_pconnect, mssql_pconnect,		arginfo_mssql_connect)
++        PHP_FALIAS(sybase_close, mssql_close,			arginfo_mssql_close)
++        PHP_FALIAS(sybase_select_db, mssql_select_db,		arginfo_mssql_select_db)
++        PHP_FALIAS(sybase_query, mssql_query,			arginfo_mssql_query)
++        PHP_FALIAS(sybase_fetch_batch, mssql_fetch_batch,	arginfo_mssql_fetch_batch)
++        PHP_FALIAS(sybase_affected_rows, mssql_rows_affected,	arginfo_mssql_rows_affected)
++        PHP_FALIAS(sybase_free_result, mssql_free_result,	arginfo_mssql_fetch_batch)
++        PHP_FALIAS(sybase_get_last_message, mssql_get_last_message,	arginfo_mssql_get_last_message)
++        PHP_FALIAS(sybase_num_rows, mssql_num_rows,		arginfo_mssql_fetch_batch)
++        PHP_FALIAS(sybase_num_fields, mssql_num_fields,		arginfo_mssql_fetch_batch)
++        PHP_FALIAS(sybase_fetch_field, mssql_fetch_field,	arginfo_mssql_fetch_field)
++        PHP_FALIAS(sybase_fetch_row, mssql_fetch_row,		arginfo_mssql_fetch_batch)
++        PHP_FALIAS(sybase_fetch_array, mssql_fetch_array,	arginfo_mssql_fetch_array)
++        PHP_FALIAS(sybase_fetch_assoc, mssql_fetch_assoc,	arginfo_mssql_fetch_assoc)
++        PHP_FALIAS(sybase_fetch_object, mssql_fetch_object,	arginfo_mssql_fetch_batch)
++        PHP_FALIAS(sybase_field_length, mssql_field_length,	arginfo_mssql_field_length)
++        PHP_FALIAS(sybase_field_name, mssql_field_name,		arginfo_mssql_field_length)
++        PHP_FALIAS(sybase_field_type, mssql_field_type,		arginfo_mssql_field_length)
++        PHP_FALIAS(sybase_data_seek, mssql_data_seek,		arginfo_mssql_data_seek)
++        PHP_FALIAS(sybase_field_seek, mssql_field_seek,		arginfo_mssql_fetch_field)
++        PHP_FALIAS(sybase_result, mssql_result,			arginfo_mssql_result)
++        PHP_FALIAS(sybase_next_result, mssql_next_result,	arginfo_mssql_fetch_assoc)
++        PHP_FALIAS(sybase_min_error_severity, mssql_min_error_severity,	arginfo_mssql_min_error_severity)
++        PHP_FALIAS(sybase_min_message_severity, mssql_min_message_severity,	arginfo_mssql_min_error_severity)
++        PHP_FALIAS(sybase_init, mssql_init,			arginfo_mssql_init)
++        PHP_FALIAS(sybase_bind, mssql_bind,			arginfo_mssql_bind)
++        PHP_FALIAS(sybase_execute, mssql_execute,		arginfo_mssql_execute)
++        PHP_FALIAS(sybase_free_statement, mssql_free_statement,	arginfo_mssql_free_statement)
++        PHP_FALIAS(sybase_guid_string, mssql_guid_string,	arginfo_mssql_guid_string)
++#endif
+ 	PHP_FE_END
+ };
+ /* }}} */
diff -ruN php-5.5.1.orig/fink/patches/temporary-path-fixes-for-multiarch.patch php-5.5.1/fink/patches/temporary-path-fixes-for-multiarch.patch
--- php-5.5.1.orig/fink/patches/temporary-path-fixes-for-multiarch.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/temporary-path-fixes-for-multiarch.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,128 @@
+Description: transitional workaround for multiarch
+ As a stopgap for natty, patch the various config.m4 files for modules whose
+ libraries have moved to the multiarch dir; we can't use --with-libdir yet
+ because that requires all the build-deps to have moved.
+Author: Jonathan Marsden
+Bug-Ubuntu: https://bugs.launchpad.net/bugs/739977
+Forwarded: not-needed
+Reviewed-by: Steve Langasek <steve.langasek@ubuntu.com>
+
+--- php5.orig/ext/dba/config.m4
++++ php5/ext/dba/config.m4
+@@ -239,7 +239,7 @@ AC_DEFUN([PHP_DBA_DB_CHECK],[
+     AC_MSG_ERROR([DBA: Could not find necessary header file(s).])
+   fi
+   for LIB in $2; do
+-    if test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.a || test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.$SHLIB_SUFFIX_NAME; then
++    if test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.a || test -f $THIS_PREFIX/$PHP_LIBDIR/$DEB_HOST_MULTIARCH/lib$LIB.$SHLIB_SUFFIX_NAME || test -f $THIS_PREFIX/$PHP_LIBDIR/lib$LIB.$SHLIB_SUFFIX_NAME; then
+       lib_found="";
+       PHP_TEMP_LDFLAGS(-L$THIS_PREFIX/$PHP_LIBDIR, -l$LIB,[
+         AC_TRY_LINK([
+--- php5.orig/ext/pcre/config0.m4
++++ php5/ext/pcre/config0.m4
+@@ -21,7 +21,7 @@ PHP_ARG_WITH(pcre-regex,,
+     AC_MSG_RESULT([$PCRE_INCDIR])
+ 
+     AC_MSG_CHECKING([for PCRE library location])
+-    for j in $PHP_PCRE_REGEX $PHP_PCRE_REGEX/$PHP_LIBDIR; do
++    for j in $PHP_PCRE_REGEX $PHP_PCRE_REGEX/$PHP_LIBDIR/$DEB_HOST_MULTIARCH $PHP_PCRE_REGEX/$PHP_LIBDIR; do
+       test -f $j/libpcre.a || test -f $j/libpcre.$SHLIB_SUFFIX_NAME && PCRE_LIBDIR=$j
+     done
+     
+--- php5.orig/acinclude.m4
++++ php5/acinclude.m4
+@@ -2282,7 +2282,7 @@ AC_DEFUN([PHP_SETUP_KERBEROS],[
+     fi
+ 
+     for i in $PHP_KERBEROS; do
+-      if test -f $i/$PHP_LIBDIR/libkrb5.a || test -f $i/$PHP_LIBDIR/libkrb5.$SHLIB_SUFFIX_NAME; then
++      if test -f $i/$PHP_LIBDIR/libkrb5.$SHLIB_SUFFIX_NAME || test -f $i/$PHP_LIBDIR/$DEB_HOST_MULTIARCH/libkrb5.$SHLIB_SUFFIX_NAME || test -f $i/$PHP_LIBDIR/libkrb5.a; then
+         PHP_KERBEROS_DIR=$i
+         break
+       fi
+@@ -2361,7 +2361,7 @@ AC_DEFUN([PHP_SETUP_OPENSSL],[
+       if test -r $i/include/openssl/evp.h; then
+         OPENSSL_INCDIR=$i/include
+       fi
+-      if test -r $i/$PHP_LIBDIR/libssl.a -o -r $i/$PHP_LIBDIR/libssl.$SHLIB_SUFFIX_NAME; then
++      if test -r $i/$PHP_LIBDIR/libssl.a -o -r $i/$PHP_LIBDIR/$DEB_HOST_MULTIARCH/libssl.$SHLIB_SUFFIX_NAME -o -r $i/$PHP_LIBDIR/libssl.$SHLIB_SUFFIX_NAME; then
+         OPENSSL_LIBDIR=$i/$PHP_LIBDIR
+       fi
+       test -n "$OPENSSL_INCDIR" && test -n "$OPENSSL_LIBDIR" && break
+--- php5.orig/ext/ldap/config.m4
++++ php5/ext/ldap/config.m4
+@@ -95,7 +95,7 @@ if test "$PHP_LDAP" != "no"; then
+     LDAP_PTHREAD=
+   fi
+ 
+-  if test -f $LDAP_LIBDIR/liblber.a || test -f $LDAP_LIBDIR/liblber.$SHLIB_SUFFIX_NAME; then
++  if test -f $LDAP_LIBDIR/liblber.a || test -f $LDAP_LIBDIR/$DEB_HOST_MULTIARCH/liblber.$SHLIB_SUFFIX_NAME || test -f $LDAP_LIBDIR/liblber.$SHLIB_SUFFIX_NAME; then
+     PHP_ADD_LIBRARY_WITH_PATH(lber, $LDAP_LIBDIR, LDAP_SHARED_LIBADD)
+     PHP_ADD_LIBRARY_WITH_PATH(ldap, $LDAP_LIBDIR, LDAP_SHARED_LIBADD)
+ 
+--- php5.orig/ext/mssql/config.m4
++++ php5/ext/mssql/config.m4
+@@ -38,7 +38,7 @@ if test "$PHP_MSSQL" != "no"; then
+     fi
+   fi  
+ 
+-  if test ! -r "$FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a" && test ! -r "$FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.so"; then
++  if test ! -r "$FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a" && test ! -r "$FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/$DEB_HOST_MULTIARCH/libsybdb.so" && test ! -r "$FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.so"; then
+      AC_MSG_ERROR(Could not find $FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.[a|so])
+   fi
+ 
+--- php5.orig/ext/pdo_dblib/config.m4
++++ php5/ext/pdo_dblib/config.m4
+@@ -46,7 +46,7 @@ if test "$PHP_PDO_DBLIB" != "no"; then
+     PHP_LIBDIR=lib
+   fi
+ 
+-  if test ! -r "$PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a" && test ! -r "$PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.so"; then
++  if test ! -r "$PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.a" && test ! -r "$PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/$DEB_HOST_MULTIARCH/libsybdb.so" && test ! -r "$PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.so"; then
+      AC_MSG_ERROR(Could not find $PDO_FREETDS_INSTALLATION_DIR/$PHP_LIBDIR/libsybdb.[a|so])
+   fi
+ 
+--- php5.orig/ext/mysql/config.m4
++++ php5/ext/mysql/config.m4
+@@ -93,17 +93,15 @@ Note that the MySQL client library is no
+   fi
+ 
+   for i in $PHP_LIBDIR $PHP_LIBDIR/mysql; do
+-    MYSQL_LIB_CHK($i)
++    MYSQL_LIB_CHK($i/$DEB_HOST_MULTIARCH)
++    if test -z "$MYSQL_LIB_DIR"; then
++      MYSQL_LIB_CHK($i)
++    else
++      MYSQL_LIB_DIR=$MYSQL_DIR/$i
++    fi
+   done
+ 
+   if test -z "$MYSQL_LIB_DIR"; then
+-    MYSQL_LIB_CHK(lib/x86_64-linux-gnu)
+-  fi
+-  if test -z "$MYSQL_LIB_DIR"; then
+-    MYSQL_LIB_CHK(lib/i386-linux-gnu)
+-  fi
+-
+-  if test -z "$MYSQL_LIB_DIR"; then
+     AC_MSG_ERROR([Cannot find lib$MYSQL_LIBNAME under $MYSQL_DIR.
+ Note that the MySQL client library is not bundled anymore!])
+   fi
+--- php5.orig/ext/gmp/config.m4
++++ php5/ext/gmp/config.m4
+@@ -9,6 +9,7 @@ if test "$PHP_GMP" != "no"; then
+ 
+   for i in $PHP_GMP /usr/local /usr; do
+     test -f $i/include/gmp.h && GMP_DIR=$i && break
++    test -f $i/include/$DEB_HOST_MULTIARCH/gmp.h && GMP_DIR=$i && break
+   done
+ 
+   if test -z "$GMP_DIR"; then
+@@ -29,6 +30,7 @@ if test "$PHP_GMP" != "no"; then
+ 
+   PHP_ADD_LIBRARY_WITH_PATH(gmp, $GMP_DIR/$PHP_LIBDIR, GMP_SHARED_LIBADD)
+   PHP_ADD_INCLUDE($GMP_DIR/include)
++  PHP_ADD_INCLUDE($GMP_DIR/include/$DEB_HOST_MULTIARCH)
+ 
+   PHP_NEW_EXTENSION(gmp, gmp.c, $ext_shared)
+   PHP_SUBST(GMP_SHARED_LIBADD)
diff -ruN php-5.5.1.orig/fink/patches/use_embedded_timezonedb.patch php-5.5.1/fink/patches/use_embedded_timezonedb.patch
--- php-5.5.1.orig/fink/patches/use_embedded_timezonedb.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/use_embedded_timezonedb.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,635 @@
+Add support for use of the system timezone database, rather
+than embedding a copy.  Discussed upstream but was not desired.
+
+History:
+r10 : make timezone case insensitive
+r9: fix another compile error without --with-system-tzdata configured (Michael Heimpold)
+r8: fix compile error without --with-system-tzdata configured
+r7: improve check for valid timezone id to exclude directories
+r6: fix fd leak in r5, fix country code/BC flag use in 
+    timezone_identifiers_list() using system db,
+    fix use of PECL timezonedb to override system db,
+r5: reverts addition of "System/Localtime" fake tzname.
+    updated for 5.3.0, parses zone.tab to pick up mapping between
+    timezone name, country code and long/lat coords
+r4: added "System/Localtime" tzname which uses /etc/localtime
+r3: fix a crash if /usr/share/zoneinfo doesn't exist (Raphael Geissert)
+r2: add filesystem trawl to set up name alias index
+r1: initial revision
+
+--- php5.orig/ext/date/lib/parse_tz.c
++++ php5/ext/date/lib/parse_tz.c
+@@ -24,6 +24,16 @@
+ 
+ #include "timelib.h"
+ 
++#ifdef HAVE_SYSTEM_TZDATA
++#include <sys/mman.h>
++#include <sys/stat.h>
++#include <limits.h>
++#include <fcntl.h>
++#include <unistd.h>
++
++#include "php_scandir.h"
++#endif
++
+ #include <stdio.h>
+ 
+ #ifdef HAVE_LOCALE_H
+@@ -35,7 +45,12 @@
+ #else
+ #include <strings.h>
+ #endif
++
++#ifndef HAVE_SYSTEM_TZDATA
+ #include "timezonedb.h"
++#endif
++
++#include <ctype.h>
+ 
+ #if (defined(__APPLE__) || defined(__APPLE_CC__)) && (defined(__BIG_ENDIAN__) || defined(__LITTLE_ENDIAN__))
+ # if defined(__LITTLE_ENDIAN__)
+@@ -55,9 +70,14 @@
+ 
+ static void read_preamble(const unsigned char **tzf, timelib_tzinfo *tz)
+ {
+-	/* skip ID */
+-	*tzf += 4;
+-	
++        if (memcmp(tzf, "TZif", 4) == 0) {
++                *tzf += 20;
++                return;
++        }
++        
++        /* skip ID */
++        *tzf += 4;
++                
+ 	/* read BC flag */
+ 	tz->bc = (**tzf == '\1');
+ 	*tzf += 1;
+@@ -260,7 +280,405 @@ void timelib_dump_tzinfo(timelib_tzinfo
+ 	}
+ }
+ 
+-static int seek_to_tz_position(const unsigned char **tzf, char *timezone, const timelib_tzdb *tzdb)
++#ifdef HAVE_SYSTEM_TZDATA
++
++#ifdef HAVE_SYSTEM_TZDATA_PREFIX
++#define ZONEINFO_PREFIX HAVE_SYSTEM_TZDATA_PREFIX
++#else
++#define ZONEINFO_PREFIX "/usr/share/zoneinfo"
++#endif
++
++/* System timezone database pointer. */
++static const timelib_tzdb *timezonedb_system;
++
++/* Hash table entry for the cache of the zone.tab mapping table. */
++struct location_info {
++        char code[2];
++        double latitude, longitude;
++        char name[64];
++        char *comment;
++        struct location_info *next;
++};
++
++/* Cache of zone.tab. */
++static struct location_info **system_location_table;
++
++/* Size of the zone.tab hash table; a random-ish prime big enough to
++ * prevent too many collisions. */
++#define LOCINFO_HASH_SIZE (1021)
++
++/* Compute a case insensitive hash of str */
++static uint32_t tz_hash(const char *str)
++{
++    const unsigned char *p = (const unsigned char *)str;
++    uint32_t hash = 5381;
++    int c;
++    
++    while ((c = tolower(*p++)) != '\0') {
++        hash = (hash << 5) ^ hash ^ c;
++    }
++    
++    return hash % LOCINFO_HASH_SIZE;
++}
++
++/* Parse an ISO-6709 date as used in zone.tab. Returns end of the
++ * parsed string on success, or NULL on parse error.  On success,
++ * writes the parsed number to *result. */
++static char *parse_iso6709(char *p, double *result)
++{
++    double v, sign;
++    char *pend;
++    size_t len;
++
++    if (*p == '+')
++        sign = 1.0;
++    else if (*p == '-')
++        sign = -1.0;
++    else
++        return NULL;
++
++    p++;
++    for (pend = p; *pend >= '0' && *pend <= '9'; pend++)
++        ;;
++
++    /* Annoying encoding used by zone.tab has no decimal point, so use
++     * the length to determine the format:
++     * 
++     * 4 = DDMM
++     * 5 = DDDMM
++     * 6 = DDMMSS
++     * 7 = DDDMMSS
++     */
++    len = pend - p;
++    if (len < 4 || len > 7) {
++        return NULL;
++    }
++
++    /* p => [D]DD */
++    v = (p[0] - '0') * 10.0 + (p[1] - '0');
++    p += 2;
++    if (len == 5 || len == 7)
++        v = v * 10.0 + (*p++ - '0');
++    /* p => MM[SS] */
++    v += (10.0 * (p[0] - '0')
++          + p[1] - '0') / 60.0;
++    p += 2;
++    /* p => [SS] */
++    if (len > 5) {
++        v += (10.0 * (p[0] - '0')
++              + p[1] - '0') / 3600.0;
++        p += 2;
++    }
++
++    /* Round to five decimal place, not because it's a good idea,
++     * but, because the builtin data uses rounded data, so, match
++     * that. */
++    *result = round(v * sign * 100000.0) / 100000.0;
++
++    return p;
++}
++
++/* This function parses the zone.tab file to build up the mapping of
++ * timezone to country code and geographic location, and returns a
++ * hash table.  The hash table is indexed by the function:
++ *
++ *   tz_hash(timezone-name)
++ */
++static struct location_info **create_location_table(void)
++{
++    struct location_info **li, *i;
++    char zone_tab[PATH_MAX];
++    char line[512];
++    FILE *fp;
++
++    strncpy(zone_tab, ZONEINFO_PREFIX "/zone.tab", sizeof zone_tab);
++
++    fp = fopen(zone_tab, "r");
++    if (!fp) {
++        return NULL;
++    }
++
++    li = calloc(LOCINFO_HASH_SIZE, sizeof *li);
++
++    while (fgets(line, sizeof line, fp)) {
++        char *p = line, *code, *name, *comment;
++        uint32_t hash;
++        double latitude, longitude;
++
++        while (isspace(*p))
++            p++;
++
++        if (*p == '#' || *p == '\0' || *p == '\n')
++            continue;
++        
++        if (!isalpha(p[0]) || !isalpha(p[1]) || p[2] != '\t')
++            continue;
++        
++        /* code => AA */
++        code = p;
++        p[2] = 0;
++        p += 3;
++
++        /* coords => [+-][D]DDMM[SS][+-][D]DDMM[SS] */
++        p = parse_iso6709(p, &latitude);
++        if (!p) {
++            continue;
++        }
++        p = parse_iso6709(p, &longitude);
++        if (!p) {
++            continue;
++        }
++
++        if (!p || *p != '\t') {
++            continue;
++        }
++
++        /* name = string */
++        name = ++p;
++        while (*p != '\t' && *p && *p != '\n')
++            p++;
++
++        *p++ = '\0';
++
++        /* comment = string */
++        comment = p;
++        while (*p != '\t' && *p && *p != '\n')
++            p++;
++
++        if (*p == '\n' || *p == '\t')
++            *p = '\0';
++        
++        hash = tz_hash(name);
++        i = malloc(sizeof *i);
++        memcpy(i->code, code, 2);
++        strncpy(i->name, name, sizeof i->name);
++        i->comment = strdup(comment);
++        i->longitude = longitude;
++        i->latitude = latitude;
++        i->next = li[hash];
++        li[hash] = i;
++        /* printf("%s [%u, %f, %f]\n", name, hash, latitude, longitude); */
++    }
++
++    fclose(fp);
++
++    return li;
++}
++
++/* Return location info from hash table, using given timezone name.
++ * Returns NULL if the name could not be found. */
++const struct location_info *find_zone_info(struct location_info **li, 
++                                           const char *name)
++{
++    uint32_t hash = tz_hash(name);
++    const struct location_info *l;
++
++    if (!li) {
++        return NULL;
++    }
++
++    for (l = li[hash]; l; l = l->next) {
++        if (strcasecmp(l->name, name) == 0)
++            return l;
++    }
++
++    return NULL;
++}    
++
++/* Filter out some non-tzdata files and the posix/right databases, if
++ * present. */
++static int index_filter(const struct dirent *ent)
++{
++	return strcmp(ent->d_name, ".") != 0
++		&& strcmp(ent->d_name, "..") != 0
++		&& strcmp(ent->d_name, "posix") != 0
++		&& strcmp(ent->d_name, "posixrules") != 0
++		&& strcmp(ent->d_name, "right") != 0
++		&& strstr(ent->d_name, ".tab") == NULL;
++}
++
++static int sysdbcmp(const void *first, const void *second)
++{
++        const timelib_tzdb_index_entry *alpha = first, *beta = second;
++
++        return strcmp(alpha->id, beta->id);
++}
++
++
++/* Create the zone identifier index by trawling the filesystem. */
++static void create_zone_index(timelib_tzdb *db)
++{
++	size_t dirstack_size,  dirstack_top;
++	size_t index_size, index_next;
++	timelib_tzdb_index_entry *db_index;
++	char **dirstack;
++
++	/* LIFO stack to hold directory entries to scan; each slot is a
++	 * directory name relative to the zoneinfo prefix. */
++	dirstack_size = 32;
++	dirstack = malloc(dirstack_size * sizeof *dirstack);
++	dirstack_top = 1;
++	dirstack[0] = strdup("");
++	
++	/* Index array. */
++	index_size = 64;
++	db_index = malloc(index_size * sizeof *db_index);
++	index_next = 0;
++
++	do {
++		struct dirent **ents;
++		char name[PATH_MAX], *top;
++		int count;
++
++		/* Pop the top stack entry, and iterate through its contents. */
++		top = dirstack[--dirstack_top];
++		snprintf(name, sizeof name, ZONEINFO_PREFIX "/%s", top);
++
++		count = php_scandir(name, &ents, index_filter, php_alphasort);
++
++		while (count > 0) {
++			struct stat st;
++			const char *leaf = ents[count - 1]->d_name;
++
++			snprintf(name, sizeof name, ZONEINFO_PREFIX "/%s/%s", 
++				 top, leaf);
++			
++			if (strlen(name) && stat(name, &st) == 0) {
++				/* Name, relative to the zoneinfo prefix. */
++				const char *root = top;
++
++				if (root[0] == '/') root++;
++
++				snprintf(name, sizeof name, "%s%s%s", root, 
++					 *root ? "/": "", leaf);
++
++				if (S_ISDIR(st.st_mode)) {
++					if (dirstack_top == dirstack_size) {
++						dirstack_size *= 2;
++						dirstack = realloc(dirstack, 
++								   dirstack_size * sizeof *dirstack);
++					}
++					dirstack[dirstack_top++] = strdup(name);
++				}
++				else {
++					if (index_next == index_size) {
++						index_size *= 2;
++						db_index = realloc(db_index,
++								   index_size * sizeof *db_index);
++					}
++
++					db_index[index_next++].id = strdup(name);
++				}
++			}
++
++			free(ents[--count]);
++		}
++		
++		if (count != -1) free(ents);
++		free(top);
++	} while (dirstack_top);
++
++        qsort(db_index, index_next, sizeof *db_index, sysdbcmp);
++
++	db->index = db_index;
++	db->index_size = index_next;
++
++	free(dirstack);
++}
++
++#define FAKE_HEADER "1234\0??\1??"
++#define FAKE_UTC_POS (7 - 4)
++
++/* Create a fake data segment for database 'sysdb'. */
++static void fake_data_segment(timelib_tzdb *sysdb,
++                              struct location_info **info)
++{
++        size_t n;
++        char *data, *p;
++        
++        data = malloc(3 * sysdb->index_size + 7);
++
++        p = mempcpy(data, FAKE_HEADER, sizeof(FAKE_HEADER) - 1);
++
++        for (n = 0; n < sysdb->index_size; n++) {
++                const struct location_info *li;
++                timelib_tzdb_index_entry *ent;
++
++                ent = (timelib_tzdb_index_entry *)&sysdb->index[n];
++
++                /* Lookup the timezone name in the hash table. */
++                if (strcmp(ent->id, "UTC") == 0) {
++                        ent->pos = FAKE_UTC_POS;
++                        continue;
++                }
++
++                li = find_zone_info(info, ent->id);
++                if (li) {
++                        /* If found, append the BC byte and the
++                         * country code; set the position for this
++                         * section of timezone data.  */
++                        ent->pos = (p - data) - 4;
++                        *p++ = '\1';
++                        *p++ = li->code[0];
++                        *p++ = li->code[1];
++                }
++                else {
++                        /* If not found, the timezone data can
++                         * point at the header. */
++                        ent->pos = 0;
++                }
++        }
++        
++        sysdb->data = (unsigned char *)data;
++}
++
++/* Returns true if the passed-in stat structure describes a
++ * probably-valid timezone file. */
++static int is_valid_tzfile(const struct stat *st)
++{
++	return S_ISREG(st->st_mode) && st->st_size > 20;
++}
++
++/* Return the mmap()ed tzfile if found, else NULL.  On success, the
++ * length of the mapped data is placed in *length. */
++static char *map_tzfile(const char *timezone, size_t *length)
++{
++	char fname[PATH_MAX];
++	struct stat st;
++	char *p;
++	int fd;
++	
++	if (timezone[0] == '\0' || strstr(timezone, "..") != NULL) {
++		return NULL;
++	}
++
++    if (system_location_table) {
++        const struct location_info *li;
++        if ((li = find_zone_info(system_location_table, timezone)) != NULL) {
++            /* Use the stored name to avoid case issue */
++            timezone = li->name;
++        }
++    }
++	snprintf(fname, sizeof fname, ZONEINFO_PREFIX "/%s", timezone);
++	
++	fd = open(fname, O_RDONLY);
++	if (fd == -1) {
++		return NULL;
++	} else if (fstat(fd, &st) != 0 || !is_valid_tzfile(&st)) {
++		close(fd);
++		return NULL;
++	}
++
++	*length = st.st_size;
++	p = mmap(NULL, st.st_size, PROT_READ, MAP_SHARED, fd, 0);
++	close(fd);
++	
++	return p != MAP_FAILED ? p : NULL;
++}
++
++#endif
++
++static int inmem_seek_to_tz_position(const unsigned char **tzf, char *timezone, const timelib_tzdb *tzdb)
+ {
+ 	int left = 0, right = tzdb->index_size - 1;
+ #ifdef HAVE_SETLOCALE
+@@ -299,36 +717,135 @@ static int seek_to_tz_position(const uns
+ 	return 0;
+ }
+ 
++static int seek_to_tz_position(const unsigned char **tzf, char *timezone, 
++			       char **map, size_t *maplen,
++			       const timelib_tzdb *tzdb)
++{
++#ifdef HAVE_SYSTEM_TZDATA
++	if (tzdb == timezonedb_system) {
++		char *orig;
++
++		orig = map_tzfile(timezone, maplen);
++		if (orig == NULL) {
++			return 0;
++		}
++		
++		(*tzf) = (unsigned char *)orig ;
++		*map = orig;
++                
++                return 1;
++	}
++       else
++#endif
++       {
++		return inmem_seek_to_tz_position(tzf, timezone, tzdb);
++	}
++}
++
+ const timelib_tzdb *timelib_builtin_db(void)
+ {
++#ifdef HAVE_SYSTEM_TZDATA
++	if (timezonedb_system == NULL) {
++		timelib_tzdb *tmp = malloc(sizeof *tmp);
++
++		tmp->version = "0.system";
++		tmp->data = NULL;
++		create_zone_index(tmp);
++		system_location_table = create_location_table();
++                fake_data_segment(tmp, system_location_table);
++		timezonedb_system = tmp;
++	}
++
++			
++	return timezonedb_system;
++#else
+ 	return &timezonedb_builtin;
++#endif
+ }
+ 
+ const timelib_tzdb_index_entry *timelib_timezone_builtin_identifiers_list(int *count)
+ {
++#ifdef HAVE_SYSTEM_TZDATA
++	*count = timezonedb_system->index_size;
++	return timezonedb_system->index;
++#else
+ 	*count = sizeof(timezonedb_idx_builtin) / sizeof(*timezonedb_idx_builtin);
+ 	return timezonedb_idx_builtin;
++#endif
+ }
+ 
+ int timelib_timezone_id_is_valid(char *timezone, const timelib_tzdb *tzdb)
+ {
+ 	const unsigned char *tzf;
+-	return (seek_to_tz_position(&tzf, timezone, tzdb));
++
++#ifdef HAVE_SYSTEM_TZDATA
++        if (tzdb == timezonedb_system) {
++            char fname[PATH_MAX];
++            struct stat st;
++
++            if (timezone[0] == '\0' || strstr(timezone, "..") != NULL) {
++		        return 0;
++            }
++
++            if (system_location_table) {
++                if (find_zone_info(system_location_table, timezone) != NULL) {
++                    /* found in cache */
++                    return 1;
++                }
++            }
++            
++            snprintf(fname, sizeof fname, ZONEINFO_PREFIX "/%s", timezone);
++            
++            return stat(fname, &st) == 0 && is_valid_tzfile(&st);
++        }
++#endif
++
++	return (inmem_seek_to_tz_position(&tzf, timezone, tzdb));
+ }
+ 
+ timelib_tzinfo *timelib_parse_tzfile(char *timezone, const timelib_tzdb *tzdb)
+ {
+ 	const unsigned char *tzf;
++	char *memmap = NULL;
++	size_t maplen;
+ 	timelib_tzinfo *tmp;
+ 
+-	if (seek_to_tz_position(&tzf, timezone, tzdb)) {
++	if (seek_to_tz_position(&tzf, timezone, &memmap, &maplen, tzdb)) {
+ 		tmp = timelib_tzinfo_ctor(timezone);
+ 
+ 		read_preamble(&tzf, tmp);
+ 		read_header(&tzf, tmp);
+ 		read_transistions(&tzf, tmp);
+ 		read_types(&tzf, tmp);
+-		read_location(&tzf, tmp);
++
++#ifdef HAVE_SYSTEM_TZDATA
++		if (memmap) {
++			const struct location_info *li;
++
++			/* TZif-style - grok the location info from the system database,
++			 * if possible. */
++
++			if ((li = find_zone_info(system_location_table, timezone)) != NULL) {
++				tmp->location.comments = strdup(li->comment);
++                                strncpy(tmp->location.country_code, li->code, 2);
++				tmp->location.longitude = li->longitude;
++				tmp->location.latitude = li->latitude;
++				tmp->bc = 1;
++			}
++			else {
++				strcpy(tmp->location.country_code, "??");
++				tmp->bc = 0;
++				tmp->location.comments = strdup("");
++			}
++
++			/* Now done with the mmap segment - discard it. */
++			munmap(memmap, maplen);
++		} else
++#endif
++		{
++			/* PHP-style - use the embedded info. */
++			read_location(&tzf, tmp);
++		}
+ 	} else {
+ 		tmp = NULL;
+ 	}
+--- php5.orig/ext/date/lib/timelib.m4
++++ php5/ext/date/lib/timelib.m4
+@@ -78,3 +78,17 @@ stdlib.h
+ 
+ dnl Check for strtoll, atoll
+ AC_CHECK_FUNCS(strtoll atoll strftime)
++
++PHP_ARG_WITH(system-tzdata, for use of system timezone data,
++[  --with-system-tzdata[=DIR]      to specify use of system timezone data],
++no, no)
++
++if test "$PHP_SYSTEM_TZDATA" != "no"; then
++   AC_DEFINE(HAVE_SYSTEM_TZDATA, 1, [Define if system timezone data is used])
++
++   if test "$PHP_SYSTEM_TZDATA" != "yes"; then
++      AC_DEFINE_UNQUOTED(HAVE_SYSTEM_TZDATA_PREFIX, "$PHP_SYSTEM_TZDATA",
++                         [Define for location of system timezone data])
++   fi
++fi
++
diff -ruN php-5.5.1.orig/fink/patches/use_embedded_timezonedb_fixes.patch php-5.5.1/fink/patches/use_embedded_timezonedb_fixes.patch
--- php-5.5.1.orig/fink/patches/use_embedded_timezonedb_fixes.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/use_embedded_timezonedb_fixes.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,19 @@
+Author: Sean Finney <seanius@debian.org>
+Forwarded: no (upstream doesn't want it)
+Description: Silence warnings about using the default system timezone info
+ In vanilla upstream php, this is considered an error (i.e. the user must
+ set the timezone explicitly), though with our use of the system timezonedb
+ patch, we actually feel quite comfortable using the default timezone info.
+Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=571762
+--- php5.orig/ext/date/tests/date_default_timezone_set-1.phpt
++++ php5/ext/date/tests/date_default_timezone_set-1.phpt
+@@ -22,9 +22,6 @@ date.timezone=
+ 	echo date(DATE_ISO8601, $date4), "\n";
+ ?>
+ --EXPECTF--
+-Warning: strtotime(): It is not safe to rely on the system's timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone 'UTC' for now, but please set date.timezone to select your timezone. in %sdate_default_timezone_set-1.php on line 3
+-
+-Warning: strtotime(): It is not safe to rely on the system's timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone 'UTC' for now, but please set date.timezone to select your timezone. in %sdate_default_timezone_set-1.php on line 4
+ America/Indiana/Knox
+ 2005-01-12T03:00:00-0500
+ 2005-07-12T03:00:00-0500
diff -ruN php-5.5.1.orig/fink/patches/zend_int_overflow.patch php-5.5.1/fink/patches/zend_int_overflow.patch
--- php-5.5.1.orig/fink/patches/zend_int_overflow.patch	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/patches/zend_int_overflow.patch	2013-07-22 00:25:25.000000000 -0600
@@ -0,0 +1,110 @@
+Author: Sean Finney <seanius@debian.org>
+Description: Another integer overflow/underflow logic fix.
+ Once again, don't rely on undefined behavior and instead detect
+ the overflow/underflow conditions intelligently.
+Bug: http://bugs.php.net/bug.php?id=51008
+Bug-Debian: http://bugs.debian.org/570144
+--- a/Zend/zend_hash.h
++++ b/Zend/zend_hash.h
+@@ -306,9 +306,11 @@ END_EXTERN_C()
+ 
+ #define ZEND_HANDLE_NUMERIC_EX(key, length, idx, func) do {					\
+ 	register const char *tmp = key;											\
++	int negative = 0;											\
+ 																			\
+ 	if (*tmp == '-') {														\
+ 		tmp++;																\
++		negative = 1;																\
+ 	}																		\
+ 	if (*tmp >= '0' && *tmp <= '9') { /* possibly a numeric index */		\
+ 		const char *end = key + length - 1;									\
+@@ -321,19 +323,19 @@ END_EXTERN_C()
+ 		     *tmp > '2')) { /* overflow */									\
+ 			break;															\
+ 		}																	\
+-		idx = (*tmp - '0');													\
++		idx = ((negative)?-1:1) * (*tmp - '0');								\
+ 		while (++tmp != end && *tmp >= '0' && *tmp <= '9') {				\
+-			idx = (idx * 10) + (*tmp - '0');								\
+-		}																	\
+-		if (tmp == end) {													\
+-			if (*key == '-') {												\
+-				if (idx-1 > LONG_MAX) { /* overflow */						\
+-					break;													\
+-				}															\
+-				idx = 0 - idx;               									\
+-			} else if (idx > LONG_MAX) { /* overflow */						\
++			int digit = (*tmp - '0');										\
++			if ( (!negative) && idx <= (LONG_MAX-digit)/10 ) {				\
++				idx = (idx * 10) + digit;									\
++			} else if ( (negative) && idx >= (LONG_MIN+digit)/10 ) {		\
++				idx = (idx * 10) - digit;									\
++			} else {														\
++				--tmp; /* overflow or underflow, make sure tmp != end */	\
+ 				break;														\
+ 			}																\
++		}																	\
++		if (tmp == end) {													\
+ 			func;															\
+ 		}																	\
+ 	}																		\
+--- a/Zend/tests/bug45877.phpt
++++ b/Zend/tests/bug45877.phpt
+@@ -1,23 +1,40 @@
+ --TEST--
+ Bug #45877 (Array key '2147483647' left as string)
+---INI--
+-precision=16
+ --FILE--
+ <?php
+-$keys = array(PHP_INT_MAX,
+-	(string) PHP_INT_MAX,
+-	(string) (-PHP_INT_MAX - 1),
+-	-PHP_INT_MAX - 1,
+-	(string) (PHP_INT_MAX + 1));
++$max = sprintf("%d", PHP_INT_MAX);
++switch($max) {
++case "2147483647": /* 32-bit systems */
++	$min = "-2147483648";
++	$overflow = "2147483648";
++	$underflow = "-2147483649";
++	break;
++case "9223372036854775807": /* 64-bit systems */
++	$min = "-9223372036854775808";
++	$overflow = "9223372036854775808";
++	$underflow = "-9223372036854775809";
++	break;
++default:
++	die("failed: unknown value for PHP_MAX_INT");
++	break;
++}
+ 
+-var_dump(array_fill_keys($keys, 1));
+-?>
+---EXPECTF--
+-array(3) {
+-  [%d7]=>
+-  int(1)
+-  [-%d8]=>
+-  int(1)
+-  ["%s"]=>
+-  int(1)
++function test_value($val, $msg) {
++	$a = array($val => 1);
++	$keys = array_keys($a);
++	if ($val == $keys[0]) $result = "ok";
++	else $result = "failed ($val != $keys[0])";
++	echo "$msg: $result\n";
+ }
++
++test_value($max, "max");
++test_value($overflow, "overflow");
++test_value($min, "min");
++test_value($underflow, "underflow");
++
++?>
++--EXPECT--
++max: ok
++overflow: ok
++min: ok
++underflow: ok
diff -ruN php-5.5.1.orig/fink/php5-cgi.conf php-5.5.1/fink/php5-cgi.conf
--- php-5.5.1.orig/fink/php5-cgi.conf	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-cgi.conf	2013-08-08 10:03:51.000000000 -0600
@@ -0,0 +1,37 @@
+# This file replaces old system MIME types and sets them only in the
+# Apache webserver
+
+# application/x-httpd-php                        phtml pht php
+# application/x-httpd-php3                       php3
+# application/x-httpd-php4                       php4
+# application/x-httpd-php5                       php
+<FilesMatch ".+\.ph(p[345]?|t|tml)$">
+    SetHandler application/x-httpd-php
+</FilesMatch>
+# application/x-httpd-php-source                 phps
+<FilesMatch ".+\.phps$">
+    SetHandler application/x-httpd-php-source
+    # Deny access to raw php sources by default
+    # To re-enable it's recommended to enable access to the files
+    # only in specific virtual host or directory
+    Order Deny,Allow
+    Deny from all
+</FilesMatch>
+# Deny access to files without filename (e.g. '.php')
+<FilesMatch "^\.ph(p[345]?|t|tml|ps)$">
+    Order Deny,Allow
+    Deny from all
+</FilesMatch>
+
+# To enable PHP CGI site-wide, just uncomment following lines, however
+# as a security measure, it's recommended to enable PHP just in the
+# specific virtual servers or just specific directories
+
+#ScriptAlias /cgi-bin/ @FINKPREFIX@/lib/cgi-bin/
+#<Directory "@FINKPREFIX@/lib/cgi-bin">
+#    AllowOverride None
+#    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
+#    Order allow,deny
+#    Allow from all
+#</Directory>
+#Action application/x-httpd-php /cgi-bin/php5
diff -ruN php-5.5.1.orig/fink/php5-cgi.postinst.extra php-5.5.1/fink/php5-cgi.postinst.extra
--- php-5.5.1.orig/fink/php5-cgi.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-cgi.postinst.extra	2013-08-13 10:43:47.000000000 -0600
@@ -0,0 +1,25 @@
+dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/apache2/mods-available/php5_cgi.conf \
+    @FINKPREFIX@/etc/apache2/conf-available/php5-cgi.conf 5.5.0~beta4-1 -- "$@"
+
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/apache2/mods-available/php5_cgi.load 5.5.0~beta4-1 -- "$@"
+
+VERSION=$2
+
+php5_enable() {
+    # Enable php5-cgi only if upgrading from older versions of php5-cgi
+    if [ -n "$VERSION" ] && dpkg --compare-versions "$VERSION" lt 5.4.4-5; then
+	return 0
+    else
+	return 1
+    fi
+}
+
+if [ "$1" = "configure" ]; then
+    update-alternatives \
+	--install @FINKPREFIX@/bin/php-cgi php-cgi @FINKPREFIX@/bin/php5-cgi 50 \
+	--slave @FINKPREFIX@/share/man/man1/php-cgi.1 php-cgi.1 \
+	@FINKPREFIX@/share/man/man1/php5-cgi.1
+
+    update-alternatives \
+	--install @FINKPREFIX@/lib/cgi-bin/php php-cgi-bin @FINKPREFIX@/lib/cgi-bin/php5 50
+fi
diff -ruN php-5.5.1.orig/fink/php5-cgi.postrm.extra php-5.5.1/fink/php5-cgi.postrm.extra
--- php-5.5.1.orig/fink/php5-cgi.postrm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-cgi.postrm.extra	2013-08-13 10:44:08.000000000 -0600
@@ -0,0 +1,2 @@
+dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/apache2/mods-available/php5_cgi.conf @FINKPREFIX@/etc/apache2/conf-available/php5-cgi.conf 5.5.0~beta4-1 -- "$@"
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/apache2/mods-available/php5_cgi.load 5.5.0~beta4-1 -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-cgi.prerm.extra php-5.5.1/fink/php5-cgi.prerm.extra
--- php-5.5.1.orig/fink/php5-cgi.prerm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-cgi.prerm.extra	2013-08-13 10:44:20.000000000 -0600
@@ -0,0 +1,4 @@
+if [ "$1" = "remove" ]; then
+    update-alternatives --remove php-cgi @FINKPREFIX@/bin/php5-cgi
+    update-alternatives --remove php-cgi-bin @FINKPREFIX@/lib/cgi-bin/php5
+fi
diff -ruN php-5.5.1.orig/fink/php5-cli.postinst.extra php-5.5.1/fink/php5-cli.postinst.extra
--- php-5.5.1.orig/fink/php5-cli.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-cli.postinst.extra	2013-08-13 10:44:42.000000000 -0600
@@ -0,0 +1,5 @@
+if [ "$1" = "configure" ]; then
+    update-alternatives \
+	--install @FINKPREFIX@/bin/php php @FINKPREFIX@/bin/php5 50 \
+	--slave @FINKPREFIX@/share/man/man1/php.1 php.1 @FINKPREFIX@/share/man/man1/php5.1
+fi
diff -ruN php-5.5.1.orig/fink/php5-cli.prerm.extra php-5.5.1/fink/php5-cli.prerm.extra
--- php-5.5.1.orig/fink/php5-cli.prerm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-cli.prerm.extra	2013-08-13 10:44:50.000000000 -0600
@@ -0,0 +1,3 @@
+if [ "$1" = "remove" -o "$1" = "deconfigure" ]; then
+    update-alternatives --remove php @FINKPREFIX@/bin/php5
+fi
diff -ruN php-5.5.1.orig/fink/php5-common.php5.cron.d php-5.5.1/fink/php5-common.php5.cron.d
--- php-5.5.1.orig/fink/php5-common.php5.cron.d	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-common.php5.cron.d	2013-08-08 10:09:12.000000000 -0600
@@ -0,0 +1,7 @@
+# @FINKPREFIX@/etc/cron.d/php5: crontab fragment for php5
+#  This purges session files older than X, where X is defined in seconds
+#  as the largest value of session.gc_maxlifetime from all your php.ini
+#  files, or 24 minutes if not defined.  See @FINKPREFIX@/lib/php5/maxlifetime
+
+# Look for and purge old sessions every 30 minutes
+09,39 *     * * *     root   [ -x @FINKPREIFX@/lib/php5/maxlifetime ] && [ -x @FINKPREFIX@/lib/php5/sessionclean ] && [ -d @FINKPREFIX@/var/lib/php5 ] && @FINKPREFIX@/lib/php5/sessionclean @FINKPREFIX@/var/lib/php5 $(@FINKPREFIX@/lib/php5/maxlifetime)
diff -ruN php-5.5.1.orig/fink/php5-common.postinst.extra php-5.5.1/fink/php5-common.postinst.extra
--- php-5.5.1.orig/fink/php5-common.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-common.postinst.extra	2013-08-13 10:58:28.000000000 -0600
@@ -0,0 +1,10 @@
+for sapi in apache2 apache2filter cli cgi embed fpm; do
+    CONFDIR=@FINKPREFIX@/etc/php5/$sapi/conf.d
+
+    if [ -L $CONFDIR ]; then
+	rm $CONFDIR
+	mkdir $CONFDIR
+    fi
+done
+
+chmod 01733 @FINKPREFIX@/var/lib/php5
diff -ruN php-5.5.1.orig/fink/php5-common.postrm.extra php-5.5.1/fink/php5-common.postrm.extra
--- php-5.5.1.orig/fink/php5-common.postrm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-common.postrm.extra	2013-08-13 10:45:04.000000000 -0600
@@ -0,0 +1 @@
+[ "$1" = "purge" ] && rm -rf @FINKPREFIX@/var/lib/php5
diff -ruN php-5.5.1.orig/fink/php5-common.preinst.extra php-5.5.1/fink/php5-common.preinst.extra
--- php-5.5.1.orig/fink/php5-common.preinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-common.preinst.extra	2013-08-13 10:45:22.000000000 -0600
@@ -0,0 +1,4 @@
+if [ -d @FINKPREFIX@/var/lib/php5/module/ ]; then
+   cp -a @FINKPREFIX@/var/lib/php5/module/ @FINKPREFIX@/var/lib/php5/modules/
+   rm -rf @FINKPREFIX@/var/lib/php5/module/
+fi
diff -ruN php-5.5.1.orig/fink/php5-fpm.init php-5.5.1/fink/php5-fpm.init
--- php-5.5.1.orig/fink/php5-fpm.init	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-fpm.init	2013-08-08 16:06:12.000000000 -0600
@@ -0,0 +1,174 @@
+#!/bin/sh
+### BEGIN INIT INFO
+# Provides:          php-fpm php5-fpm
+# Required-Start:    $remote_fs $network
+# Required-Stop:     $remote_fs $network
+# Default-Start:     2 3 4 5
+# Default-Stop:      0 1 6	
+# Short-Description: starts php5-fpm
+# Description:       Starts The PHP FastCGI Process Manager Daemon
+### END INIT INFO
+
+# Author: Ondrej Sury <ondrej@debian.org>
+
+PATH=@FINKPREFIX@/sbin:@FINKPREFIX@/bin
+DESC="PHP5 FastCGI Process Manager"
+NAME=php5-fpm
+DAEMON=@FINKPREFIX@/sbin/$NAME
+DAEMON_ARGS="--daemonize --fpm-config @FINKPREFIX@/etc/php5/fpm/php-fpm.conf"
+PIDFILE=@FINKPREFIX@/var/run/php5-fpm.pid
+TIMEOUT=30
+SCRIPTNAME=@FINKPREFIX@/sbin/${NAME}ctl
+
+# Exit if the package is not installed
+[ -x "$DAEMON" ] || exit 0
+
+# Read configuration variable file if it is present
+[ -r @FINKPREFIX@/etc/default/$NAME ] && . @FINKPREFIX@/etc/default/$NAME
+
+#
+# Function to check the correctness of the config file
+#
+do_check()
+{
+    [ "$1" != "no" ] && $DAEMON $DAEMON_ARGS -t 2>&1 | grep -v "\[ERROR\]"
+    FPM_ERROR=$($DAEMON $DAEMON_ARGS -t 2>&1 | grep "\[ERROR\]")
+
+    if [ -n "${FPM_ERROR}" ]; then
+	echo "Please fix your configuration file..."
+	$DAEMON $DAEMON_ARGS -t 2>&1 | grep "\[ERROR\]"
+	return 1
+    fi
+    return 0
+}
+
+#
+# Function that starts the daemon/service
+#
+do_start()
+{
+	# Return
+	#   0 if daemon has been started
+	#   1 if daemon was already running
+	#   2 if daemon could not be started
+	start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON --test > /dev/null \
+		|| return 1
+	start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON -- \
+		$DAEMON_ARGS 2>/dev/null \
+		|| return 2
+	# Add code here, if necessary, that waits for the process to be ready
+	# to handle requests from services started subsequently which depend
+	# on this one.  As a last resort, sleep for some time.
+}
+
+#
+# Function that stops the daemon/service
+#
+do_stop()
+{
+	# Return
+	#   0 if daemon has been stopped
+	#   1 if daemon was already stopped
+	#   2 if daemon could not be stopped
+	#   other if a failure occurred
+	start-stop-daemon --stop --quiet --retry=QUIT/$TIMEOUT/TERM/5/KILL/5 --pidfile $PIDFILE --name $NAME
+	RETVAL="$?"
+	[ "$RETVAL" = 2 ] && return 2
+	# Wait for children to finish too if this is a daemon that forks
+	# and if the daemon is only ever run from this initscript.
+	# If the above conditions are not satisfied then add some other code
+	# that waits for the process to drop all resources that could be
+	# needed by services started subsequently.  A last resort is to
+	# sleep for some time.
+	start-stop-daemon --stop --quiet --oknodo --retry=0/30/TERM/5/KILL/5 --exec $DAEMON
+	[ "$?" = 2 ] && return 2
+	# Many daemons don't delete their pidfiles when they exit.
+	rm -f $PIDFILE
+	return "$RETVAL"
+}
+
+#
+# Function that sends a SIGHUP to the daemon/service
+#
+do_reload() {
+	#
+	# If the daemon can reload its configuration without
+	# restarting (for example, when it is sent a SIGHUP),
+	# then implement that here.
+	#
+	start-stop-daemon --stop --signal USR2 --quiet --pidfile $PIDFILE --name $NAME
+	return 0
+}
+
+case "$1" in
+    start)
+	[ "$VERBOSE" != no ] && echo -n "Starting $DESC "
+	do_check $VERBOSE
+	case "$?" in
+	    0)
+		do_start
+		case "$?" in
+		    0|1) [ "$VERBOSE" != no ] && echo "OK" ;;
+		    2) [ "$VERBOSE" != no ] && echo "Fail" ;;
+		esac
+		;;
+	    1) [ "$VERBOSE" != no ] && echo "Fail" ;;
+	esac
+	;;
+    stop)
+	[ "$VERBOSE" != no ] && echo -n "Stopping $DESC "
+	do_stop
+	case "$?" in
+		0|1) [ "$VERBOSE" != no ] && echo "OK" ;;
+		2) [ "$VERBOSE" != no ] && echo "Fail" ;;
+	esac
+	;;
+    status)
+        status_of_proc "$DAEMON" "$NAME" && exit 0 || exit $?
+        ;;
+    check)
+        do_check yes
+	;;
+    reload|force-reload)
+	echo "Reloading $DESC "
+	do_reload
+	case "$?" in
+		0|1) echo "OK" ;;
+		2) echo "Fail" ;;
+	esac
+	;;
+    reopen-logs)
+	echo "Reopening $DESC logs "
+	if start-stop-daemon --stop --signal USR1 --oknodo --quiet \
+	    --pidfile $PIDFILE --exec $DAEMON
+	then
+	    echo "Fail"
+	else
+	    echo "OK"
+	fi
+	;;
+    restart)
+	echo "Restarting $DESC "
+	do_stop
+	case "$?" in
+	  0|1)
+		do_start
+		case "$?" in
+			0) echo "OK" ;;
+			1) echo "Fail" ;; # Old process is still running
+			*) echo "Fail" ;; # Failed to start
+		esac
+		;;
+	  *)
+	  	# Failed to stop
+		echo "Fail"
+		;;
+	esac
+	;;
+    *)
+	echo "Usage: $SCRIPTNAME {start|stop|status|restart|reload|force-reload}" >&2
+	exit 1
+    ;;
+esac
+
+:
diff -ruN php-5.5.1.orig/fink/php5-fpm.logrotate php-5.5.1/fink/php5-fpm.logrotate
--- php-5.5.1.orig/fink/php5-fpm.logrotate	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-fpm.logrotate	2013-08-08 10:07:48.000000000 -0600
@@ -0,0 +1,11 @@
+@FINKPREFIX@/var/log/php5-fpm.log {
+	rotate 12
+	weekly
+	missingok
+	notifempty
+	compress
+	delaycompress
+	postrotate
+		invoke-rc.d php5-fpm reopen-logs > /dev/null
+	endscript
+}
diff -ruN php-5.5.1.orig/fink/php5-fpm.postinst.extra php-5.5.1/fink/php5-fpm.postinst.extra
--- php-5.5.1.orig/fink/php5-fpm.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-fpm.postinst.extra	2013-08-13 10:45:37.000000000 -0600
@@ -0,0 +1,5 @@
+if [ "$1" = "triggered" ] && [ "$2" = "@FINKPREFIX@/etc/php5/fpm/conf.d" ]; then
+    invoke-rc.d php5-fpm restart
+fi
+
+dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/fpm/main.conf @FINKPREFIX@/etc/php5/fpm/php-fpm.conf 5.3.5-1 -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-fpm.postrm.extra php-5.5.1/fink/php5-fpm.postrm.extra
--- php-5.5.1.orig/fink/php5-fpm.postrm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-fpm.postrm.extra	2013-08-13 10:45:47.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/fpm/main.conf @FINKPREFIX@/etc/php5/fpm/php-fpm.conf 5.3.5-1 -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-helper php-5.5.1/fink/php5-helper
--- php-5.5.1.orig/fink/php5-helper	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-helper	2013-08-13 10:22:36.000000000 -0600
@@ -0,0 +1,210 @@
+#!/bin/sh
+#
+#  php5enmod - a php5 module manager for Debian/Fink
+#
+#  Copyright 2013 Ondřej Surý <ondrej@sury.org>
+#
+# This program is licensed at your choice under the terms of the GNU General
+# Public License version 2+ or under the terms of the PHP License 3.01.
+#
+# For GPL-2+:
+# This program is free software; you can redistribute it and/or
+# modify it under the terms of the GNU General Public License
+# as published by the Free Software Foundation; either version 2
+# of the License, or (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
+# USA.
+#
+# For PHP 3.01:
+# This source file is subject to version 3.01 of the PHP license,
+# that is bundled with this package in the file LICENSE, and is
+# available through the world-wide-web at the following url:
+# http://www.php.net/license/3_01.txt
+# If you did not receive a copy of the PHP license and are unable to
+# obtain it through the world-wide-web, please send a note to
+# license@php.net so we can mail you a copy immediately.
+#
+
+warning() {
+    echo "WARNING: ${@}" >&2
+}
+
+remove_state() {
+    local action=$1
+    local sapi=$2
+    local modname=$3
+
+    local state_dir="$(get_state_dir $sapi)"
+    rm -f "${state_dir}/${action}_by_admin/$modname"
+    rm -f "${state_dir}/${action}_by_maint/$modname"
+
+    return 0
+}
+
+mod_registry() {
+    local action=$1
+    local modname=$2
+    local registry_dir="$(get_registry_dir)"
+    local registry_file="$registry_dir/$modname"
+
+    case $action in
+	register)
+	    if [ ! -d "$registry_dir" ]; then
+		mkdir -p "$registry_dir"
+	    fi
+	    touch "$registry_file"
+	    ;;
+	unregister)
+	    rm -f "$registry_file"
+	    ;;
+	status)
+	    if [ -e "$registry_file" ]; then
+		return 0
+	    else
+		return 1
+	    fi
+	    ;;
+	*)
+	    return 1
+	    ;;
+    esac
+
+    return 0
+}
+
+record_state() {
+    local action=$1
+    local sapi=$2
+    local modname=$3
+
+    local state_dir="@FINKPREFIX@/var/lib/php5/modules/${sapi}"
+    local admin_state="${state_dir}/${action}_by_admin/$modname"
+    local maint_state="${state_dir}/${action}_by_maint/$modname"
+
+    if [ -e "$admin_state" ]; then
+	return
+    fi
+
+    if [ -e "$maint_state" ]; then
+	if [ "$MAINT_MODE" = "yes" ]; then
+	    return
+	else
+	    rm "$maint_state"
+	fi
+    fi
+
+    # cleanup previous state
+    remove_state disabled $sapi $modname
+    remove_state enabled $sapi $modname
+
+    if [ "$MAINT_MODE" = "yes" ]; then
+	mkdir -p "$(dirname $maint_state)"
+	touch "$maint_state"
+    else
+	mkdir -p "$(dirname $admin_state)"
+	touch "$admin_state"
+    fi
+
+    return 0
+}
+
+output() {
+    if [ "$QUIET" != "yes" ]; then
+	echo "$@"
+    fi
+}
+
+get_priority() {
+    local sapi=$1
+    local modname=$2
+
+    local source_ini="@FINKPREFIX@/etc/php5/mods-available/${modname}.ini"
+
+    module_ret=0
+    module_exists $modname || module_ret=$?
+
+    if [ "$module_ret" -eq 0 ]; then
+	priority=$(sed -ne "s/^; priority=\([0-9]\+\)$/\\1/p" $source_ini)
+	[ -z "$priority" ] && priority=20
+	echo $priority
+	return 0
+    fi
+
+    return $module_ret
+}
+
+get_live_link() {
+    local sapi=$1
+    local modname=$2
+    local priority=$3
+    echo "@FINKPREFIX@/etc/php5/$sapi/conf.d/$priority-$modname.ini"
+}
+
+get_live_link_content() {
+    local sapi=$1
+    local modname=$2
+    local priority=$3
+    echo "../../mods-available/$modname.ini"
+}
+
+module_exists() {
+    local modname=$1
+    local source_ini="@FINKPREFIX@/etc/php5/mods-available/${modname}.ini"
+
+    if [ ! -r "${source_ini}" ]; then
+	return 1
+    fi
+    return 0
+}
+
+module_cleanup() {
+    local sapi=$1
+    local modname=$2
+    local priority=$3
+
+    if [ -L "@FINKPREFIX@/etc/php5/conf.d/$priority-$modname.ini" ]; then
+	rm "@FINKPREFIX@/etc/php5/conf.d/$priority-$modname.ini";
+    fi
+}
+
+get_state_dir() {
+    local sapi=$1
+    echo "@FINKPREFIX@/var/lib/php5/modules/$sapi"
+    return 0
+}
+
+get_registry_dir() {
+    echo "@FINKPREFIX@/var/lib/php5/modules/registry"
+    return 0
+}
+
+get_sapi_dir() {
+    echo "@FINKPREFIX@/share/php5/sapi"
+    return 0
+}
+
+list_parts() {
+    local dir=$1
+    local regex=${2:-}
+    local args="! ( -name '*.dpkg-old' -name '*.dpkg-new' -name '*.dpkg-dist' -name '*~' -name '*.bak' -name '*.ucf-old' -name '*.ucf-new' -name '*.ucf-dist' -name '*%' )"
+
+    if [ -d "$dir" ]; then
+	if [ -n "$regex" ]; then
+	    args="${args} -regex '$regex'"
+	fi
+	for i in $(find "$dir" -mindepth 1 -maxdepth 1 $args); do
+		echo $(basename ${i})
+	done
+	return $?
+    else
+	return 1
+    fi    
+}
diff -ruN php-5.5.1.orig/fink/php5-module.ini php-5.5.1/fink/php5-module.ini
--- php-5.5.1.orig/fink/php5-module.ini	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-module.ini	2013-08-13 10:47:35.000000000 -0600
@@ -0,0 +1,3 @@
+; configuration for php @extname@ module
+; priority=@priority@
+@extension@=@dsoname@.so
diff -ruN php-5.5.1.orig/fink/php5-module.postinst php-5.5.1/fink/php5-module.postinst
--- php-5.5.1.orig/fink/php5-module.postinst	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-module.postinst	2013-08-13 10:48:28.000000000 -0600
@@ -0,0 +1,38 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+
+if [ "$1" = "configure" ]; then
+    inidir=@FINKPREFIX@/etc/php5/mods-available
+
+    if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ] ; then
+	. @FINKPREFIX@/share/php5/php5-maintscript-helper
+
+	for dsoname in @modules@; do
+	    inifile=${dsoname}.ini
+
+	    # Register new conffile with UCF
+	    ucf @FINKPREFIX@/share/php5/@package@/${inifile} ${inidir}/${inifile}
+	    ucfr --force php5-@package@ ${inidir}/${inifile}
+
+	    # Move pre-extension manager conffile
+	    dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/conf.d/${inifile} ${inidir}/${inifile} 5.4.0~rc6-1 -- "$@";
+
+	    if [ -f "${inidir}/${inifile}.dpkg-new" ]; then
+		md5sum="$(md5sum ${inidir}/${inifile}.dpkg-new | sed -e 's/ .*//')"
+		old_md5sum="$(md5sum ${inidir}/${inifile} | sed -e 's/ .*//')"
+		if [ "$md5sum" = "$old_md5sum" ]; then
+		    mv "${inidir}/${inifile}.dpkg-new" "${inidir}/${inifile}"
+		fi
+	    fi
+	
+	    php5_invoke enmod ALL ${dsoname}
+	done
+    fi
+fi
+
+#DEBHELPER#
+
+exit 0
diff -ruN php-5.5.1.orig/fink/php5-module.postrm php-5.5.1/fink/php5-module.postrm
--- php-5.5.1.orig/fink/php5-module.postrm	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-module.postrm	2013-08-13 10:48:55.000000000 -0600
@@ -0,0 +1,45 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+
+inidir=@FINKPREFIX@/etc/php5/mods-available
+for dsoname in @modules@; do
+    inifile=${dsoname}.ini
+
+    dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/conf.d/${inifile} ${inidir}/${inifile} 5.4.0~rc6-1 -- "$@";
+
+    if [ "$1" = "purge" ]; then
+        # Query which package has this conffile registered
+	if which ucfq >/dev/null; then
+	    ucfp=$(ucfq -w ${inidir}/${inifile} | cut -f 2 -d:)
+	fi
+
+        # Only work with the config file if it still belongs to us
+	if test "$ucfp" = php5-@package@; then
+	    for ext in '~' '%' .bak .ucf-new .ucf-old .ucf-dist;  do
+		rm -f ${inidir}/${inifile}${ext}
+	    done
+	    rm -f ${inidir}/${inifile}
+	    if which ucf >/dev/null; then
+		ucf --purge ${inidir}/${inifile}
+	    fi
+	    if which ucfr >/dev/null; then
+		ucfr --purge php5-@package@ ${inidir}/${inifile}
+	    fi
+	fi
+	
+	if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ] ; then
+	    . @FINKPREFIX@/share/php5/php5-maintscript-helper
+
+	    for dsoname in @modules@; do
+		php5_invoke dismod ALL ${dsoname}
+	    done
+	fi
+    fi
+done
+
+#DEBHELPER#
+
+exit 0
diff -ruN php-5.5.1.orig/fink/php5-module.preinst php-5.5.1/fink/php5-module.preinst
--- php-5.5.1.orig/fink/php5-module.preinst	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-module.preinst	2013-08-13 10:49:10.000000000 -0600
@@ -0,0 +1,14 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+
+for dsoname in @modules@; do
+    inifile=${dsoname}.ini
+    dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/conf.d/${inifile} @FINKPREFIX@/etc/php5/mods-available/${inifile} 5.4.0~rc6-1 -- "$@";
+done
+
+#DEBHELPER#
+
+exit 0
diff -ruN php-5.5.1.orig/fink/php5-module.prerm php-5.5.1/fink/php5-module.prerm
--- php-5.5.1.orig/fink/php5-module.prerm	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-module.prerm	2013-08-13 10:49:22.000000000 -0600
@@ -0,0 +1,19 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+
+if [ "$1" = "remove" ] || [ "$1" = "deconfigure" ]; then
+    if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ] ; then
+	. @FINKPREFIX@/share/php5/php5-maintscript-helper
+
+	for dsoname in @modules@; do
+	    php5_invoke dismod ALL ${dsoname}
+	done
+    fi
+fi
+
+#DEBHELPER#
+
+exit 0
diff -ruN php-5.5.1.orig/fink/php5-mysqlnd.postinst.extra php-5.5.1/fink/php5-mysqlnd.postinst.extra
--- php-5.5.1.orig/fink/php5-mysqlnd.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-mysqlnd.postinst.extra	2013-08-13 10:46:16.000000000 -0600
@@ -0,0 +1,5 @@
+if [ "$1" = "configure" ]; then
+    ucf @FINKPREFIX@/share/php5/mysqlnd/mysqlnd.ini @FINKPREFIX@/etc/php5/mods-available/mysqlnd.ini
+fi
+
+dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/conf.d/10-mysqlnd.ini @FINKPREFIX@/etc/php5/mods-available/mysqlnd.ini 5.4.0~rc6-1 -- "$@";
diff -ruN php-5.5.1.orig/fink/php5-mysqlnd.postrm.extra php-5.5.1/fink/php5-mysqlnd.postrm.extra
--- php-5.5.1.orig/fink/php5-mysqlnd.postrm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-mysqlnd.postrm.extra	2013-08-13 10:46:26.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/conf.d/10-mysqlnd.ini @FINKPREFIX@/etc/php5/mods-available/mysqlnd.ini 5.4.0~rc6-1 -- "$@";
diff -ruN php-5.5.1.orig/fink/php5-mysqlnd.preinst.extra php-5.5.1/fink/php5-mysqlnd.preinst.extra
--- php-5.5.1.orig/fink/php5-mysqlnd.preinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-mysqlnd.preinst.extra	2013-08-13 10:46:37.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper mv_conffile @FINKPREFIX@/etc/php5/conf.d/10-mysqlnd.ini @FINKPREFIX@/etc/php5/mods-available/mysqlnd.ini 5.4.0~rc6-1 -- "$@";
diff -ruN php-5.5.1.orig/fink/php5-sapi.postinst php-5.5.1/fink/php5-sapi.postinst
--- php-5.5.1.orig/fink/php5-sapi.postinst	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sapi.postinst	2013-08-13 10:50:44.000000000 -0600
@@ -0,0 +1,33 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+
+CONFDIR=@FINKPREFIX@/etc/php5/@sapi@/conf.d
+
+if [ -L $CONFDIR ]; then
+    rm $CONFDIR
+    mkdir $CONFDIR
+fi
+
+if [ "$1" = "configure" ]; then
+    phpini="@FINKPREFIX@/etc/php5/@sapi@/php.ini"
+
+    ucf @FINKPREFIX@/share/php5/php.ini-production $phpini
+    ucfr @package@ $phpini
+
+    if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ]; then
+	. @FINKPREFIX@/share/php5/php5-maintscript-helper
+	
+	mods=$(php5query -M)
+	for mod in $mods; do
+	    php5_invoke enmod @sapi@ $mod
+	done
+    fi
+
+fi
+
+#DEBHELPER#
+
+exit 0
diff -ruN php-5.5.1.orig/fink/php5-sapi.postrm php-5.5.1/fink/php5-sapi.postrm
--- php-5.5.1.orig/fink/php5-sapi.postrm	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sapi.postrm	2013-08-13 10:51:06.000000000 -0600
@@ -0,0 +1,38 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+
+php5_enable() { return 0; }
+
+if [ "$1" = "purge" ]; then
+    phpini=@FINKPREFIX@/etc/php5/@sapi@/php.ini
+    # remove the flag to remember the original state
+    if [ -e @FINKPREFIX@/etc/php5/@sapi@/.start ]; then
+	rm -f @FINKPREFIX@/etc/php5/@sapi@/.start
+    fi
+    for ext in '~' '%' .bak .ucf-new .ucf-old .ucf-dist;  do
+	rm -f $phpini$ext
+    done
+    rm -f $phpini
+    if which ucf >/dev/null; then
+	ucf --purge $phpini
+    fi
+    if which ucfr >/dev/null; then
+	ucfr --purge @package@ $phpini
+    fi
+fi
+
+if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ]; then
+    . @FINKPREFIX@/share/php5/php5-maintscript-helper
+
+    mods=$(php5query -M)
+    for mod in $mods; do
+	php5_invoke dismod @sapi@ $mod
+    done
+fi
+
+#DEBHELPER#
+
+exit 0
diff -ruN php-5.5.1.orig/fink/php5-sapi.prerm php-5.5.1/fink/php5-sapi.prerm
--- php-5.5.1.orig/fink/php5-sapi.prerm	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sapi.prerm	2013-08-13 10:51:16.000000000 -0600
@@ -0,0 +1,20 @@
+#!/bin/sh
+
+set -e
+
+#EXTRA#
+
+php5_enable() { return 0; }
+
+if [ -e @FINKPREFIX@/share/php5/php5-maintscript-helper ]; then
+    . @FINKPREFIX@/share/php5/php5-maintscript-helper
+
+    mods=$(php5query -M)
+    for mod in $mods; do
+	php5_invoke dismod @sapi@ $mod
+    done
+fi
+
+#DEBHELPER#
+
+exit 0
diff -ruN php-5.5.1.orig/fink/php5-sqlite.postinst.extra php-5.5.1/fink/php5-sqlite.postinst.extra
--- php-5.5.1.orig/fink/php5-sqlite.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sqlite.postinst.extra	2013-08-13 10:46:43.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/php5/conf.d/sqlite.ini 5.3.9~ -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-sqlite.postrm.extra php-5.5.1/fink/php5-sqlite.postrm.extra
--- php-5.5.1.orig/fink/php5-sqlite.postrm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sqlite.postrm.extra	2013-08-13 10:46:49.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/php5/conf.d/sqlite.ini 5.3.9~ -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-sqlite.preinst.extra php-5.5.1/fink/php5-sqlite.preinst.extra
--- php-5.5.1.orig/fink/php5-sqlite.preinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sqlite.preinst.extra	2013-08-13 10:46:56.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/php5/conf.d/sqlite.ini 5.3.9~ -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-sybase.postinst.extra php-5.5.1/fink/php5-sybase.postinst.extra
--- php-5.5.1.orig/fink/php5-sybase.postinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sybase.postinst.extra	2013-08-13 10:47:03.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/php5/conf.d/mssql.ini 5.2.3-1 -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-sybase.postrm.extra php-5.5.1/fink/php5-sybase.postrm.extra
--- php-5.5.1.orig/fink/php5-sybase.postrm.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sybase.postrm.extra	2013-08-13 10:47:09.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/php5/conf.d/mssql.ini 5.2.3-1 -- "$@"
diff -ruN php-5.5.1.orig/fink/php5-sybase.preinst.extra php-5.5.1/fink/php5-sybase.preinst.extra
--- php-5.5.1.orig/fink/php5-sybase.preinst.extra	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5-sybase.preinst.extra	2013-08-13 10:47:17.000000000 -0600
@@ -0,0 +1 @@
+dpkg-maintscript-helper rm_conffile @FINKPREFIX@/etc/php5/conf.d/mssql.ini 5.2.3-1 -- "$@"
diff -ruN php-5.5.1.orig/fink/php5.conf php-5.5.1/fink/php5.conf
--- php-5.5.1.orig/fink/php5.conf	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5.conf	2013-08-08 10:04:55.000000000 -0600
@@ -0,0 +1,27 @@
+<FilesMatch ".+\.ph(p[345]?|t|tml)$">
+    SetHandler application/x-httpd-php
+</FilesMatch>
+<FilesMatch ".+\.phps$">
+    SetHandler application/x-httpd-php-source
+    # Deny access to raw php sources by default
+    # To re-enable it's recommended to enable access to the files
+    # only in specific virtual host or directory
+    Order Deny,Allow
+    Deny from all
+</FilesMatch>
+# Deny access to files without filename (e.g. '.php')
+<FilesMatch "^\.ph(p[345]?|t|tml|ps)$">
+    Order Deny,Allow
+    Deny from all
+</FilesMatch>
+
+# Running PHP scripts in user directories is disabled by default
+# 
+# To disenable PHP in user directories uncomment the following lines
+# (from <IfModule ...> to </IfModule>.) Do NOT set it to On as it
+# prevents .htaccess files from disabling it.
+#<IfModule mod_userdir.c>
+#    <Directory /Users/*/Sites>
+#        php_admin_value engine Off
+#    </Directory>
+#</IfModule>
diff -ruN php-5.5.1.orig/fink/php5.load php-5.5.1/fink/php5.load
--- php-5.5.1.orig/fink/php5.load	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5.load	2013-08-08 10:02:53.000000000 -0600
@@ -0,0 +1 @@
+LoadModule php5_module @FINKPREFIX@/lib/apache2/modules/libphp5.so
diff -ruN php-5.5.1.orig/fink/php5enmod php-5.5.1/fink/php5enmod
--- php-5.5.1.orig/fink/php5enmod	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5enmod	2013-08-08 09:59:50.000000000 -0600
@@ -0,0 +1,263 @@
+#!/bin/sh
+#
+#  php5enmod - a php5 module manager for Debian/Fink
+#
+#  Copyright 2013 Ondřej Surý <ondrej@sury.org>
+#
+# This program is licensed at your choice under the terms of the GNU General
+# Public License version 2+ or under the terms of the PHP License 3.01.
+#
+# For GPL-2+:
+# This program is free software; you can redistribute it and/or
+# modify it under the terms of the GNU General Public License
+# as published by the Free Software Foundation; either version 2
+# of the License, or (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
+# USA.
+#
+# For PHP 3.01:
+# This source file is subject to version 3.01 of the PHP license,
+# that is bundled with this package in the file LICENSE, and is
+# available through the world-wide-web at the following url:
+# http://www.php.net/license/3_01.txt
+# If you did not receive a copy of the PHP license and are unable to
+# obtain it through the world-wide-web, please send a note to
+# license@php.net so we can mail you a copy immediately.
+#
+
+set -ue
+
+SCRIPT_NAME=${0##*/}
+QUIET=no
+NEED_RESTART=no
+MAINT_MODE=no
+
+. @FINKPREFIX@/share/php5/php5-helper
+
+usage() {
+    [ -n "$@" ] && warning $@
+    echo "usage: ${SCRIPT_NAME} [ -s ALL|sapi_name ] module_name [ module_name_2 ]"
+    exit 1
+}
+
+enmods() {
+    local sapis="$1"
+    local mods="$2"
+    local register="$3"
+    local sapi
+    local mod
+
+    for mod in $mods; do
+	for sapi in $sapis; do
+	    enmod_ret=0
+            enmod $sapi $mod || enmod_ret=$?
+	    case $enmod_ret in
+		0)
+		    NEED_RESTART=yes
+		    record_state enabled $sapi $mod
+		    ;;
+	    esac
+	done
+	if [ "$register" = "yes" ]; then
+	    mod_registry register $mod
+	fi
+    done
+}
+
+dismods() {
+    local sapis="$1"
+    local mods="$2"
+    local register="$3"
+    local purge="$4"
+    local sapi
+    local mod
+
+    for mod in $mods; do
+	for sapi in $sapis; do
+	    local dismod_ret=0
+            dismod $sapi $mod $purge || dismod_ret=$?
+	    case $dismod_ret in
+		0)
+		    NEED_RESTART=yes
+		    record_state disabled $sapi $mod
+		    ;;
+	    esac
+	done
+	if [ "$purge" = "yes" ]; then
+	    remove_state enabled $sapi $mod
+	    remove_state disabled $sapi $mod
+	    mod_registry unregister $mod
+	elif [ "$register" = "yes" ]; then
+	    mod_registry unregister $mod
+	fi
+    done
+}
+
+enmod() {
+    local sapi=$1
+    local modname=$2
+
+    if ! module_exists $modname; then
+	warning "Module $modname ini file doesn't exist under @FINKPREFIX@/etc/php5/mods-available"
+	return 1
+    fi
+
+    local priority=$(get_priority $sapi $modname)
+    local live_link=$(get_live_link $sapi $modname $priority)
+    local live_link_content=$(get_live_link_content $sapi $modname $priority)
+
+    module_cleanup $sapi $modname $priority
+
+    local module_state=0
+    php5query -q -s $sapi -m $modname || module_state=$?
+
+    case $module_state in
+	# module enabled, but re-enable the conf.d link just in case
+	0)
+	    ;;
+	# module not yet enabled
+	1)
+	    ;;
+	# module disabled by maintainer script
+	33)
+	    ;;
+	# module disabled by site administrator
+	# enable module only if not running in maintainer mode
+	32)
+	    if [ "$MAINT_MODE" = "yes" ]; then
+		warning "Not enabling the ${modname} module for ${sapi} SAPI since the module"
+		warning "was disabled by local administrator."
+		return 1
+	    fi
+	    ;;
+	34)
+            warning "Not enabling the ${modname} module for ${sapi} SAPI since module symlink"
+	    warning "already exists in @FINKPREFIX@/etc/php5/${sapi}/conf.d with different content."
+	    return 1
+	    ;;
+	# fail if we get any different result
+	*)
+	    warning "Unable to get module state, run php5query -s $sapi -m $modname manually"
+	    warning "and fix the module state."
+	    return 1
+    esac
+
+    if [ -d "@FINKPREFIX@/etc/php5/$sapi/conf.d" ]; then
+	if [ ! -h "${live_link}" ]; then
+	    ln -s "${live_link_content}" "${live_link}"
+	fi
+    else
+	warning "Directory @FINKPREFIX@/etc/php5/$sapi/conf.d doesn't exist, not enabling the module"
+	return 1
+    fi
+
+    return 0
+}
+
+dismod() {
+    local sapi=$1
+    local modname=$2
+    local purge=$3
+
+    if ! module_exists $modname; then
+	if [ "$purge" = "no" ]; then
+	    warning "Module $modname ini file doesn't exist under @FINKPREIFX@/etc/php5/mods-available"
+	    return 1
+	fi
+    fi
+
+    local priority=$(get_priority $sapi $modname)
+    local live_link=$(get_live_link $sapi $modname $priority)
+    local live_link_content=$(get_live_link_content $sapi $modname $priority)
+
+    module_cleanup $sapi $modname $priority
+
+    local module_state=0
+    php5query -q -s $sapi -m $modname || module_state=$?
+
+    case $module_state in
+	# module enabled
+	0)
+	    ;;
+	# module not enabled, but re-remove the link just in case
+	1|32|33)
+	    ;;
+	34)
+	    warning "Not disabling module $modname for $sapi SAPI.  The configuration was"
+	    warning "modified by local administrator."
+	    return 1
+	    ;;
+	# fail if we get any different result
+	*)
+	    warning "Unable to get module state, run php5query -s $sapi -m $modname manually"
+	    warning "and fix the module state."
+	    return 1
+    esac
+
+    if [ -d "@FINKPREFIX@/etc/php5/$sapi/conf.d" ]; then
+	if [ -h "$live_link" ]; then
+	    rm -f "$live_link"
+	fi
+    fi
+
+    return 0
+}
+
+sapis=
+register=no
+purge=no
+while getopts pfs:mqr opt; do
+    case $opt in
+	r) register=yes;;
+	s)
+	    if [ "$sapis" = "ALL" -o \( "$OPTARG" = "ALL" -a -n "$sapis" \) ]; then
+		warning "You cannot specify ALL and individual sapis"
+		usage
+	    fi
+	    sapis="${sapis}${sapis:+ }$OPTARG"
+	    ;;
+	m) MAINT_MODE=yes;;
+	p) purge=yes;;
+	q) QUIET=yes;;
+	\?) usage;;
+    esac
+done
+shift $(expr $OPTIND - 1)
+mods=""
+for mod in $@; do
+    mods="${mods}${mods:+ }${mod%%/*}"
+done
+if [ "$register" = "no" ]; then
+    sapis="${sapis:-ALL}"
+
+    if [ "$sapis" = "ALL" ]; then
+	register=yes
+    fi
+fi
+
+if [ "$sapis" = "ALL" ]; then
+    sapis=$(php5query -S)
+fi
+
+[ -z "$mods" ] && usage
+
+case "${SCRIPT_NAME}" in
+    php5enmod)
+	enmods "$sapis" "$mods" "$register"
+	;;
+    php5dismod)
+	dismods "$sapis" "$mods" "$register" "$purge"
+	;;
+    *)
+	usage
+	;;
+esac
+exit 0
diff -ruN php-5.5.1.orig/fink/php5filter.conf php-5.5.1/fink/php5filter.conf
--- php-5.5.1.orig/fink/php5filter.conf	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5filter.conf	2013-08-08 10:05:28.000000000 -0600
@@ -0,0 +1,9 @@
+<FilesMatch ".+\.ph(p3?|tml)$">
+    SetInputFilter PHP
+    SetOutputFilter PHP
+</FilesMatch>
+# Deny access to files without filename (e.g. '.php')
+<FilesMatch "^\.ph(p[345]?|t|tml|ps)$">
+    Order Deny,Allow
+    Deny from all
+</FilesMatch>
diff -ruN php-5.5.1.orig/fink/php5filter.load php-5.5.1/fink/php5filter.load
--- php-5.5.1.orig/fink/php5filter.load	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5filter.load	2013-08-08 10:02:27.000000000 -0600
@@ -0,0 +1 @@
+LoadModule php5_module @FINKPREFIX@/lib/apache2/modules/libphp5filter.so
diff -ruN php-5.5.1.orig/fink/php5query php-5.5.1/fink/php5query
--- php-5.5.1.orig/fink/php5query	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/php5query	2013-08-08 09:54:36.000000000 -0600
@@ -0,0 +1,208 @@
+#!/bin/sh
+#
+#  php5query - a php5 module manager for Debian/Fink
+#
+#  Copyright 2013 Ondřej Surý <ondrej@sury.org>
+#
+# This program is licensed at your choice under the terms of the GNU General
+# Public License version 2+ or under the terms of the PHP License 3.01.
+#
+# For GPL-2+:
+# This program is free software; you can redistribute it and/or
+# modify it under the terms of the GNU General Public License
+# as published by the Free Software Foundation; either version 2
+# of the License, or (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
+# USA.
+#
+# For PHP 3.01:
+# This source file is subject to version 3.01 of the PHP license,
+# that is bundled with this package in the file LICENSE, and is
+# available through the world-wide-web at the following url:
+# http://www.php.net/license/3_01.txt
+# If you did not receive a copy of the PHP license and are unable to
+# obtain it through the world-wide-web, please send a note to
+# license@php.net so we can mail you a copy immediately.
+#
+
+set -ue
+
+SCRIPT_NAME=${0##*/}
+QUIET=no
+
+. @FINKPREFIX@/share/php5/php5-helper
+
+usage() {
+    [ -n "$@" ] && warning $@
+    echo "usage: ${SCRIPT_NAME} [ -q ] -s sapi_name [ -m module_name ] [ -M ] [ -S ]"
+    exit 1
+}
+
+check_mod() {
+    local sapi=$1
+    local modname=$2
+
+    if ! module_exists $modname; then
+	output "No module matches $modname"
+	return 1
+    fi
+
+    local priority=$(get_priority $sapi $modname)
+    local live_link=$(get_live_link $sapi $modname $priority)
+    local live_link_content=$(get_live_link_content $sapi $modname $priority)
+
+    found=no
+    if [ -e "${live_link}" ] ; then
+	if [ -h "${live_link}" ] ; then
+	    local content="$(greadlink "${live_link}")"
+	    if [ "${content}" = "${live_link_content}" ] ; then
+		found=yes
+	    fi
+	fi
+	if [ "$found" != "yes" ]; then
+	    output "Module $modname symlink was modified by local administrator."
+	    return 34
+	fi
+    fi
+
+    local state_dir="$(get_state_dir $sapi)"
+
+    if [ -e "${state_dir}/enabled_by_admin/$modname" ]; then
+	output "$modname (Enabled for $sapi by local administrator)"
+	return 0
+    elif [ -e "${state_dir}/enabled_by_maint/$modname" ]; then
+	output "$modname (Enabled for $sapi by maintainer script)"
+	return 0
+    elif [ -e "${state_dir}/disabled_by_admin/$modname" ]; then
+	output "No module matches $modname (Disabled for $sapi by local administrator)"
+	return 32
+    elif [ -e "${state_dir}/disabled_by_maint/$modname" ]; then
+	output "No module matches $modname (Disabled for $sapi by maintainer script)"
+	return 33
+    elif [ "$found" = "yes" ]; then
+	output "$modname (Enabled for $sapi by unknown)"
+	return 0
+    else
+	output "No module matches $modname"
+	return 1
+    fi
+}
+
+list_mod() {
+    local verbose=$1
+    local registry_dir="$(get_registry_dir)"
+
+    sapis=$(list_sapi)
+    if [ -d "$registry_dir" ]; then
+	for mod in $(list_parts "$registry_dir"); do
+	    if [ "$verbose" = "yes" ]; then
+		for sapi in $sapis; do
+		    check_mod $sapi $mod
+		done
+	    else
+		echo $mod
+	    fi
+	done
+	return 0
+    fi
+}
+
+list_sapi() {
+    local sapi_dir="$(get_sapi_dir)"
+
+    if [ -d "$sapi_dir" ]; then
+	for sapi in $(list_parts "$sapi_dir"); do
+	    echo $sapi;
+	done
+    fi
+}
+
+check_sapi() {
+    local sapi=$1
+    local sapi_dir="$(get_sapi_dir)"
+
+    if [ -e "$sapi_dir/$sapi" ]; then
+	return 0
+    fi
+    return 1
+}
+
+QUIET=no
+verbose=no
+action=
+sapi=
+
+while getopts s:m:SMqv opt; do
+    case $opt in
+	s)
+	    if [ -n "$action" ]; then
+		if [ "$action" != "check_mod" ]; then
+		    usage "Only one mode of operation can be used at the same time."
+		else
+		    action="check_sapi"
+		fi
+	    fi
+	    sapi="$OPTARG"
+	    ;;
+	S)
+	    if [ -n "$action" ]; then
+		usage "Only one mode of operation can be used at the same time."
+	    fi
+	    action="list_sapi"
+	    ;;
+	m)
+	    if [ -n "$action" -a "$action" != "check_sapi" ]; then
+		usage "Only one mode of operation can be used at the same time."
+	    fi
+	    action="check_mod"
+	    mod="$OPTARG"
+	    ;;
+	M)
+	    [ -n "$action" ] && usage "Only one mode of operation can be used at the same time."
+	    action="list_mod"
+	    ;;
+	q)
+	    QUIET=yes
+	    ;;
+	v)
+	    verbose=yes
+	    ;;
+	\?) usage "Unknown parameter specified";;
+    esac
+done
+shift $(expr $OPTIND - 1)
+
+if [ -z "$action" ]; then
+    usage "You need to specify at least one action."
+fi
+
+if [ -n "$sapi" ]; then
+    check_sapi $sapi || usage "Invalid SAPI specified"
+fi
+
+ret=0
+case "$action" in
+    check_mod)
+	[ -z "$sapi" ] && usage "You need to specify sapi"
+	check_mod $sapi $mod || ret=$?
+	;;
+    check_sapi)
+	check_sapi $sapi || ret=$?
+	if [ "$ret" -eq 0 ]; then
+	    output "$sapi"
+	fi
+	;;
+    list_mod) list_mod $verbose || ret=$?;;
+    list_sapi) list_sapi || ret=$?;;
+    *) usage "Unknown action $action"
+esac
+
+exit $ret
diff -ruN php-5.5.1.orig/fink/phpapi php-5.5.1/fink/phpapi
--- php-5.5.1.orig/fink/phpapi	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/phpapi	2013-08-08 09:47:42.000000000 -0600
@@ -0,0 +1 @@
+20100525
diff -ruN php-5.5.1.orig/fink/sessionclean php-5.5.1/fink/sessionclean
--- php-5.5.1.orig/fink/sessionclean	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/sessionclean	2013-08-08 10:15:17.000000000 -0600
@@ -0,0 +1,7 @@
+#!/bin/sh
+
+# first find all used files and touch them (hope it's not massive amount of files)
+[ -x /usr/sbin/lsof ] && /usr/sbin/lsof -w -l +d "${1}" | awk -- '{ if (NR > 1) { print $9; } }' | /usr/bin/xargs -I 'touch -c {}'
+
+# find all files older then maxlifetime
+find "${1}" -depth -mindepth 1 -maxdepth 1 -type f -ignore_readdir_race -cmin +${2} -delete
diff -ruN php-5.5.1.orig/fink/setup-mysql.sh php-5.5.1/fink/setup-mysql.sh
--- php-5.5.1.orig/fink/setup-mysql.sh	1969-12-31 17:00:00.000000000 -0700
+++ php-5.5.1/fink/setup-mysql.sh	2013-08-12 22:08:23.000000000 -0600
@@ -0,0 +1,78 @@
+#!/bin/sh
+
+set -eu
+
+[ $# -ge 2 ] || {
+    echo "Usage: fink/setup-mysql.sh port data-dir" >&2
+    exit 1
+}
+
+# CLI arguments #
+port=$1
+datadir=$2
+action=${3:-start}
+if [ "$(id -u)" -eq 0 ]; then
+    user="mysql"
+else
+    user="$(whoami)"
+fi
+
+# Some vars #
+
+socket=$datadir/mysql.sock
+# Commands:
+mysqladmin="mysqladmin --no-defaults --user root --port $port --host 127.0.0.1 --socket=$socket --no-beep"
+mysqld="%p/sbin/mysqld --no-defaults --user=$user --bind-address=127.0.0.1 --port=$port --socket=$socket --datadir=$datadir"
+
+# Main code #
+
+if [ "$action" = "stop" ]; then
+    $mysqladmin shutdown
+    exit
+fi
+
+rm -rf $datadir
+mkdir -p $datadir
+chmod go-rx $datadir
+chown $user: $datadir
+
+mysql_install_db --no-defaults --user=$user --datadir=$datadir --rpm --force
+
+tmpf=$(gmktemp)
+cat > "$tmpf" <<EOF
+USE mysql;
+UPDATE user SET password=PASSWORD('') WHERE user='root';
+FLUSH PRIVILEGES;
+EOF
+
+$mysqld --bootstrap --skip-grant-tables < "$tmpf"
+
+unlink "$tmpf"
+
+# Start the daemon
+$mysqld &
+
+pid=$!
+
+# Wait for the server to be actually available
+c=0;
+while ! nc -z 127.0.0.1 $port; do
+    c=$(($c+1));
+    sleep 3;
+    if [ $c -gt 20 ]; then
+	echo "Timed out waiting for mysql server to be available" >&2
+	if [ "$pid" ]; then
+	    kill $pid || :
+	    sleep 2
+	    kill -s KILL $pid || :
+	fi
+	exit 1
+    fi
+done
+
+# Check if the server is running
+$mysqladmin status
+# Drop the database if it exists
+$mysqladmin --force --silent drop test || true
+# Create new empty database
+$mysqladmin create test
