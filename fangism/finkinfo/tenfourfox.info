Info3: <<
Package: tenfourfox
Version: 4.0
Revision: 0.b8.1
Distribution: 10.4, 10.5
Architecture: powerpc
Description: Port of Firefox 4 to 10.4 and PowerPC
License: OSI-Approved
Maintainer: David Fang <fangism@users.sourceforge.net>
Depends: <<
#	%N-shlibs (= %v-%r),
#	atk1-shlibs (>= 1.20.0-1),
#	bzip2-shlibs,
#	cairo-shlibs (>= 1.6-1),
	fontconfig2-shlibs (>= 2.4.1-1),
	freetype219-shlibs (>= 2.3.7-7),
	glib2-shlibs (>= 2.14.0-1),
#	gtk+2-shlibs (>= 2.12.0-1),
	libgettext8-shlibs,
#	pango1-xft2-ft219-shlibs (>= 1.20.0-3)
#	x11
<<
BuildConflicts: <<
	autoconf,
	autoconf2.6,
	automake1.11,
	freetype,
	freetype-hinting,
	nspr
<<
BuildDepends: <<
#	atk1 (>= 1.20.0-1),
	autoconf2.13,
	bzip2-dev,
#	cairo (>= 1.6-1),
#	dbus-dev,
	fink (>= 0.28-1),
	fink-package-precedence,
	flag-sort,
	fontconfig2-dev (>= 2.4.1-1),
	freetype219 (>= 2.3.7-7),
#	gcc4.2 (>= 4.2.1-5574),
	glib2-dev (>= 2.14.0-1),
#	glitz,
#	gtk+2-dev (>= 2.12.0-1),
	libgettext8-dev,
	libidl2 (>= 0.8.9-1),
	libjpeg8,
#	libnotify (>= 0.4-1),
	make,
#	pango1-xft2-ft219-dev (>= 1.20.0-3),
#	pixman (>= 0.10.0-1),
	pkgconfig (>= 0.21-1),
	python (>= 2.5),
	system-openssl-dev,
	system-sdk-10.4
#	system-sdk-10.5,
#	x11-dev,
#	xft2-dev,
#	yasm
<<
Source: http://releases.mozilla.org/pub/mozilla.org/firefox/releases/%vb8/source/firefox-%vb8.source.tar.bz2
SourceDirectory: mozilla-central
Source-MD5: 665ffbf8571e713d5da8f98e3d971e9d
Source2: http://tenfourfox.googlecode.com/files/TenFourFox-changesets-20101215.zip
Source2-MD5: 862b09c04f7e7e56c251a058d72f60d5
PatchFile: %n.patch
PatchFile-MD5: 8454cd92a1984d8320d74b8bbe93d596
PatchScript: <<
  #!/bin/sh -ev
  # apply patchset from TenFourFox:
  for f in ../exports/*
  do patch -p1 < $f
  done
  ### apply the patch
  /usr/bin/sed -e 's|@FINKPREFIX@|%p|g' -e 's|@FINK_ARCH_TARGET@|%m|g' <%{PatchFile} | /usr/bin/patch -p1
  ### hardcode paths inside dylibs so that programs linking to them can see them
  #/usr/bin/perl -pi -e 's,\@executable_path,%p/lib/%n,g' `/usr/bin/grep -lr @executable_path .`
  # hard-code the @executable_path for the AppBundle (non-relocatable) to
  # satisfy the validator... but this link fails, so we have to hack at
  # install-time (pre-package) and post-install.
  # /usr/bin/perl -pi -e 's,\@executable_path,%p/Applications/TenFourFox.app/Contents/MacOS,g' `/usr/bin/grep -lr @executable_path .`
  ### fix bad stripping on 10.5 from jfm with seamonkey.  No damage to 10.4?
  #/usr/bin/perl -pi -e 's,argument missing, -exported_symbols_list,' configure{,.in}
  # configure inputs were patched, hence regeneration
  autoconf
<<
SetLDFLAGS: -L%p/lib/system-openssl/lib -L%p/lib/fontconfig2/lib -lfontconfig
# NoSetCPPFLAGS: true
SetCPPFLAGS: -I%p/lib/system-openssl/include -I%p/lib/fontconfig2/include -I%p/include -I/usr/X11R6/include
GCC: 4.0
CompileScript: <<
#!/bin/sh -ev
# make=/usr/bin/make
make=%p/bin/make
{ echo "#!/bin/sh -ev" ; \
echo "open -a TenFourFox.app \"$@\"" ;} > tenfourfox
chmod +x tenfourfox

export PKG_CONFIG_PATH=%p/lib/system-openssl/lib/pkgconfig:$PKG_CONFIG_PATH

$make -w -f client.mk build
objdir=obj-%m-apple-darwin`uname -r`
pushd $objdir
fink-package-precedence --headers --depfile-ext=.pp .
fink-package-precedence --libs .
#--depfile-ext=.pp .
# --no-headers .
popd
<<
InstallScript: <<
#!/bin/sh -ev
echo Deferring installation to AppBundles script.
objdir=obj-%m-apple-darwin`uname -r`
ln -s $objdir/dist UninstalledAppDir
# make=/usr/bin/make
make=%p/bin/make
if false
then
$make -w -f client.mk package
$make -j1 -w -f client.mk install DESTDIR=%d

# Install NSS headers.
/bin/cp -R -L obj-%m-apple-darwin`uname -r`/dist/public/nss %i/include/%n/nss

# Install the GNOME .desktop launcher.
/usr/bin/install -d -m 755 %i/share/applications
/usr/bin/install -c -m 644 fink/applications/* %i/share/applications/

# Install the GNOME pixmap for launcher
/usr/bin/install -d -m 755 %i/share/pixmaps
/usr/bin/install -c -m 644 obj-%m-apple-darwin`uname -r`/dist/bin/chrome/icons/default/default16.png %i/share/pixmaps/firefox.png

# install the Fink specific prefs file
/usr/bin/install -c -m 644 fink/fink.js %i/lib/%n/defaults/pref/fink.js

# remove the %N-devel directory because it's not needed in FF
/bin/rm -r %i/lib/%n-devel
else
# fake AppBundle installation because built app dir contains symlinks
mkdir -p %i/bin
mkdir -p %i/Applications
cp tenfourfox %i/bin
cp -p -R -L UninstalledAppDir/TenFourFox.app %i/Applications
# now hack the install_names of private shlibs to appease validator
# and then change them back during post-install.
pkg_path=Applications/TenFourFox.app/Contents/MacOS
pushd %i/$pkg_path
for f in *.dylib
do install_name_tool -id %p/$pkg_path/$f $f
done
popd
fi
<<
PostInstScript: <<
# restore original install_names of shlibs
pkg_path=Applications/TenFourFox.app/Contents/MacOS
pushd %p/$pkg_path
for f in *.dylib
do install_name_tool -id @executable_path/$f $f
done
popd
<<
# AppBundles: UninstalledAppDir/TenFourFox.app
DocFiles: LEGAL LICENSE README.txt
#Shlibs: <<
#	!%p/lib/%N/plugins/libnullplugin.dylib
#	!%p/lib/%N/plugins/libunixprintplugin.dylib
#<<
#SplitOff: <<
#  Package: firefox
#  Depends: <<
#    %N (= %v-%r),
#    %N-shlibs (= %v-%r)
#  <<
#  Conflicts: <<
#    firefox (>= 3.1-6),
#    firefox2,
#    firefox3
#  <<
#  Replaces: <<
#    firefox (>= 3.1-6),
#    firefox2,
#    firefox3
#  <<
#  Description: Lightweight browser from mozilla.org (main user files)
#  DocFiles: LEGAL LICENSE README.txt
#  Files: <<
#    bin/firefox
#    share/applications/firefox.desktop
#    share/pixmaps/firefox.png
#  <<
#<<
#SplitOff2: <<
#  Package: %N-dev
#  Depends: <<
#	%N (= %v-%r),
#	%N-shlibs (= %v-%r)
#  <<
#  BuildDependsOnly: true
#  Description: Lightweight browser from mozilla.org (development files)
#  DocFiles: LEGAL LICENSE README.txt
#  Files: <<
#	include
#	share/idl
#  <<
#<<
#SplitOff3: <<
#  Package: %N-shlibs
#  Depends: <<
#	atk1-shlibs (>= 1.20.0-1),
##	cairo-shlibs (>= 1.6-1),
#	dbus-glib1.2-shlibs,
#	dbus1.3-shlibs,
#	fontconfig2-shlibs (>= 2.4.1-1),
#	freetype219-shlibs (>= 2.3.7-7),
#	glib2-shlibs (>= 2.14.0-1),
##	gtk+2-shlibs (>= 2.12.0-1),
#	libgettext8-shlibs,
#	libjpeg8-shlibs,
#	libnotify-shlibs (>= 0.4-1),
#	pango1-xft2-ft219-shlibs (>= 1.20.0-3),
##	python27-shlibs,
##	x11-shlibs
#  <<
#  Description: Lightweight browser from mozilla.org (shared libraries)
#  DocFiles: LEGAL LICENSE README.txt
#  Files: <<
#	lib/%N/lib*.dylib
#	lib/%N/chrome
#	lib/%N/components
#	lib/%N/greprefs.js
#	lib/%N/res
#  <<
#  Shlibs: <<
#    %p/lib/%N/libfreebl3.dylib 1.0.0 %n (>= 1.5.0.10-1001)
#    %p/lib/%N/libmozalloc.dylib 1.0.0 %n (>= 4.0-0.b1.1)
#    %p/lib/%N/libmozsqlite3.dylib 1.0.0 %n (>= 4.0-0.b1.1)
#    %p/lib/%N/libnspr4.dylib 1.0.0 %n (>= 0.10.1-4)
#    %p/lib/%N/libnss3.dylib 1.0.0 %n (>= 0.10.1-4)
#    (%m = x86_64) %p/lib/firefox4/libnssckbi.dylib 1.0.0 %n (>= 4.0-0.b1.1)
#    %p/lib/%N/libnssdbm3.dylib 1.0.0 %n (>= 3.1-2)
#    %p/lib/%N/libnssutil3.dylib 1.0.0 %n (>= 3.1-2)
#    %p/lib/%N/libplc4.dylib 1.0.0 %n (>= 0.10.1-4)
#    %p/lib/%N/libplds4.dylib 1.0.0 %n (>= 0.10.1-4)
#    %p/lib/%N/libsmime3.dylib 1.0.0 %n (>= 0.10.1-4)
#    %p/lib/%N/libsoftokn3.dylib 1.0.0 %n (>= 0.10.1-4)
#    %p/lib/%N/libssl3.dylib 1.0.0 %n (>= 0.10.1-4)
#    %p/lib/%N/libxpcom.dylib 1.0.0 %n (>= 0.10.1-4)
#    %p/lib/%N/libxul.dylib 1.0.0 %n (>= 3.1-1)
#  <<
#<<
Shlibs: <<
	!%p/Applications/TenFourFox.app/Contents/MacOS/libfreebl3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libmozalloc.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libmozsqlite3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libnspr4.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libnss3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libnssckbi.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libnssdbm3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libnssutil3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libplc4.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libplds4.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libsmime3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libsoftokn3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libssl3.dylib
	!%p/Applications/TenFourFox.app/Contents/MacOS/libxpcom.dylib
<<
Homepage: http://www.floodgap.com:80/software/tenfourfox/
DescDetail: <<
"Mozilla left you.  Apple left you.  But we didn't."
TenFourFox is a port of Firefox 4 for PowerPC Macs.
A separate port is necessary because upstream no longer supports
10.4, nor PowerPC.
<<
DescUsage: <<
command line: %p/bin/tenfourfox

or drag %p/Applications/TenFourFox.app onto your dock.
<<
DescPackaging: <<
For the most part, follow's upstream's instructions for building.
http://code.google.com/p/tenfourfox/wiki/HowToBuild

Uses default toolkit cairo-cocoa, instead of gtk+2.
SplitOffs have been punted until there is actual interest.
Uses system-openssl instead of fink's openssl.  
<<
DescPort: <<
Needs autoconf2.13 to regenerate configure after patch from tenfourfox.
BuildConflicts with automake1.11 to temporarily remove to allow autoconf2.13.

ac_add_options --enable-macos-target=foo in patch file (.mozconfig) is 
for the minimum OS version that this will compile in, so usually the 
lowest Distribution used in the Fink tree this lives in.

Using system-provided libraries:
--------------------------------
. system-png cannot be used because it lacks APNG (upstream won't include it)
. system-sqlite needs >= 3.6.23.1, but with extra options compiled in.
<<
<<
