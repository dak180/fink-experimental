--- octave-3.2.4/src/display.cc	2009-08-13 01:56:02.000000000 -0400
+++ octave-3.2.4.patched/src/display.cc	2011-08-27 15:08:31.000000000 -0400
@@ -65,12 +65,18 @@
 	warning ("no graphical display found");
 
 #elif defined (HAVE_FRAMEWORK_CARBON)
+      /* for 10.7 */
+      size_t displayBitsPerPixel (CGDirectDisplayID displayId);
+
+
 
       CGDirectDisplayID display = CGMainDisplayID ();
 
       if (display)
 	{
-	  dp = CGDisplayBitsPerPixel (display);
+
+	  /*dp = CGDisplayBitsPerPixel (display);*/
+	  dp = displayBitsPerPixel (display);
 
 	  ht = CGDisplayPixelsHigh (display);
 	  wd = CGDisplayPixelsWide (display);
@@ -150,6 +156,24 @@
   return retval;
 }
 
+  size_t displayBitsPerPixel (CGDirectDisplayID displayId) {
+
+			CGDisplayModeRef mode = CGDisplayCopyDisplayMode(displayId);
+			size_t depth = 0;
+
+			CFStringRef pixEnc = CGDisplayModeCopyPixelEncoding(mode);
+			if(CFStringCompare(pixEnc, CFSTR(IO32BitDirectPixels), kCFCompareCaseInsensitive) == kCFCompareEqualTo)
+				depth = 32;
+			else if(CFStringCompare(pixEnc, CFSTR(IO16BitDirectPixels), kCFCompareCaseInsensitive) == kCFCompareEqualTo)
+				depth = 16;
+			else if(CFStringCompare(pixEnc, CFSTR(IO8BitIndexedPixels), kCFCompareCaseInsensitive) == kCFCompareEqualTo)
+				depth = 8;
+
+		CFRelease(pixEnc);
+		CFRelease(mode);
+		return depth;
+		}
+
 /*
 ;;; Local Variables: ***
 ;;; mode: C++ ***
